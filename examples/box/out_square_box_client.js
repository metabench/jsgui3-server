(()=>{var ye=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var q=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var Ka=q((iy,Pr)=>{var lu=typeof window<"u",Oa=!lu,Pa,La,Na,cu=()=>{if(Oa)return(()=>{let e=ye("stream");return Pa=e.Readable,La=e.Writable,Na=e.Transform,e})()},ry=cu(),$=(i,e,t)=>{if(i){if(i.__type=="collection")return i.each(e,t);let s=!0,r=function(){s=!1};if(Ee(i)){let n=[],a;for(let o=0,l=i.length;o<l&&s!=!1;o++)t?a=e.call(t,i[o],o,r):a=e(i[o],o,r),n.push(a);return n}else{let n,a={};for(n in i){if(s===!1)break;t?a[n]=e.call(t,i[n],n,r):a[n]=e(i[n],n,r)}return a}}},Ee=Array.isArray,_u=function(e){return!!e&&typeof e.nodeType<"u"&&typeof e.childNodes<"u"},Tr=function(i){let e={};return $(i,function(t,s){e[t]=!0}),e},hu=function(i){let e=[];return $(i,function(t,s){e.push(s)}),e},uu=function(i){let e={};for(let t=0,s=i.length;t<s;t++)e[i[t]]=t;return e},Ma=function(i){let e=new Array(i.length);for(let t=0,s=i.length;t<s;t++)e[t]=i[t];return e},Ra=function(i){return typeof i<"u"&&i!==null&&Lt(i.__type_name)&&Lt(i.content)&&Lt(i.dom)},Er={},Nt={object:"o",number:"n",string:"s",function:"f",boolean:"b",undefined:"u",array:"a",arguments:"A",date:"d",regex:"r",error:"e",buffer:"B",promise:"p",observable:"O",readable_stream:"R",writable_stream:"W"},zr=!1,fu=i=>{if(Ee(i))throw console.trace(),"invert(obj) not supported on arrays";{let e={};return $(i,(t,s)=>{e[t]=s}),e}},Ha=fu(Nt),du=(i,e,t)=>{Er[i]=t,Ha[e]=i,Nt[i]=e,zr=!0},ie=(i,e)=>{let t=e||typeof i;if(zr){let s;if($(Er,(r,n,a)=>{r(i)&&(s=n,a())}),s)return s}return t==="number"||t==="string"||t==="function"||t==="boolean"?t:t==="object"?typeof i<"u"?i===null?"null":i.__type?i.__type:i.__type_name?i.__type_name:i instanceof Promise?"promise":Ra(i)?"control":i instanceof Date?"date":Ee(i)?"array":(i instanceof Error?t="error":i instanceof RegExp&&(t="regex"),typeof window>"u"&&i&&i.readInt8&&(t="buffer"),t):"undefined":t},Se=i=>{let e=typeof i;if(zr){let t;if($(Er,(s,r,n)=>{s(i)&&(t=Nt[r],n())}),t)return t}if(e==="number"||e==="string"||e==="function"||e==="boolean"||e==="undefined")return e[0];if(i===null)return"N";if(Oa){if(i instanceof Pa)return"R";if(i instanceof La)return"W";if(i instanceof Na)return"T"}return i instanceof Buffer?"B":i instanceof Promise?"p":i instanceof Date?"d":Ee(i)?"a":i._is_observable===!0?"O":typeof i.callee=="function"?"A":i instanceof Error?"e":i instanceof RegExp?"r":"o";throw console.trace(),console.log("item",item),"type not found";return e},Br=i=>{let e=new Array(i.length);for(let t=0,s=i.length;t<s;t++)e[t]=ie(i[t]);return e},Lt=i=>typeof i<"u",mu=JSON.stringify,gu=(i,e)=>{let t,s=typeof i;if(s==="string")t="s";else if(s==="number")t="n";else if(s==="boolean")t="b";else if(s==="function")t="f";else{let r=ie(i,s);if(r==="array")if(e){t="[";for(let n=0,a=i.length;n<a;n++)n>0&&(t=t+","),t=t+mt(i[n],e-1);t=t+"]"}else t="a";else if(r==="control")t="c";else if(r==="date")t="d";else if(r==="observable")t="O";else if(r==="regex")t="r";else if(r==="buffer")t="B";else if(r==="readable_stream")t="R";else if(r==="writable_stream")t="W";else if(r==="object")t="o";else if(r==="undefined")t="u";else{if(r==="collection_index")return"X";r==="data_object"?i._abstract?t="~D":t="D":r==="data_value"?i._abstract?t="~V":t="V":r==="null"?t="!":r==="collection"?i._abstract?t="~C":t="C":t="?"}}return t},mt=(i,e)=>{if(e)return gu(i,e);let t=ie(i);if(Nt[t])return Nt[t];{let s=typeof i;if(s==="object")return Ee(i)?"a":"o";throw console.log("map_loaded_type_abbreviations type name not found",t),console.log("bt",s),console.trace(),"stop"}},ks=i=>{let e=0,t=i.length,s="[",r=!0;for(e=0;e<t;e++)r?r=!1:s=s+",",s=s+mt(i[e]);return s=s+"]",s},ft=(i,e=-1,t=0)=>{let s=Se(i),r="";if(s==="a"){let n=i.length;if(e===-1||t<=e){r=r+"[";let a=!0;for(let o=0;o<n;o++)a||(r=r+","),r=r+ft(i[o],e,t+1),a=!1;r=r+"]"}else return"a"}else if(s==="A"){let n=i.length,a=!0;for(let o=0;o<n;o++)a||(r=r+","),r=r+ft(i[o],e,t+1),a=!1}else if(s==="o")if(e===-1||t<=e){let n="{",a=!0;return $(i,(o,l)=>{a||(n=n+","),n=n+'"'+l+'":'+ft(o,e,t+1),a=!1}),n=n+"}",n}else return"o";else r=r+s;return r},pu=function(i){if(ie(i)==="string")return i.charAt(0)=="["&&i.charAt(i.length-1)=="]"?i.substring(1,i.length-1):i},Va=function(i){let e=[],t=-1,s,r;for(let n=0,a=i.length;n<a;n++)r=i[n],s=ie(r),s=="undefined"||(t=n);for(let n=0,a=i.length;n<a;n++)n<=t&&e.push(i[n]);return e},Ya=function(i,e){let t=arguments;t.length===1&&(e=t[0],i=null);let s=Array.prototype.slice,r,n,a,o,l;return function(){if(l=arguments,o=l.length,o===1)return n=mt([l[0]],1),a=[l[0]],a.l=1,e.call(this,a,n);if(o>1)return r=Va(s.call(l,0)),n=mt(r,1),r.l=r.length,e.call(this,r,n);if(l.length===0)return r=new Array(0),r.l=0,e.call(this,r,"[]")}},st=Ya,vu=(i,e={})=>{let s=i.split(", ").join(",").split(","),r=[];return $(s,n=>{if(n.length===1){let a=Ha[n];r.push({abbreviation:n,type_name:a})}else{let a,o=!1,l=!1,_=n,u={type_name:_},h=()=>{let d=_.substr(_.length-1);d==="*"?(_=_.substr(0,_.length-1),o=!0,u.zero_or_more=!0,u.modifiers=u.modifiers||[],u.modifiers.push("*"),h()):d==="+"&&(_=_.substr(0,_.length-1),l=!0,u.one_or_more=!0,u.modifiers=u.modifiers||[],u.modifiers.push("+"),h())};h(),u.type_name=_,r.push(u)}}),r},yu=Tr(["pre","default","post"]),xu=()=>{},Ar=(i,e)=>{let t={};e&&$(e,u=>{t[u]=!0});let s=[],r=i.length,n=new Uint32Array(r);$(i,(u,h)=>{n[h]=u.length});let a=new Uint32Array(r).fill(0),o=(u,h)=>{let d=new Array(r);if(h.length===r)for(var f=0;f<r;f++)d[f]=u[f][h[f]];else throw console.trace(),"Arguments length mismatch";return d},l=()=>{for(c=r-1;c>=0;c--){let u=a[c],h=n[c]-1;if(u<h){a[c]++;break}else{if(c===0)return!1;a.fill(0,c)}}return!0},_=o(i,a);for(s.push(_);l();){let u=o(i,a);s.push(u)}return s},bu={string:!0,boolean:!0,number:!0},wu=function(){let i=arguments,e=ks(i),t={},s,r,n={},a={},o=[],l,_,u,h,d;if(e==="[o]")r=i[0];else if(e==="[o,o]")t=i[0],r=i[1];else if(e==="[o,f]")t=i[0],h=i[1];else if(e==="[o,s,f]")t=i[0],d=i[1],h=i[2],r={},r[d]=h;else if(e==="[f,o]")h=i[0],t=i[1];else if(e==="[f]")h=i[0];else throw console.log("sig1",e),console.trace(),"mfp NYI";let{single:f,name:p,grammar:g,verb:b,noun:k,return_type:y,return_subtype:T,pure:j,main:S,skip:z}=t,U,Q,Y,W=ft;r&&(r.default&&(u=r.default),$(r,(H,C)=>{if(typeof H=="function")if(yu[C])console.log("ommiting, not parsing sig",C);else{let R=vu(C),I=[],D=[];$(R,(B,P)=>{if(D[P]=[],B.modifiers){let re=B.modifiers.length;if(re>1)throw"Use of more than 1 modifier is currently unsupported.";if(re===1){I.push([P,B]);let Z=B.modifiers[0];if(Z==="*"){D[P].push(""),D[P].push(B.abbreviation||B.type_name);let F=g.maps.sing_plur[B.type_name];D[P].push(F)}if(Z==="+"){D[P].push(B.abbreviation||B.type_name);let F=g.maps.sing_plur[B.type_name];D[P].push(F)}Z==="?"&&(D[P].push(""),D[P].push(B.abbreviation||B.type_name))}}else D[P].push(B.abbreviation||B.type_name)});let E=Ar(D),V=[],L=-1;$(E,B=>{let P="";if($(B,(re,Z)=>{let F=P.length;Z>0&&(P=P+","),re===""?(P=P+"u",L===-1&&(L=F)):(P=P+re,L=-1)}),L>0){let re=P.substr(0,L);V.push(re)}V.push(P)}),V.length>0?$(V,B=>{n[B]=H}):n[C]=H,a[C]=R,o.push([C,R,H])}else throw console.log("fn",H),console.trace(),"Expected: function"})),$(n,(H,C)=>{_=_||{},_[C]=!0});let ee=function(){let H=arguments,C=H.length;console.log(""),console.log("calling mfp function"),console.log("--------------------"),console.log("");let R,I=ie,D=W,E=Se;R=D(H);let V=!1;if(z&&z(H)&&(V=!0),!V){if(n[R])return n[R].apply(this,H);{let L=-1,B=-1;$(H,(m,v)=>{v=parseInt(v,10);let w=Se(m);w==="o"&&(B=v),w==="f"&&(L=v)});let P=L>-1&&L===H.length-1,re=B>-1&&B===H.length-1,Z=B>-1&&B===H.length-2,F;re&&(F=H[B]);let K=[];for(let m=0;m<B;m++)K.push(H[m]);$(F,(m,v)=>{K.push(m)});let te=D(K);if(te=te.substring(1,te.length-1),n[te])return n[te].apply(this,K);if(u)return u.call(this,H,R);if(h)return console.log("pre apply single_fn"),h.apply(this,H);throw console.log("Object.keys(inner_map_parsed_sigs)",Object.keys(a)),console.trace(),console.log("mfp_fn_call_deep_sig",R),console.log("provided_map_sig_fns",r),r&&xu("Object.keys(provided_map_sig_fns)",Object.keys(r)),console.log("Object.keys(inner_map_sig_fns)",Object.keys(n)),console.trace(),"no signature match found. consider using a default signature. mfp_fn_call_deep_sig: "+R}}},M={};return p&&(M.name=p),f&&(M.single=f),z&&(M.skip=z),g&&(M.grammar=g),typeof t<"u"&&t.async&&(M.async=t.async),S===!0&&(M.main=!0),y&&(M.return_type=y),T&&(M.return_subtype=T),j&&(M.pure=j),_&&(M.map_sigs=_),Object.keys(M).length>0&&(ee._=M),ee},ku=st(function(i,e){let t,s=1,r=0,n,a,o=function(){a=function(){let l=Ma(arguments),_=Br(l),u=this,h=l[l.length-1];if(ie(h)=="function")if(typeof t<"u"&&_[t]=="array"){let d=[],f=[];$(l[t],function(p,g){let b=l.slice(0,l.length-1);b[t]=p,f.push([u,n,b])}),Or(f,s,r,(p,g)=>{if(p)throw console.trace(),p;{let b=[];b=b.concat.apply(b,g),h(null,b)}})}else return n.apply(u,l);else if(typeof t<"u"&&_[t]=="array"){let d=[];for(let f=0,p=l[t].length;f<p;f++){l[t]=arguments[t][f];let g=n.apply(u,l);d.push(g)}return d}else return n.apply(u,l)}};if(e=="[o]"){let l=[];$(i[0],function(_,u){l.push([_,u])})}else e=="[f]"?(t=0,n=i[0],o()):e=="[n,f]"?(t=i[0],n=i[1],o()):e=="[n,n,f]"?(t=i[0],s=i[1],n=i[2],o()):e=="[n,n,n,f]"&&(t=i[0],s=i[1],r=i[2],n=i[3],o());return a}),Cu=i=>{let e=ie(i);if(e=="function")return st(function(s,r){let n=this;if(r=="[o]"){let a=s[0];$(a,function(o,l){i.call(n,o,l)})}else if(r=="[o,f]"){let a=s[0],o=s[1],l=[];$(a,function(_,u){l.push([i,[_,u]])}),dt(l,function(_,u){_?o(_):o(null,u)})}else s.length>=2&&i.apply(this,s)});if(e=="array"){let t={};if(arguments.length==1)Ua(i)?$(i,function(s,r){t[s]=!0}):$(i,function(s,r){t[s[0]]=s[1]});else{let s=arguments[1];$(i,function(r,n){t[r[s]]=r})}return t}},Cs=st((i,e)=>{let t=i[0];if(i.l===1){if(t&&typeof t.clone=="function")return t.clone();{let s=ie(t);if(s==="array"){let r=[];return $(t,n=>{r.push(Cs(n))}),r}else return s==="undefined"?void 0:s==="string"||s==="number"||s==="function"||s==="boolean"||s==="null"?t:Object.assign({},t)}}else if(i.l===2&&ie(i[1])==="number"){let s=[];for(let r=0;r<i[1];r++)s.push(Cs(t));return s}}),qu=function(i,e){$(e,function(t,s){i[s]=t})},ju=(i,e,t)=>{let s=e.split("."),r=0,n=s.length,a=i._||i,o;for(;r<n;)o=s[r],typeof a[o]>"u"?r-n==-1?a[o]=t:a[o]={}:r-n==-1&&(a[o]=t),a=a[o],r++;return t},Tu=(i,e)=>{if(i&&e){let t=i._||i;if(e==".")return typeof t["."]>"u"?void 0:t["."];{let s=e.split("."),r=0,n=s.length,a;for(;r<n;){if(a=s[r],typeof t[a]>"u"){if(r-n!=-1)throw"object "+a+" not found"}else if(r-n==-1)return t[a];t=t[a],r++}}}},Au=function(i){return i===!0},Ia=(i,e)=>{let t=!0;e(i,()=>{t=!1}),i._superclass&&t&&Ia(i._superclass,e)},Fr=function(i,e){let t=ie(i),s;if(t=="array"){let r=!0;return $(i,function(n,a){s=ie(n),s!=e&&(r=!1)}),r}else return!1},Du=function(i){return Fr(i,"array")},Ua=function(i){return Fr(i,"string")},Su={},Eu={},Or=st(function(i,e){let t,s,r=!1,n,a=1;i.l==1,i.l==2&&(t=i[0],s=i[1]),i.l==3&&(e=="[a,n,f]"&&(t=i[0],a=i[1],s=i[2]),e=="[n,a,f]"&&(t=i[1],a=i[0],s=i[2]),e=="[a,f,b]"&&(t=i[0],s=i[1],r=i[2])),i.l==4&&(e=="[a,n,n,f]"&&(t=i[0],a=i[1],n=i[2],s=i[3]),e=="[n,n,a,f]"&&(t=i[2],a=i[0],n=i[1],s=i[3]));let o=[],l=t.length,_=0,u=l,h=0,d=f=>{h++;let p=()=>{let g=t[_],b,k,y,T,j=mt(g);ie(g)=="function"?(k=g,y=[]):g&&(g.length==1,g.length==2&&(ie(g[1])=="function"?(b=g[0],k=g[1],y=[]):(k=g[0],y=g[1])),g.length==3&&(ie(g[0])==="function"&&ie(g[1])==="array"&&ie(g[2])==="function"&&(k=g[0],y=g[1],T=g[2]),ie(g[1])==="function"&&ie(g[2])==="array"&&(b=g[0],k=g[1],y=g[2])),g.length==4&&(b=g[0],k=g[1],y=g[2],T=g[3]));let z=_;_++;let U=(Y,W)=>{if(h--,u--,Y){let ee=new Error().stack;s(Y)}else r?o[z]=[y,W]:o[z]=W,T&&T(null,W),_<l?h<a&&d(f):u<=0&&s(null,o)},Q=y||[];Q.push(U),k&&(b?k.apply(b,Q):k.apply(this,Q))};t[_]&&(f?setTimeout(p,f):p())};if(t.length>0)for(;_<l&&h<a;)n?d(n*_):d()}),dt=Or,zu=function(i){let e=i||[];return e.go=function(t,s,r){let n=arguments,a=n.length;a==1&&dt(e,n[0]),a==2&&dt(t,e,s),a==3&&dt(t,s,e,r)},e},Bu=function(i){if(i===String)return"String";if(i===Number)return"Number";if(i===Boolean)return"Boolean";if(i===Array)return"Array";if(i===Object)return"Object"},Fu=function(i,e){let t=i.substr(1,i.length-2),s=e.substr(1,e.length-2);if(t.indexOf("[")>-1||t.indexOf("]")>-1||s.indexOf("[")>-1||s.indexOf("]")>-1)throw"sig_match only supports flat signatures.";let r=t.split(","),n=s.split(","),a=!0;if(r.length==n.length){let o=0,l=r.length,_,u;for(;a&&o<l;)_=r[o],u=n[o],_===u||_!=="?"&&(a=!1),o++;return a}else return!1},Ou=function(i){return i[0]=="["&&i[i.length-1]=="]"?i.substring(1,i.length-1):i},Pu=function(i){let e=st(function(t,s){if(t.l==1){if(s=="[s]"){let r=t[0].split(" ");return r.length>1?e.call(this,r):i.call(this,t[0])}if(ie(t[0])=="array"){let r={},n=this;return $(t[0],function(a,o){r[a]=i.call(n,a)}),r}}});return e},$a=i=>{let e=[];return $(i,t=>{e.push(t)}),e},Lu=i=>{let e=Object.keys(i[0]),t=[],s;return $(i,r=>{t.push($a(r))}),[e,t]},Nu=(i,e,t)=>{let s=i,r,n;$(e,a=>{r=s,s=s[a],n=a}),r[n]=t},Mu=(i,e)=>{let t=i;return $(e,s=>{t=t[s]}),t},Ga=(i,e=[],t)=>{arguments.length===2&&(t=e,e=[]),$(i,(s,r)=>{let n=Cs(e);n.push(r),ie(s)==="array"?Ga(s,n,t):t(n,s)})},Ru=i=>function(){let t=arguments;if(typeof t[t.length-1]==="function")i.apply(this,t);else return new Promise((r,n)=>{[].push.call(t,(a,o)=>{a?n(a):r(o)}),i.apply(this,t)})},Mt=i=>{let e=st(function(t,s){if(t.l>2)throw"stop - need to check.";if(s==="[n,n]")return i(t[0],t[1]);{let r=Br(t);if(r[0]==="array"){if(r[1]==="number"){let n=[],a=t[1],o=t[0].length,l;for(l=0;l<o;l++)n.push(e(t[0][l],a));return n}if(r[1]==="array"){if(r[0].length!==r[1].length)throw"vector array lengths mismatch";{let n=new Array(o),a=t[1],o=t[0].length;for(let l=0;l<o;l++)n[l]=e(t[0][l],a[l]);return n}}}}});return e},Hu=(i,e)=>i+e,Vu=(i,e)=>i-e,Yu=(i,e)=>i*e,Iu=(i,e)=>i/e,Uu=Mt(Hu),Wa=Mt(Vu),$u=Mt(Yu),Gu=Mt(Iu),Xa=function(i){var e=Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2));return e},Wu=function(i){var e=Wa(i[1],i[0]);return Xa(e)},Xu={c:Uint8ClampedArray,ui8:Uint8Array,i16:Int16Array,i32:Int32Array,ui16:Uint16Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array},Fa=function(){let i=arguments,e,t,s=i[0];Ee(i[1])?t=i[1]:e=i[1];let r=Xu[s];if(r){if(t)return r(t);if(e)return r(e)}},Dr=class{constructor(e){let t={name:"User Auth Grammar"},{name:s}=e;this.name=s;let r=()=>{let n={},a={},o={},l={},_={},u={},h={}};this.maps={sing_plur:{},plur_sing:{},sing_def:{},deep_sig_sing:{},obj_sig_sing:{},sig_levels_sing:{}},this.load_grammar(e.def)}load_grammar(e){let{sing_plur:t,plur_sing:s,sing_def:r,sig_levels_sing:n,deep_sig_sing:a,obj_sig_sing:o}=this.maps,l=u=>{let h=Se(u);if(h==="a"){let d=[];return $(u,f=>{d.push(l(f))}),d}else{if(h==="s")return u==="string"?"string":u==="number"?"number":u==="boolean"?"boolean":r[u];if(h==="n")throw console.trace(),"NYI";if(h==="b")throw console.trace(),"NYI"}},_=(u,h=0)=>{let d=Se(u);if(d==="s"){if(u==="string")return"s";if(u==="number")return"n";if(u==="boolean")return"b"}else if(d==="a"){let f="";return h===0||(f=f+"["),$(u,(p,g)=>{g>0&&(f=f+","),f=f+_(p,h+1)}),h===0||(f=f+"]"),f}else throw console.trace(),"NYI";return res};$(e,(u,h)=>{let{def:d,plural:f}=u;r[h]=d,t[h]=f,s[f]=h;let p=Se(d),g=l(d),b=_(g);a[b]=a[b]||[],a[b].push(h);let k=!0;$(d,(T,j,S)=>{Se(T)==="s"&&r[T]||(k=!1,S())});let y;k&&(y="{",$(d,(T,j,S)=>{j>0&&(y=y+",");let z=l(T),U=_(z);y=y+'"'+T+'":',y=y+U}),y=y+"}"),y&&(o[y]=o[y]||[],o[y].push(h))})}tof(e){let{sing_plur:t,plur_sing:s,sing_def:r,sig_levels_sing:n,deep_sig_sing:a,obj_sig_sing:o}=this.maps,l=Se(e);if(console.log("titem",l),l==="a"){let h;if($(e,(d,f,p)=>{let g=this.tof(d);console.log("subitem_type",g),f===0?h=g:h===g||(h=null,p())}),h){if(console.log("has all_arr_items_type",h),!bu[h])return t[h]}else console.log("no all_arr_items_type")}else return ie(e);let _=ft(e);console.log("Grammar tof() item_deep_sig",_);let u;if(l==="a"){let h=_.substring(1,_.length-1);console.log("unenclosed_sig",h),u=a[h]}else u=a[_];if(u){if(u.length===1)return u[0];throw console.trace(),"NYI"}}sig(e,t=-1,s=0){let{sing_plur:r,plur_sing:n,sing_def:a,sig_levels_sing:o,deep_sig_sing:l,obj_sig_sing:_}=this.maps;return(h=>{let d=Se(h),f="",p,g=b=>{p=void 0;let k;$(b,(y,T)=>{T>0&&(f=f+",");let j=this.sig(y,t,s+1);k===void 0?k=j:j!==k&&(k=!1,p=!1),k&&a[j]&&(p===void 0?p=j:p===j||(p=!1)),f=f+j})};if(d==="A")return g(h),f;if(d==="a"){if(g(h),p)return r[p];{let b=_[f],k=l[f],y;return k&&k.length===1&&(y=k[0]),y||"["+f+"]"}}else if(d==="o")if(t===-1||s<=t){f=f+"{";let b=!0;return $(h,(k,y)=>{let T=this.sig(k,t,s+1);b?b=!1:f=f+",",f=f+'"'+y+'":'+T}),f=f+"}",f}else return"o";else return d})(e)}single_forms_sig(e){let{sing_plur:t,plur_sing:s,sing_def:r,sig_levels_sing:n,deep_sig_sing:a,obj_sig_sing:o}=this.maps,_=this.sig(e).split(","),u=[];return $(_,(d,f)=>{let p=s[d]||d;u.push(p)}),u.join(",")}},tt=class{constructor(){Object.defineProperty(this,"_bound_events",{value:{}})}raise_event(){let e=Array.prototype.slice.call(arguments),t=ks(e);e.l=e.length;let s=this,r,n,a;if(t==="[s]"){let o=this,l=e[0],_=this._bound_general_handler,u=this._bound_events;if(a=[],_)for(r=0,n=_.length;r<n;r++)a.push(_[r].call(o,l));if(u){let h=u[l];if(ie(h)=="array"){for(r=0,n=h.length;r<n;r++)a.push(h[r].call(o));return a}}}if(t==="[s,a]"){let o=this._bound_events,l=this._bound_general_handler,_=e[0];if(a=[],l)for(r=0,n=l.length;r<n;r++)a.push(l[r].call(s,_,e[1]));if(o){let u=o[_];if(ie(u)==="array")for(r=0,n=u.length;r<n;r++)a.push(u[r].call(s,e[1]))}}if(t==="[s,b]"||t==="[s,s]"||t==="[s,n]"||t==="[s,B]"||t==="[s,O]"||t==="[s,e]"){let o=this._bound_events,l=this._bound_general_handler,_=e[0];if(a=[],l)for(r=0,n=l.length;r<n;r++)a.push(l[r].call(s,_,e[1]));if(o){let u=o[_];if(ie(u)==="array")for(r=0,n=u.length;r<n;r++)a.push(u[r].call(s,e[1]))}}if(t==="[s,o]"||t==="[s,?]"){let o=this._bound_events,l=this._bound_general_handler,_=e[0];if(a=[],l)for(r=0,n=l.length;r<n;r++)a.push(l[r].call(s,_,e[1]));if(o){let u=o[_];if(ie(u)==="array")for(r=0,n=u.length;r<n;r++)a.push(u[r].call(s,e[1]))}}else if(e.l>2){let o=e[0],l=[],_=[o];for(r=1,n=e.l;r<n;r++)l.push(e[r]),_.push(e[r]);let u=this._bound_events,h=this._bound_general_handler;if(a=[],h)for(r=0,n=h.length;r<n;r++)a.push(h[r].apply(s,_));if(u){let d=u[o];if(ie(d)=="array")if(d.length>0){for(r=0,n=d.length;r<n;r++)d[r]&&a.push(d[r].apply(s,l));return a}else return a}}return a}add_event_listener(){let{event_events:e}=this,t=Array.prototype.slice.call(arguments),s=ks(t);if(s==="[f]"&&(this._bound_general_handler=this._bound_general_handler||[],Ee(this._bound_general_handler)&&this._bound_general_handler.push(t[0])),s==="[s,f]"){let r=t[0],n=t[1];this._bound_events[r]||(this._bound_events[r]=[]);let a=this._bound_events[r];if(Ee(a))a.push(n),e&&this.raise("add-event-listener",{name:r});else throw console.trace(),"Expected: array"}return this}remove_event_listener(e,t){let{event_events:s}=this;if(this._bound_events){let r=this._bound_events[e]||[];if(Ee(r)){let n=0,a=r.length,o=!1;for(;!o&&n<a;)r[n]===t?o=!0:n++;o&&(r.splice(n,1),s&&this.raise("remove-event-listener",{name:e}))}else throw console.trace(),"Expected: array"}return this}get bound_named_event_counts(){let e={};if(this._bound_events){let t=Object.keys(this._bound_events);$(t,s=>{e[s]=this._bound_events[s].length})}return e}one(e,t){let s=function(r){t.call(this,r),this.off(e,s)};this.on(e,s)}changes(e){this.map_changes||(this.map_changes={}),$(e,(t,s)=>{this.map_changes[s]=this.map_changes[s]||[],this.map_changes[s].push(t)}),this._using_changes||(this._using_changes=!0,this.on("change",t=>{let{name:s,value:r}=t;this.map_changes[s]&&$(this.map_changes[s],n=>{n(r)})}))}},ze=tt.prototype;ze.raise=ze.raise_event;ze.trigger=ze.raise_event;ze.subscribe=ze.add_event_listener;ze.on=ze.add_event_listener;ze.off=ze.remove_event_listener;var Ku=i=>{let e={},t=(n,a)=>{a===void 0&&typeof n=="function"&&(a=n,n=""),e[n]||(e[n]=[]),e[n].push(a)},s=(n,a)=>{if(e[n]){let o=e[n].indexOf(a);o>-1&&e[n].splice(o,1)}},r=(n,a)=>{let o=e[n];if(o!==void 0)if(a!==void 0){let l=o.length;for(let _=0;_<l;_++)o[_].call(i,a)}else{let l=o.length;for(let _=0;_<l;_++)o[_].call(i)}};return i.on=i.add_event_listener=t,i.off=i.remove_event_listener=s,i.raise=i.raise_event=r,i},Sr=class extends tt{constructor(e={}){super({}),this.one("ready",()=>{this.is_ready=!0})}get when_ready(){return new Promise((e,t)=>{this.is_ready===!0?e():this.one("ready",()=>{e()})})}},Ju={each:$,is_array:Ee,is_dom_node:_u,is_ctrl:Ra,clone:Cs,get_truth_map_from_arr:Tr,tm:Tr,get_arr_from_truth_map:hu,arr_trim_undefined:Va,get_map_from_arr:uu,arr_like_to_arr:Ma,tof:ie,atof:Br,tf:Se,load_type:du,is_defined:Lt,def:Lt,Grammar:Dr,stringify:mu,functional_polymorphism:Ya,fp:st,mfp:wu,arrayify:ku,mapify:Cu,str_arr_mapify:Pu,get_a_sig:ks,deep_sig:ft,get_item_sig:mt,set_vals:qu,truth:Au,trim_sig_brackets:pu,ll_set:ju,ll_get:Tu,iterate_ancestor_classes:Ia,is_arr_of_t:Fr,is_arr_of_arrs:Du,is_arr_of_strs:Ua,input_processors:Su,output_processors:Eu,call_multiple_callback_functions:Or,call_multi:dt,multi:dt,native_constructor_tof:Bu,Fns:zu,sig_match:Fu,remove_sig_from_arr_shell:Ou,to_arr_strip_keys:$a,arr_objs_to_arr_keys_values_table:Lu,set_arr_tree_value:Nu,get_arr_tree_value:Mu,deep_arr_iterate:Ga,prom:Ru,combinations:Ar,combos:Ar,Evented_Class:tt,eventify:Ku,vectorify:Mt,v_add:Uu,v_subtract:Wa,v_multiply:$u,v_divide:Gu,vector_magnitude:Xa,distance_between_points:Wu,get_typed_array:Fa,gta:Fa,Publisher:Sr},qs=new tt;Object.assign(qs,Ju);qs.note=(i,e,t)=>{t=t||{},t.name=i,t.state=e,qs.raise("note",t)};Pr.exports=qs;if(ye.main===Pr){let t=function(r){let n=e(),a=new tt;return r.forEach(o=>{let l=o.event_name,_=o.event_data,u=h=>{h===_?n.passed.push(l):n.failed.push(l)};a.on(l,u),a.raise_event(l,_)}),n};Qu=t;let i=[{event_name:"foo",event_data:"hello"},{event_name:"bar",event_data:"world"},{event_name:"baz",event_data:!0}],e=()=>({passed:[],failed:[]}),s=t(i);console.log("Passed:",s.passed),console.log("Failed:",s.failed)}var Qu});var _e=q((uy,Za)=>{var js=Ka(),{each:Ja,tof:ay}=js,Rt=class i{constructor(e={}){let t=e.name;Object.defineProperty(this,"name",{get(){return t}});let s=e.parent;Object.defineProperty(this,"parent",{get(){return s}});let r={name:!0,parent:!0},n={};Ja(e,(a,o)=>{r[o]||(n[o]=a)})}extend(e){return Object.assign({parent:this},e),new i(e)}},Ue=class i{constructor(e={}){let t=e.name;Object.defineProperty(this,"name",{get(){return t}});let s=e.parent;Object.defineProperty(this,"parent",{get(){return s}});let r={},n={name:!0};Ja(e,(a,o)=>{n[o]||(r[o]=a,Object.defineProperty(this,o,{get(){return r[o]},enumerable:!0}))})}extend(e){return Object.assign({parent:this},e),new i(e)}},Zu=new Rt({name:"color"}),ef=Zu.extend({bits:24}),Qa=ef.extend({components:["red byte","green byte","blue byte"]}),oy=new Ue({name:"string"}),ly=new Ue({name:"binary"}),cy=new Ue({signifier:Qa,bytes:[[0,"red","ui8"],[1,"green","ui8"],[2,"blue","ui8"]]}),_y=new Ue({signifier:Qa,bytes:[[0,"#","char"],[1,"hex(red)","string(2)"],[3,"hex(green)","string(2)"],[5,"hex(blue)","string(2)"]]}),tf=new Rt({name:"date",components:["day uint","month uint","year int"]}),hy=new Ue({signifier:tf,bytes:[[0,"#","char"],[1,"day","string(2)"],[3,"/","char"],[4,"month","string(2)"],[6,"/","char"],[7,"year","string(2)"]]});js.Type_Signifier=Rt;js.Type_Representation=Ue;Za.exports=js});var to=q((fy,eo)=>{var sf=function(i){var e={items:new Array(i),count:0,first:function(){if(this.count==0)throw"StiffArray.first()";return this.items[0]},last:function(){if(this.count==0)throw"StiffArray.last()";return this.items[this.count-1]},add:function(t){if(this.count>=i)throw"StiffArray.add()";this.items[this.count++]=t},add_from:function(t){if(this.count+t.count>i)throw"StiffArray.add_from()";for(var s=0;s<t.count;s++)this.items[this.count++]=t.items[s]},insert:function(t,s){if(t<0||t>this.count)throw"StiffArray.insert(): index";if(this.count>=i)throw"StiffArray.insert(): overflow";for(var r=this.count;r>t;r--)this.items[r]=this.items[r-1];this.items[t]=s,this.count++},removeAt:function(t){if(t<0||t>=this.count)throw"StiffArray.removeAt()";this.count--;for(var s=t;s<this.count;s++)this.items[s]=this.items[s+1]},removeFirst:function(){this.removeAt(0)},removeLast:function(){this.removeAt(this.count-1)},copy_from:function(t,s,r){for(var n=0;n<r;n++)this.items[n]=t.items[n+s];this.count=r},search_first:function(t){for(var s=this.count,r=0;s>0;){var n=Math.floor(s/2),a=r+n;this.items[a]<t?(r=a+1,s-=n+1):s=n}return r<this.count?{found:this.items[r]==t,index:r}:{found:!1,index:r}},search_last:function(t){for(var s=this.count,r=0;s>0;){var n=Math.floor(s/2),a=r+n;t>=this.items[a]?(r=a+1,s-=n+1):s=n}return r>0&&r<=this.count&&this.items[r-1]==t?{found:!0,index:r-1}:{found:!1,index:r}},search_last_prefix:function(t){for(var s=t.length,r=function(u){return s>u.length?!1:u.substr(0,s)==t},n=this.count,a=0;n>0;){var o=Math.floor(n/2),l=a+o,_=this.items[l];t>_||r(_)?(a=l+1,n-=o+1):n=o}return a>0&&a<=this.count&&r(this.items[a-1])?{found:!0,index:a-1}:{found:!1,index:a}},toString:function(){return this.items.slice(0,this.count).toString()}};return e};eo.exports=sf});var Mr=q((dy,io)=>{var Ts=to(),so=function(i){var e={isLeaf:!1,parent:null,keys:new Ts(i+1),children:new Ts(i+2)};return e},Lr=function(i){var e={isLeaf:!0,parent:null,keys:new Ts(i+1),values:new Ts(i+1),prevLeaf:null,nextLeaf:null};return e},Nr=(i,e,t)=>{t=!!t;var s=i!=null,r=e!=null,n=0;return t&&(typeof i!="string"?t=!1:n=i.length),{key:i,value:e,isPrefixSearch:t,leaf:null,index:-1,isKeyPresent:s,isValuePresent:r,foundKey:function(){return this.leaf.keys.items[this.index]},foundValue:function(){return this.leaf.values.items[this.index]},prefix_length:n,check_prefix:function(){if(!t||this.index>=this.leaf.keys.count)return!1;var a=this.foundKey();return this.prefix_length>a.length?!1:a.substr(0,this.prefix_length)==this.key}}},ro=function(i){if(i===void 0&&(i=10),i<4)throw"B_Plus_Tree(): node capacity must be >= 4";var e={root:new Lr(i),firstLeaf:null,lastLeaf:null,clear:function(){r()},insert:function(m,v){return arguments.length==2?_(m,v):_(m[0],m[1])},remove:function(m,v){if(arguments.length==2)return p(m,v);g(m)},findFirst:function(m,v){return S(m,v)},findFirstPrefix:function(m){return S(m,void 0,!0)},findNext:function(m){return Y(m)},findLast:function(m,v){return z(m,v)},findLastPrefix:function(m){return z(m,void 0,!0)},findPrevious:function(m){return W(m)},getValue:function(m){return C(m)},setValue:function(m,v){R(m,v)},count:function(m){return arguments.length==1?D(m):I()},getCapacity:function(){return t},each:function(m){return l(m)},keys:function(){return n()},keys_and_values:function(){return a()},get_by_prefix:function(m){return M(m)},get_keys_by_prefix:function(m){return H(m)},get_values_by_key:function(m){return ee(m)}};e.firstLeaf=e.root,e.lastLeaf=e.root;var t=i,s=Math.floor(t/2),r=function(){e.root=new Lr(t),e.firstLeaf=e.root,e.lastLeaf=e.root},n=function(){var m=[];return o(function(v){m.push(v)}),m},a=function(){var m=[];return l(function(v,w){m.push([v,w])}),m},o=function(m){for(var v=S();v!=null;){var w=v.foundKey();m(w),v=Y(v)}},l=function(m){for(var v=S(),w=!1;v!=null;){var x=v.foundKey(),A=v.foundValue();m(x,A,function(){w=!0}),w?v=null:v=Y(v)}},_=function(m,v){var w=re(m),x=w.node;x.keys.insert(w.index,m),x.values.insert(w.index,v),x.keys.count>t&&(x.prevLeaf!=null&&x.prevLeaf.keys.count<t&&x.prevLeaf.parent==x.parent?L(x.prevLeaf,x):x.nextLeaf!=null&&x.nextLeaf.keys.count<t&&x.nextLeaf.parent==x.parent?B(x,x.nextLeaf):u(x))},u=function(m){var v=s,w=m.keys.count-v,x=new Lr(t);if(x.parent=m.parent,x.keys.copy_from(m.keys,v,w),x.values.copy_from(m.values,v,w),m.keys.count=v,m.values.count=v,x.nextLeaf=m.nextLeaf,x.nextLeaf!=null&&(x.nextLeaf.prevLeaf=x),x.prevLeaf=m,m.nextLeaf=x,e.lastLeaf==m&&(e.lastLeaf=x),m.parent!=null){var A=P(m.parent,m);d(m.parent,x,x.keys.first(),A+1)}else h(m,x,x.keys.first())},h=function(m,v,w){var x=new so(t);x.keys.add(w),x.children.add(m),x.children.add(v),m.parent=x,v.parent=x,e.root=x},d=function(m,v,w,x){m.keys.insert(x-1,w),m.children.insert(x,v),v.parent=m,m.keys.count>t&&f(m)},f=function(m){var v=s,w=t-v,x=m.keys.items[v],A=new so(t);A.keys.copy_from(m.keys,v+1,w),A.children.copy_from(m.children,v+1,w+1),m.keys.count=v,m.children.count=v+1;for(var J=0;J<A.children.count;J++)A.children.items[J].parent=A;if(m.parent==null)h(m,A,x);else{var ve=P(m.parent,m);d(m.parent,A,x,ve+1)}},p=function(m,v){var w=K(m,v);return w.found?(b(w.node,w.index),!0):!1},g=function(m){for(;;){var v=re(m);if(!v.found)break;b(v.node,v.index)}},b=function(m,v){return m.keys.removeAt(v),m.values.removeAt(v),m.keys.count<s&&(m.prevLeaf!=null&&m.parent==m.prevLeaf.parent&&m.prevLeaf.keys.count>s?B(m.prevLeaf,m):m.nextLeaf!=null&&m.parent==m.nextLeaf.parent&&m.nextLeaf.keys.count>s?L(m,m.nextLeaf):k(m)),!0},k=function(m){if(m.parent!=null){var v=t+1,w=t+1;if(m.prevLeaf!=null&&m.prevLeaf.parent==m.parent&&(v=m.prevLeaf.keys.count),m.nextLeaf!=null&&m.nextLeaf.parent==m.parent&&(w=m.nextLeaf.keys.count),v<w){if(v+m.keys.count>t)throw"B_Plus_Tree.mergeLeaf(): leftCount";y(m.prevLeaf,m)}else{if(w+m.keys.count>t)throw"B_Plus_Tree.mergeLeaf(): rightCount";y(m,m.nextLeaf)}}},y=function(m,v){m.keys.add_from(v.keys),m.values.add_from(v.values),m.nextLeaf=v.nextLeaf,m.nextLeaf!=null&&(m.nextLeaf.prevLeaf=m),e.lastLeaf==v&&(e.lastLeaf=m);var w=v.parent,x=P(w,v);w.keys.removeAt(x-1),w.children.removeAt(x),w.keys.count<s&&T(w)},T=function(m){var v=m.parent;if(m.parent==null){m.keys.count==0&&(e.root=m.children.items[0],e.root.parent=null);return}var w=P(v,m),x=w>0?v.children.items[w-1]:null,A=w+1<v.children.count?v.children.items[w+1]:null;if(x!=null&&x.keys.count>s){V(x,m);return}if(A!=null&&A.keys.count>s){E(m,A);return}var J=t+1,ve=t+1;if(x!=null&&(J=x.keys.count),A!=null&&(ve=A.keys.count),J<ve){if(x==null)throw"B_Plus_Tree.mergeNode(): leftSibling";j(x,m,w)}else{if(A==null)throw"B_Plus_Tree.mergeNode(): rightSibling";j(m,A,w+1)}},j=function(m,v,w){for(var x=m.parent,A=0;A<v.children.count;A++)v.children.items[A].parent=m;m.keys.add(m.parent.keys.items[w-1]),m.keys.add_from(v.keys),m.children.add_from(v.children),x.keys.removeAt(w-1),x.children.removeAt(w),x.keys.count<s&&T(x)},S=function(m,v,w){var x=Nr(m,v,w);if(x.isKeyPresent){if(x.isPrefixSearch&&x.isValuePresent)throw"B_Plus_Tree.p_FindFirst(): arguments error: isPrefixSearch, but value is present";var A=x.isValuePresent?K(m,v):re(m);if(x.leaf=A.node,x.index=A.index,!A.found&&!x.check_prefix())return null}else{if(x.isValuePresent)throw"B_Plus_Tree.findFirst(): arguments error: key is not present, but value is present";if(x.leaf=e.firstLeaf,x.index=0,x.leaf.keys.count<=0)return null}return x},z=function(m,v,w){var x=new Nr(m,v,w);if(x.isKeyPresent){if(x.isPrefixSearch&&x.isValuePresent)throw"B_Plus_Tree.p_FindLast(): arguments error: isPrefixSearch, but value is present";if(x.isPrefixSearch){var A=F(m);if(x.leaf=A.node,x.index=A.index,!A.found)return null}else{var A=x.isValuePresent?te(m,v):Z(m);if(x.leaf=A.node,x.index=A.index,!A.found)return null}}else{if(x.isValuePresent)throw"B_Plus_Tree.findLast(): arguments error: key is not present, but value is present";if(x.leaf=e.lastLeaf,x.index=x.leaf.keys.count-1,x.index<0)return null}return x},U=function(m){return m.index++,m.index>=m.leaf.keys.count&&(m.leaf=m.leaf.nextLeaf,m.index=0),m.leaf!=null},Q=function(m){if(m.index--,m.index<0){if(m.leaf=m.leaf.prevLeaf,m.leaf==null)return!1;m.index=m.leaf.keys.count-1}return!0},Y=function(m){for(;;){if(!U(m))return null;if(m.isPrefixSearch){if(!m.check_prefix())return null}else if(m.isKeyPresent&&m.key!=m.foundKey())return null;if(m.isValuePresent){if(m.value==m.foundValue())return m}else return m}},W=function(m){for(;;){if(!Q(m))return null;if(m.isPrefixSearch){if(!m.check_prefix())return null}else if(m.isKeyPresent&&m.key!=m.foundKey())return null;if(m.isValuePresent){if(m.value==m.foundValue())return m}else return m}},ee=function(m){for(var v=[],w=S(m);w!=null;)v.push(w.foundValue()),w=Y(w);return v},M=function(m){for(var v=[],w=e.findFirstPrefix(m);w!=null;)v.push([w.foundKey(),w.foundValue()]),w=e.findNext(w);return v},H=function(m){for(var v=[],w=e.findFirstPrefix(m);w!=null;)v.push(w.foundKey()),w=e.findNext(w);return v},C=function(m){var v=re(m);return v.found?v.node.values.items[v.index]:null},R=function(m,v){var w=re(m);w.found&&b(w.node,w.index),_(m,v)},I=function(){for(var m=0,v=e.firstLeaf;v!=null;)m+=v.keys.count,v=v.nextLeaf;return m},D=function(m){for(var v=0,w=e.findFirst(m);w!=null;)v++,w=e.findNext(w);return v},E=function(m,v){var w=v.parent,x=P(w,v);m.keys.add(w.keys.items[x-1]),w.keys.items[x-1]=v.keys.first(),v.keys.removeFirst(),v.children.first().parent=m,m.children.add(v.children.first()),v.children.removeFirst()},V=function(m,v){var w=v.parent,x=P(w,v);v.keys.insert(0,w.keys.items[x-1]),w.keys.items[x-1]=m.keys.last(),m.keys.removeLast(),v.children.insert(0,m.children.last()),v.children.first().parent=v,m.children.removeLast()},L=function(m,v){var w=P(v.parent,v);m.keys.add(v.keys.first()),m.values.add(v.values.first()),v.keys.removeFirst(),v.values.removeFirst(),v.parent.keys.items[w-1]=v.keys.first()},B=function(m,v){var w=P(v.parent,v);v.keys.insert(0,m.keys.last()),v.values.insert(0,m.values.last()),m.keys.removeLast(),m.values.removeLast(),v.parent.keys.items[w-1]=v.keys.first()},P=function(m,v){var w=v.keys.first(),x=m.keys.search_first(w);if(!x.found){if(m.children.items[x.index]!=v)throw"B_PlusTree.calcChildIndex(): 1";return x.index}for(var A=x.index;;){if(m.children.items[A]==v)return A;if(A++,A>=m.children.count||m.keys.items[A-1]!=w)break}throw"B_PlusTree.calcChildIndex(): 2"},re=function(m){var v=function(w,x){var A=w.keys.search_first(x);if(w.isLeaf)return{node:w,found:A.found,index:A.index};if(A.found){var J=v(w.children.items[A.index],x);return J.found?J:v(w.children.items[A.index+1],x)}else return v(w.children.items[A.index],x)};return v(e.root,m)},Z=function(m){var v=function(w,x){var A=w.keys.search_last(x);if(w.isLeaf)return{node:w,found:A.found,index:A.index};if(A.found){var J=v(w.children.items[A.index+1],x);return J.found?J:v(w.children.items[A.index],x)}else return v(w.children.items[A.index],x)};return v(e.root,m)},F=function(m){var v=function(w,x){var A=w.keys.search_last_prefix(x);if(w.isLeaf)return{node:w,found:A.found,index:A.index};if(A.found){var J=v(w.children.items[A.index+1],x);return J.found?J:v(w.children.items[A.index],x)}else return v(w.children.items[A.index],x)};return v(e.root,m)},K=function(m,v){var w=re(m);if(!w.found)return w;for(var x=!1,A=w.node,J=w.index;;){if(J>=A.values.count){if(A=A.nextLeaf,A==null)break;J=0}if(A.keys.items[J]!=m)break;if(A.values.items[J]==v){x=!0;break}J++}return{node:A,found:x,index:J}},te=function(m,v){var w=Z(m);if(!w.found)return w;for(var x=!1,A=w.node,J=w.index;;){if(J<0){if(A=A.prevLeaf,A==null)break;J=A.values.count-1}if(A.keys.items[J]!=m)break;if(A.values.items[J]==v){x=!0;break}J--}return{node:A,found:x,index:J}};return e};ro.FindInfo=Nr;io.exports=ro});var As=q((Hy,ao)=>{var Vr=_e(),ne=Vr,rf=ne.Evented_Class,my=ne.each,gy=ne.is_array,py=ne.is_dom_node,vy=ne.is_ctrl,yy=ne.extend,xy=ne.get_truth_map_from_arr,by=ne.get_map_from_arr,wy=ne.arr_like_to_arr,ky=ne.tof,Rr=ne.is_defined,Cy=ne.stringify,qy=ne.functional_polymorphism,jy=ne.fp,Ty=ne.arrayify,Ay=ne.mapify,Dy=ne.are_equal,Sy=ne.get_item_sig,Ey=ne.set_vals,zy=ne.truth,By=ne.trim_sig_brackets,Fy=ne.ll_set,Oy=ne.ll_get,no=ne.input_processors,Py=ne.iterate_ancestor_classes,Ly=ne.is_arr_of_arrs,Ny=ne.is_arr_of_strs,My=ne.is_arr_of_t,Ry=Vr.clone,no=Vr.input_processors,Hr=class i extends rf{constructor(e){super(e),this.__data_value=!0,e&&e.context&&(this.context=e.context),e&&Rr(e.value)&&(this._=e.value),this.__type="data_value",this._relationships={}}get(){return this._}value(){return this._}toObject(){return this._}set(e){var t=no[this.__type_name];t&&(e=t(e));var s=this._;return this._=e,this.raise("change",{old:s,value:e}),e}toString(){return this.get()}toJSON(){var e=this.get(),t=typeof e;return t=="string"?'"'+e+'"':e}clone(){var e=new i({value:this._});return e}_id(){if(this.__id)return this.__id;if(this.context)this.__id=this.context.new_id(this.__type_name||this.__type);else if(!Rr(this.__id))throw"DataValue should have context";return this.__id}parent(){var e=arguments;e.l=arguments.length;var t=get_a_sig(e,1),s,r;if(e.l==0)return this._parent;if(e.l==1){s=e[0],!this.context&&s.context&&(this.context=s.context);var n=function(o){var l=s._id();o._relationships[l]=!0},a=function(o){o._parent=s};a(this)}e.l==2&&(s=e[0],r=e[1],!this.context&&s.context&&(this.context=s.context),this._parent=s,this._index=r),Rr(r)}};ao.exports=Hr});var Ir=q((Vy,oo)=>{var Yr=class{constructor(){var e=[],t={},s=function(){t={};for(var a=0,o=e.length;a<o;a++)t[e[a]]=a};this.has=function(a){return typeof t[a]<"u"},this.put=function(a){if(!this.has(a)){var o=e.length;e.push(a),t[a]=o}},this.out=function(a){if(this.has(a)){var o=t[a];e.splice(o,1),delete t[a];for(var l=o,_=e.length;l<_;l++){var u=e[l];t[u]--}}},this.toggle=function(a){this.has(a)?this.out(a):this.put(a)},this.move_value=function(a,o){if(this.has(a)&&t[a]!=o){var l=t[a];if(e.splice(l,1),e.splice(o,0,a),o<l){t[e[o]]=o;for(var _=o+1;_<=l;_++)t[e[_]]++}else if(o>l){t[e[o]]=o;for(var _=l;_<o;_++)t[e[_]]--}}},this._index_scan=function(){for(var a=0,o=e.length;a<o;a++)console.log("c "+a+" arr[c] "+e[a]+" idx "+t[e[a]])},this.toString=function(){var a=e.join(" ");return a},this.toString.stringify=!0,this.set=function(a){typeof a=="string"&&(e=a.split(" "),s())};var r=arguments;if(r.length==1){var n=r[0];typeof n=="string"&&this.set(n)}}};oo.exports=Yr});var Gr=q((mx,co)=>{var Ge=_e(),Ur=As(),se=Ge,nf=se.Evented_Class,Yy=se.Class,Ht=se.each,Iy=se.is_array,Uy=se.is_dom_node,$y=se.is_ctrl,Gy=se.extend,Wy=se.get_truth_map_from_arr,Xy=se.get_map_from_arr,Ky=se.arr_like_to_arr,Vt=se.tof,$e=se.is_defined,Jy=se.stringify,Qy=se.functional_polymorphism,Zy=se.fp,ex=se.arrayify,tx=se.mapify,sx=se.are_equal,rx=se.get_item_sig,lo=se.get_a_sig,ix=se.set_vals,nx=se.truth,ax=se.trim_sig_brackets,ox=se.ll_set,af=se.ll_get,lx=se.input_processors,cx=se.iterate_ancestor_classes,_x=se.is_arr_of_arrs,hx=se.is_arr_of_strs,ux=se.is_arr_of_t,fx=Ge.clone;Ge.__data_id_method="init";var dx=Ir(),$r=class{constructor(e){var t={},s=function(r){throw"stop Mini_Context typed id";var n};this.new_id=s}make(e){if(e._abstract){var t=e.constructor,s=e._spec;s.abstract=null,s.context=this;var r=new t(s);return r}else throw"Object must be abstract, having ._abstract == true"}},of=function(i){var e=Vt(i);return e=="number"||e=="string"||e=="boolean"||e=="array"},gt=class extends nf{constructor(e={},t){if(e=e||{},super(e),e.id&&(this.__id=e.id),e.__id&&(this.__id=e.__id),this.__type_name=e.__type_name||"data_object",t&&this.set_fields_from_spec(t,e),this.__data_object=!0,e.abstract===!0){this._abstract=!0;var s=Vt(e);s=="function"&&(this._type_constructor=e),s=="object"&&(this._spec=e)}else{var r=Vt(e);this.__type||(this.__type="data_object"),(r==="object"||r==="control")&&(e.context&&(this.context=e.context),e.id&&(this.__id=e.id),e._id&&(this.__id=e._id),e.__id&&(this.__id=e.__id)),r=="data_object"&&e.context&&(this.context=e.context),!$e(this.__id)&&Ge.__data_id_method=="init"&&this.context,$e(e.parent)&&(this.parent=e.parent),this.context&&this.init_default_events()}}set_fields_from_spec(e,t){let s=this;Ht(e,r=>{typeof t[r[0]]<"u"?s[r[0]]=t[r[0]]:s[r[0]]=r[2]})}init_default_events(){}keys(){return Object.keys(this._)}toJSON(){var e=[];return e.push("Data_Object("+JSON.stringify(this._)+")"),e.join("")}get parent(){return this._parent}set parent(e){return this._parent=e}_id(){if(this.__id)return this.__id;if(this.context)this.__id=this.context.new_id(this.__type_name||this.__type);else{if(this._abstract)return;if(!$e(this.__id))return}return this.__id}each(e){Ht(this._,e)}position_within(e){var t=e._id();if(this._parents&&$e(this._parents[t])){var s=this._parents[t],r=s[1];return r}}remove_from(e){var t=e._id();if(this._parents&&$e(this._parents[t])){var e=this._parents[t][0],s=this._parents[t][1],r=e._arr[s];e.remove(s),delete this._parents[t]}}load_from_spec(e,t){var s=this;Ht(t,function(r,n){var a=e[r];$e(a)&&s.set(r,a)})}get(){var e=arguments;e.l=arguments.length;var t=lo(e,1),s=!1;if(s)if(e.l===0){var r=Ge.output_processors[this.__type_name](this._);return r}else throw console.log("a",e),console.trace(),"not yet implemented";else{if(t=="[s,f]"){throw"Asyncronous access not allowed on Data_Object get.";var n,a}if(t=="[s]"){var n=af(this,e[0]);return n}else if(e.l===0)return this._}}set(){var e=arguments;e.l=arguments.length;var t=lo(e,1);if(this._abstract)return!1;var s=this,r,n=Ge.input_processors;if(e.l==2||e.l==3){var a=e[0],o=e[1],l=Vt(e[2]),_=!1,u;if((l=="string"||l=="boolean")&&(_=e[2]),l=="control"&&(u=e[2]),!this._initializing&&this._map_read_only&&this._map_read_only[a])throw'Property "'+a+'" is read-only.';var h=a.split(".");if(h.length>1&&a!="."){var d=h[0],f=h.slice(1),p=this.get(d);if(p){if(r=p.set(f.join("."),o),!_){var g={name:a,value:o,bubbled:!0};u&&(g.source=u),this.raise_event("change",g)}}else throw"No data object at this level."}else{var p=this.get(a);if(p){var b=this[a];b&&(p.__type_name=b[1]||p.__type_name),p.set(o)}if($e(p)){var T=of(p);if(T?(this[a]=o,r=o):(r=p,this[a]=p),!_){var g={name:a,value:p.value()};u&&(g.source=u),this.trigger("change",g)}return r}else{var k=typeof o,y;return k==="string"||k==="number"||k==="boolean"||k==="date"?y=new Ur({value:o}):k==="array"?y=new Ur({value:o}):k==="object"?o.__data_object||o.__data_value||o.__data_grid?y=o:y=new Ur({value:o}):y=o,this[a]=y,_||(g={name:a,value:y},u&&(g.source=u),this.raise_event("change",g)),o}}}else{var o=e[0],a=e[1],j=n[this.__type_name];if(j){var S=j(o);return o=S,this._[a]=o,this.raise_event("change",{value:o}),o}else{if(t==="[D]")return this._[a]=o,this.raise_event("change",[a,o]),o;if(t==="[o]")return r={},Ht(e[0],function(Q,Y){r[Y]=s.set(Y,Q)}),r;if(t==="[c]")return this._[a]=o,this.raise_event("change",[a,o]),o}}}has(e){return $e(this.get(e))}};Ge.map_classes=Ge.map_classes||{};var lf=(i,e)=>{var t=gt,s;e?s=new t({data_def:e}):s=new t({});var r=Vt(i);if(r=="object"){var n=s.set;Ht(i,(a,o)=>{n.call(s,o,a)})}return s};gt.dobj=lf;gt.Mini_Context=$r;co.exports=gt});var Wr=q((gx,_o)=>{var cf=_e(),_f=cf.mapify,hf=Mr(),Ds=class{constructor(e){e=e||{},typeof e.unique_keys<"u"&&(this.unique_keys=e.unique_keys),this.tree=hf(12)}clear(){this.tree.clear()}out(e){this.tree.remove(e)}get(e){return this.tree.get_values_by_key(e)}has(e){return this.key_count(e)>0}get_cursor(){}keys(){return this.tree.keys()}keys_and_values(){return this.tree.keys_and_values()}key_count(e){return typeof e<"u"?this.tree.count(e):this.tree.count()}get_keys_by_prefix(e){return this.tree.get_keys_by_prefix(e)}each(e){return this.tree.each(e)}get_by_prefix(e){return this.tree.get_by_prefix(e)}};Ds.prototype.put=_f(function(i,e){var t=this.tree.insert(i,e)});_o.exports=Ds});var Kr=q((xx,fo)=>{var it=_e(),uf=As(),Ut=Gr(),ff=Wr(),px=Ut.dobj,vx=Ut.Constraint,Yt=it.each,It=it.tof,Xr=it.is_defined,ho=it.stringify,rt=it.get_a_sig,df=it.native_constructor_tof,yx=Ut.prototype,Ss=class i extends Ut{constructor(e={},t){super(e),this.__type="collection",this.__type_name="collection";var s=It(e);if(e.abstract===!0)s==="function"&&this.constraint(e);else{if(this._relationships=this._relationships||{},this._arr_idx=0,this._arr=[],this.index=new ff,this.fn_index=e.fn_index,s==="array")e={load_array:e};else if(s==="function")e.abstract===!0&&(this._abstract=!0);else if(s==="string"){var r={array:Array,boolean:Boolean,number:Number,string:String,object:Object},n=r[e];n&&(e={constraint:n},n==String&&(e.index_by="value"))}Xr(e.items)&&(e.load_array=e.load_array||e.items),t&&(e.load_array=t),Xr(e.accepts)&&(this._accepts=e.accepts),it.__data_id_method==="init"&&this.context&&(this.__id=this.context.new_id(this.__type_name||this.__type),this.context.map_objects[this.__id]=this),this.__type,e.load_array&&this.load_array(e.load_array)}}set(e){var t=It(e);if(t=="data_object")return this.clear(),this.push(e);if(t==="array")this.clear(),Yt(e,(s,r)=>{this.push(s)});else{if(t==="collection")throw"stop";return this.super.set(e)}}clear(){this._arr_idx=0,this._arr=[],this.index.clear(),this.raise("change",{name:"clear"})}stringify(){var e=[];if(this._abstract){var t=df(this._type_constructor);e.push("~Collection("),t&&e.push(t),e.push(")")}else{e.push("Collection(");var s=!0;this.each(function(r,n){s?s=!1:e.push(", "),e.push(ho(r))}),e.push(")")}return e.join("")}toString(){return ho(this._arr)}toObject(){var e=[];return this.each(function(t,s){e.push(t.toObject())}),e}each(){var e=arguments;e.l=arguments.length;var t=rt(e,1);if(t=="[f]")return Yt(this._arr,e[0]);if(t=="[X,f]"){var s=e[0],r=e[1];return s.each(r)}else if(e.l==2)return Yt(this._arr,e[0],e[1])}_id(){return this.context&&(this.__id=this.context.new_id(this.__type_name||this.__type)),this.__id}length(){return this._arr.length}get len(){return this._arr.length}find(){var e=arguments;e.l=arguments.length;var t=rt(e,1);if(e.l==1){var s=this.index.get(e[0])[0],r=this._arr[s];return r}if(t=="[o,s]")return this.index_system.find(e[0],e[1]);if(t=="[s,s]")return this.index_system.find(e[0],e[1]);if(t=="[a,s]")return this.index_system.find(e[0],e[1]);if(t=="[s,o]"){var n=e[0],a=e[1],o=[];Yt(this,(_,u)=>{if(_.get)var h=_.get(n);else var h=_[n];var d=It(h),f,p;if(d==="data_value"){var p=h.value();f=It(p)}else p=h,f=d;f==="array"&&Yt(p,(g,b)=>{var k=obj_matches_query_obj(g,a);k&&o.push(g)})});var l=new i(o);return l}}get(){var e=arguments;e.l=arguments.length;var t=rt(e,1);if(t=="[n]"||t=="[i]")return this._arr[e[0]];if(t=="[s]"){var s=this.index_system,r;if(s){var n=s._primary_unique_index;r=n.get(e[0])[0]}return r||Ut.prototype.get.apply(this,e)}}insert(e,t){this._arr.splice(t,0,e),this.raise("change",{name:"insert",item:e,value:e,pos:t})}swap(e,t){let s=t.parent,r=t.parent.content.remove(t),n=e.parent,a=e.parent.content.remove(e),o;n.content.insert(t,a),s.content.insert(e,r)}remove(){var e=arguments;e.l=arguments.length;var t=rt(e,1);if(t=="[n]"){var s=e[0],r=this._arr[s],n=r,a=s;this._arr.splice(s,1),this._arr_idx--;for(var o=this._arr.length;s<o;){var r=this._arr[s];r.relationships[own_id]=[this,s],s++}var l={target:this,value:r,position:a,name:"remove"};return this.raise("change",l),s}else if(t=="[s]"){var _=e[0],u=this.index_system.find([["value",_]]),h=this.__id,d=u[0]._relationships[h];this._arr.splice(d,1);for(var f=d,p=this._arr.length;f<p;f++){var r=this._arr[f];r._relationships[h]--}var l={target:this,value:u[0],position:d,name:"remove"};this.raise("change",l)}else{let g,b=this._arr,k=b.length;if(typeof r=="number")g=r;else{let y=!1,T=0;for(;!y&&T<k;)y=b[T]===r,g=T,T++;if(Xr(g))return this.remove(g)}}}has(e){throw console.trace(),"NYI"}get_index(){var e=arguments;e.l=arguments.length;var t=rt(e,1);if(t==="[s]")return this.index_system.search(e[0])}index_by(){var e=arguments;e.l=arguments.length;var t=rt(e,1);console.log("Indexing not implemented (like this)"),console.trace()}push(e){let t=It(e),s=this.fn_index,r,n=!1,a;if(s&&(r=s(e),n=!0),t==="object"||t==="function"){a=this._arr.length,this._arr.push(e),this._arr_idx++;let o={target:this,item:e,value:e,position:a,name:"insert"};this.raise("change",o)}if(t==="collection"){a=this._arr.length,this._arr.push(e),this._arr_idx++;let o={target:this,item:e,value:e,position:a,name:"insert"};this.raise("change",o)}if(t==="data_object"||t==="control"){a=this._arr.length,this._arr.push(e),this._arr_idx++;let o={target:this,item:e,value:e,position:a,name:"insert"};this.raise("change",o)}if(t==="array"){let o=new i(e);a=this._arr.length,this._arr.push(o);let l={target:this,item:o,value:o,position:a,name:"insert"};this.raise("change",l)}if(t==="string"||t==="number"){let o=new uf({value:e});a=this._arr.length,this._arr.push(o);let l={target:this,item:o,value:o,position:a,name:"insert"};this.raise("change",l)}return n&&this.index.put(r,a),e}load_array(e){for(var t=0,s=e.length;t<s;t++)this.push(e[t]);this.raise("load")}values(){var e=arguments;e.l=e.length;var t=rt(e,1);if(e.l===0)return this._arr;var s=new Error().stack;throw"not yet implemented"}value(){let e=[];return this.each((t,s)=>{typeof t.value=="function"?e.push(t.value()):e.push(t)}),e}},uo=Ss.prototype;uo.add=uo.push;fo.exports=Ss});var Jr=q((bx,mo)=>{var qe=class{constructor(e){this.neighbours=e.neighbours||[],this.value=e.value}previous(){return this.neighbours[0]}next(){return this.neighbours[1]}},Es=class{constructor(e){this.first=null,this.last=null,this.length=0}each_node(e){for(var t=this.first,s=!0,r=function(){s=!1};t&&s;)e(t,r),t=t.neighbours[1]}each(e){this.each_node(function(t,s){e(t.value,s)})}remove(e){e.neighbours[0]?e.neighbours[0].neighbours[1]=e.neighbours[1]:this.first=e.neighbours[1],e.neighbours[1]?e.neighbours[1].neighbours[0]=e.neighbours[0]:this.last=e.neighbours[0],e.neighbours=[],e.parent==this&&(delete e.parent,this.length--)}insert_beginning(e){if(e instanceof qe)return this.first==null?(this.first=e,this.last=e,e.neighbours=[],e.parent!=this&&(e.parent=this,this.length++)):this.insert_before(e,this.first),e;var t=new qe({value:e});return this.insert_beginning(t)}insert_before(e,t){if(e instanceof qe)return e.neighbours=[t.neighbours[0],t],t.neighbours[0]==null?this.first=e:t.neighbours[0].neighbours[1]=e,t.neighbours[0]=e,e.parent!=this&&(e.parent=this,this.length++),e;var s=new qe({value:e});return this.insert_before(s,t)}insert_after(e,t){if(e instanceof qe)return e.neighbours=[t,t.neighbours[1]],t.neighbours[1]==null?this.last=e:t.neighbours[1].neighbours[0]=e,t.neighbours[1]=e,e.parent!=this&&(e.parent=this,this.length++),e;var s=new qe({value:e});return this.insert_after(s,t)}push(e){if(e instanceof qe){if(this.last==null)this.insert_beginning(e);else return this.insert_after(e,this.last);return e}else{var t=new qe({value:e});return this.push(t)}}};Es.Node=qe;mo.exports=Es});var po=q((wx,go)=>{var mf=Jr(),Qr=class{constructor(){this.dll=new mf,this.node_map={}}length(){return this.dll.length}put(e,t){return this.push(e,t)}get(e){var t=this.node_map[e];if(t)return t.value}push(e,t){var s=this.dll.push(t);s.key=e,this.node_map[e]=s}out(e){var t=this.node_map[e];delete this.node_map[e],this.dll.remove(t)}each(e){this.dll.each_node(function(t,s){e(t.key,t.value,s)})}values(){var e=[];return this.each(function(t,s){e.push(s)}),e}keys(){var e=[];return this.each(function(t,s){e.push(t)}),e}keys_and_values(){var e=[];return this.each(function(t,s){e.push([t,s])}),e}};go.exports=Qr});var jo=q((jx,qo)=>{var ge=_e(),gf=Kr(),We=ge,nt=We.each,Ce=We.tof,xo=We.atof,kx=We.is_defined,at=We.fp,bo=We.arrayify,pf=We.mapify,vf=We.get_item_sig,$t=function(i){var e=at(function(t,s){if(t.l>2){for(var r=t[0],n=1,a=t.l;n<a;n++)r=e(r,t[n]);return r}else{if(s=="[n,n]")return i(t[0],t[1]);var o=xo(t);if(o[0]=="array"){if(o[1]=="number"){var r=[],l=t[1];return nt(t[0],function(h,d){r.push(e(h,l))}),r}if(o[1]=="array"){if(o[0].length!=o[1].length)throw"vector array lengths mismatch";var r=[],_=t[1];return nt(t[0],function(h,d){r.push(e(h,_[d]))}),r}}}});return e},yf=function(i,e){return i+e},xf=function(i,e){return i-e},bf=function(i,e){return i*e},wf=function(i,e){return i/e},kf=$t(yf),wo=$t(xf),Cf=$t(bf),qf=$t(wf),ko=function(i){var e=Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2));return e},jf=function(i){var e=wo(i[1],i[0]);return ko(e)},Tf=function(i,e){var t=[],s=this;return nt(i,function(r,n){t.push(e.call(s,n))}),t},Af=function(i,e){var t={};return nt(i,function(s,r){s.match(e)&&(t[s]=r)}),t},Df=bo(function(i){var e,t=arguments,s=Ce(t[0]);return s==="string"?e=t[0]:s==="number"&&(e=t[0]+"px"),e}),Sf=bo(at(function(i,e){var t=/px$/,s;return e=="[s]"&&t.test(i[0])?s=parseInt(i[0]):s=i[0],s})),Ef=["left","top","right","bottom"],zf=function(i){var e=at(function(t,s){if(t.l==1){if(s=="[s]"){var r=t[0].split(" ");return r.length>1?e.call(this,r):i.call(this,t[0])}if(Ce(t[0])=="array"){var n={},a=this;return nt(t[0],function(o,l){n[l]=i.call(a,l)}),n}}});return e},vo=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Bf={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},Ff=function(i){i=i.toUpperCase();for(var e=i.length,t=0,s=1;e--;){var r=Bf[i.charAt(e)],n=r*s;t=t+n,s=s*16}return t},Zr=function(i){var e=Math.floor(i/16),t=i%16,s=vo[e],r=vo[t],n=s+r;return n},Of=function(i){var e=Zr(i[0]),t=e+Zr(i[1])+Zr(i[2]);return t},Pf=function(i){return"#"+Of(i)},zs={},Lf={number:function(i){return Ce(i)=="number"}},Cx=ge.extend,at=ge.fp,yo=ge.stringify,Ce=ge.tof,Nf={color:["indexed_array",[["red","number"],["green","number"],["blue","number"]]],oltrb:["optional_array",["left","top","right","bottom"]]};ge.data_types_info=Nf;var Mf=at(function(i,e){if(e=="[s]"){var t=i[0],s=/(#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2}))/,r=t.match(s);if(r){var n=ge.str_hex_to_int(r[2]),a=ge.str_hex_to_int(r[3]),o=ge.str_hex_to_int(r[4]),l=[n,a,o];return l}}});zs.optional_array=at(function(i,e){if(i.l==2){var t=i[0],s=i[1];if(Ce(s)=="array"){if(s.length<=t.length)return s}else return s}if(i.l==3){var t=i[0],r=i[1],s=i[2],n=ge.input_processors[r];if(Ce(s)=="array"){if(s.length<=t.length){var a=[];return nt(s,function(_,u){a.push(n(u))}),a}}else return n(s)}});zs.indexed_array=at(function(i,e){if(console.log("indexed_array sig",e),i.l==2){var t=i[0],s=i[1];if(Ce(s)=="array"&&s.length<=t.length)return s}if(i.l==3){var t=i[0],r=i[1],s=i[2],n=ge.input_processors[r];if(Ce(s)=="array"&&s.length<=t.length){var a=[];return nt(s,function(_,u){a.push(n(u))}),a}}});zs.n_units=function(i,e){if(Ce(e)=="number")return[e,i];if(Ce(e)=="string"){var t=/^(\d+)(\w+)$/,s=e.match(t);if(s)return[parseInt(s[1]),s[2]];if(t=/^(\d*\.\d+)(\w+)$/,s=e.match(t),s)return[parseFloat(s[1]),s[2]]}};var qx=ge.data_types_info.color;zs.color=function(i){var e;console.log("processing color input: "+yo(i));var t=vf(i,2);return t=="[s]"&&(e=Mf(i[0])),t=="[n,n,n]"&&(e=i),console.log("res "+yo(e)),console.log("color input_processors output",e),e};ge.output_processors.color=function(i){var e=ge.arr_rgb_to_css_hex_6(i);return e};var Co=function(){var i=arguments;if(i.length==1&&Ce(i[0])=="array")return Co.apply(this,i[0]);for(var e,t=0,s=i.length;t<s;t++){var r=i[t];t==0&&(e=new gf({context:r.context})),e.push(r)}var n=i[0].constructor,a=n.prototype,o;for(o in a){var l=Ce(a[o]);l=="function"&&function(_){_!="each"&&_!="get"&&_!="add_event_listener"&&(e[_]=function(){var u=arguments;e.each(function(h,d){h[_].apply(h,u)})})}(o)}return e},Rf=function(i){var e=[];for(var t in i)i[t]&&e.push(i[t]);return e},Hf=i=>{let e=new Uint32Array(i.length/2),t=new DataView(i.buffer),r=i.length/2,n=0;for(let a=0;a<r;a++)e[n++]=t.getUint32(a*4);return e},Vf=i=>{let e=new Uint16Array(i.length*2),t=new DataView(i.buffer),s=i.length,r=0;for(let n=0;n<s;n++)e[r++]=t.getUint16(n*4+2),e[r++]=t.getUint16(n*4);return console.log("res",e),e},Yf={Ui16toUi32:Hf,Ui32toUi16:Vf,vectorify:$t,v_add:kf,v_subtract:wo,v_multiply:Cf,v_divide:qf,vector_magnitude:ko,distance_between_points:jf,execute_on_each_simple:Tf,mapify:pf,filter_map_by_regex:Af,atof:xo,npx:Df,no_px:Sf,str_arr_mapify:zf,arr_ltrb:Ef,true_vals:Rf,validators:Lf,__data_id_method:"lazy",str_hex_to_int:Ff,arr_rgb_to_css_hex_6:Pf,group:Co};qo.exports=Yf});var xe=q((Tx,Ao)=>{var je=_e(),If=je.Evented_Class,Uf=Mr(),$f=Kr(),Gf=Gr(),Wf=As(),Xf=Jr(),Kf=po(),Jf=Ir(),Qf=Wr(),Zf=jo();je.util=Zf;je.B_Plus_Tree=Uf;je.Collection=$f;je.Data_Object=Gf;je.Data_Value=Wf;je.Doubly_Linked_List=Xf;je.Ordered_KVS=Kf;je.Ordered_String_List=Jf;je.Sorted_KVS=Qf;var To=new If;Object.assign(To,je);Ao.exports=To});var Bs=q((Ax,So)=>{var{tof:ed,Evented_Class:td}=xe(),Do=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"],[/'/g,"&#x27;"],[/\//g,"&#x2F;"]],sd=i=>{ed(i)=="data_value"&&(i=i.get());for(var e,t=0,s=Do.length;t<s;t++)e=Do[t],i=i.replace(e[0],e[1]);return i},ei=class extends td{constructor(e){e.__type_name=e.__type_name||"text_node",super(),typeof e=="string"&&(e={text:e}),e.nodeType=3,e=e||{},e.el?this.dom={el:e.el}:this.dom={},e.sibling_index&&(this.sibling_index=e.sibling_index),typeof e.text<"u"&&(this._text=e.text),this.on("change",t=>{this.dom.el&&(this.dom.el.nodeValue=t.value)})}activate(){this.__active||(this.__active=!0)}get text(){return this._text}set text(e){this._text=e,this.raise("change",{name:"text",value:e})}all_html_render(){return this.nx?this._text||"":sd(this._text||"")||""}};So.exports=ei});var ae=q((Dx,Bo)=>{var{each:pt,get_a_sig:Eo,def:ti,is_array:rd,tof:id,tf:zo}=_e(),Gt=i=>typeof i=="function",Fs=rd,nd=function(){let i={raise_change_events:!0},e=(a,o)=>{},t=(...a)=>{if(Eo(a)==="[a]")pt(a[0],l=>{n.apply(this,l)});else if(a.length>1)if(Fs(a[0])){let l=a.shift();pt(l,_=>{n.apply(this,[_].concat(item_params))})}else{let l,_,u,h,d=i.raise_change_events;if(a.length===2&&([l,_]=a),a.length===3&&(Gt(a[2])?[l,_,h]=a:[l,_,u]=a),a.length===4&&([l,_,u,h]=a),l!==void 0)Object.defineProperty(l,_,{get(){if(ti(l._))return l._[_]},set(f){let p=(l._=l._||{})[_],g;h?g=h(f):g=f,l._[_]=g,d&&l.raise("change",{name:_,old:p,value:g})}}),ti(u)&&((l._=l._||{})[_]=u);else throw"stop"}},s=(a,o,l,_)=>{let u={get:l,set:_,enumerable:!0,configurable:!1},h=zo(o);if(h==="a")pt(o,d=>Object.defineProperty(a,d,u));else if(h==="s")Object.defineProperty(a,o,u);else throw console.trace(),"Unexpected prop_name, must be array or string"},r=(a,o,l)=>{Object.defineProperty(a,o,{enumerable:!0,get:l})},n=(...a)=>{if(Eo(a)==="[a]")pt(a[0],l=>{n.apply(this,l)});else{if(a.length===2)if(Fs(a[1])){let l=a[0];pt(a[1],_=>{if(Fs(_))throw"NYI 468732";n(l,_)})}else if(id(a[1])==="string")[obj,prop_name]=a;else throw"NYI 468732b";if(a.length>2){if(Fs(a[0]))throw"stop";{let l,_,u,h,d,f,p,g=j=>{_=_||j.name||j.prop_name,h=j.fn_onchange||j.onchange||j.change,d=j.fn_transform||j.ontransform||j.transform,f=j.ready||j.on_ready,u=u||j.default_value||j.default};a.length===2&&([l,p]=a,g(p)),a.length===3&&(Gt(a[2])?[l,_,h]=a:a[2].change||a[2].ready?(g(a[2]),[l,_]=a):[l,_,u]=a),a.length===4&&(Gt(a[2])&&Gt(a[3])?[l,_,d,h]=a:Gt(a[3])?[l,_,u,h]=a:([l,_,u,p]=a,g(p))),a.length===5&&([l,_,u,d,h]=a);let b;typeof u<"u"&&(b=u);let k=j=>{let S;d?S=d(j):S=j,b=S},y=j=>{let S;d?S=d(j):S=j;let z=b;b=S,h&&h({old:z,value:b}),l.raise&&i.raise_change_events&&l.raise("change",{name:_,old:z,value:b})};ti(u)&&(b=u);let T=zo(_);if(T==="s")Object.defineProperty(l,_,{get(){return b},set(j){y(j)}});else if(T==="a"){let j=_.length,S;for(let z=0;z<j;z++)S=_[z],Object.defineProperty(l,S,{get(){return b},set(U){y(U)}})}else throw"Unexpected name type: "+T;f&&f({silent_set:k})}}}};return{opts:i,prop:n,field:t,read_only:r,ro:r,get_set:s,gs:s}};Bo.exports=nd()});var Oo=q((Sx,Fo)=>{var{deep_sig:si}=_e(),ad=i=>Object.prototype.toString.call(i)==="[object Arguments]",od=(i,e)=>{let t=e.i,s=e.o,r=function(){let n=arguments;if(n.length===2&&typeof n[1]=="function"){let[a,o]=n;ad(a)&&a.length===1&&(a=a[0]);let l=si(a),_=si(arguments),u=()=>{o({name:"exec-start"});let d=i.call(null,a);o({name:"exec-complete"});let f=si(d);s?s[f]?s[f].call(null,d,p=>{o({name:"complete",sig:p.sig,value:p.value})}):o({name:"complete",sig:f,value:d}):o({name:"complete",sig:f,value:d})},h=()=>{o({name:"complete",value:a,skipped:!0})};if(t){let d=!1;i.skip&&(d=i.skip(a)),d?h():i.map_sigs&&i.map_sigs[l]?u():t[l]?(o({name:"input-transform-start"}),t[l].call(null,a,f=>{let{name:p,sig:g,value:b,io_sigs:k}=f;if(p==="complete")a=b,f.name="input-transform-complete",o(f),u();else throw console.trace(),"NYI"})):u()}else u()}else throw"Expected args: normal_args, cb_transform_event"};return i.name&&(r.name=i.name),i.main&&(r.main=i.main),i.skip&&(r.skip=i.skip),r};Fo.exports=od});var No=q((Bx,Lo)=>{var{tf:ld,deep_sig:Ex,each:zx,def:cd}=_e(),Po=(i,e)=>{let t=ld(i);if(t==="A"){let s=i.length;for(let r=0;r<s;r++){let n=i[r];((a,o)=>{Po(a,l=>{l.arg_index=o,e(l)})})(n,r)}}else if(t==="s")e({name:"complete",t:"s",bytes:i.length*2});else if(t==="o")e({name:"complete",t:"o"});else if(t==="R"){let s=i,r=0,n=Date.now(),a,o,{headers:l}=i;l&&l["content-length"]&&(a=parseInt(l["content-length"],10),o=a);let _={name:"available",t:"R",ms:n,headers:l};cd(a)&&(_.content_length=a),e(_),s.on("data",u=>{r+=u.length,o-=u.length;let h=Date.now(),d=h-n,f=r/(d/1e3),p=o/f*1e3,g=r/a,b=h+p;e({name:"data",t:"B",bytes:u.length,bytes_total:r,byte_rate:f,content_length:a,bytes_remaining:o,ms_est_remaining:p,ms_est_complete:b,ms_taken:d,proportion:g})}),s.on("end",()=>{let u=Date.now(),h=u-n,d=r/(h/1e3);e({name:"complete",ms:u,ms_taken:h,t:"R",bytes:r,byte_rate:d})}),s.on("error",u=>{e({name:"error",value:u,t:"R"})})}else if(t==="B")e({name:"complete",t:"B",bytes:i.length});else if(t==="a")e({name:"complete",t:"a"});else throw console.log("ti",t),console.trace(),"stop"};Lo.exports=Po});var Ho=q((Fx,Ro)=>{var{deep_sig:Mo}=_e(),_d={O:(i,e)=>{i.then(t=>{let s=Mo(t);e&&e({name:"complete",io_sigs:["O",s],sig:s,value:t})},t=>{})},p:(i,e)=>{i.then(t=>{let s=Mo(t);e&&e({name:"complete",io_sigs:["p",s],sig:s,value:t})},t=>{})},R:(i,e)=>{let t=[],s=Date.now();i.on("data",r=>{t.push(r)}),i.on("end",()=>{let r=Date.now(),n=Buffer.concat(t),a=r-s,o=n.length/(a/1e3);e&&e({name:"complete",sig:"B",io_sigs:["R","B"],value:n,bytes:n.length,ms:r,ms_taken:a,byte_rate:o})}),i.on("error",r=>{console.log("error reading stream for param transformation in stages()"),error(r)})}};Ro.exports=_d});var yt=q((Lx,ni)=>{var{each:Os,Evented_Class:ri,get_a_sig:Wt,get_truth_map_from_arr:Ox,tof:hd,tf:Uo,mfp:ud,deep_sig:Px,clone:Vo,def:Ps}=_e(),ii=Oo(),pe=()=>{},fd=(i,e,t,s)=>(i.on("next",e),i.on("complete",t),i.on("error",s),i),Yo=No(),dd={init:!0,ok:!0,complete:!0,error:!0,paused:!0},be=function(i,e){let t=arguments,s=t.length,r=Wt(t),n,a;if(r==="[f]"||r==="[f,u]")n={},a=t[0];else if(r==="[f,o]")a=t[0],n=t[1];else if(r==="[o,f]")n=t[0],a=t[1];else{if(r==="[O]"||r==="[O,u]")return t[0];throw console.log("sig",r),console.trace(),"NYI"}return((l,_)=>{let u=Date.now(),h=()=>Date.now()-u,d=new ri,f=d.io=new ri,p=[],g="init";Object.defineProperty(d,"ms_start",{value:u,writable:!1});let b,k,y,T,j,S,z={},U={},Q=-1,Y="init",W=D=>{let E=[Date.now(),D];p.push(E),d.raise("log",E)},ee=(D,E)=>{if(dd[D]){let V=g;U[D]||(U[D]=Date.now()),z[D]=E,g=D,d.raise("status",{old:V,value:D,data:E})}else throw console.trace(),W("str_status",D),"invalid str_status "+D},M,H;Object.defineProperty(d,"log",{get(){return p}}),Object.defineProperty(d,"status",{get(){return g}});let C=!1,R=!1,I=!1;return setTimeout(()=>{let[D,E,V]=_(L=>{let B=!0;if(C=!0,!R&&!I){if(this.filters){for(let P of this.filters)if(B=P(L),!B)break}}else R&&console.warn('Observable can not raise "next" event after having raised its "complete" event.'),I&&console.warn('Observable can not raise "next" event after having raised its "error" event.');B&&(d.raise("next",L),d.raise("data",L))},L=>{if(!R&&!I){R=!0;let B=Uo(L),P=Date.now();d.ms_complete=P,d.ms_taken=P-u,B!=="u"?B==="R"?(f.ongoing=!0,L.on("complete",()=>{f.ongoing=!1,f.raise("complete")})):(d.raise("complete",L),f.raise("complete")):d.raise("complete")}else R&&console.warn('WARNING: Observable can not raise "complete" event after having raised it already.'),I&&console.warn('WARNING: Observable can not raise "complete" event after having raised its "error" event.')},L=>{!R&&!I?(I=!0,d.raise("error",L)):(R&&console.warn('WARNING: Observable can not raise "error" event after having raised its "complete" event.'),I&&console.warn('WARNING: Observable can not raise "error" event after having raised it already.'))},ee,W)||[];D&&(d.stop=D),E&&(d.pause=E),V&&(d.resume=V),E&&V&&(d.delay=L=>{E(),d.raise("paused"),setTimeout(()=>{d.resume(),d.raise("resumed")},L)})},0),d.next=D=>(d.on("next",D),d),d.data=d.next,d.complete=D=>(d.on("complete",D),d),d.on("complete",D=>{ee("complete");let E=()=>{D&&(D.data?d.res=D.data:d.res=D)}}),d.done=d.end=d.complete,d.error=D=>(d.on("error",D),d),d.then=D=>{let E=[];d.next(V=>{E.push(V),C=!0}),d.completed?d.singular_result?D(E[0]):D(E):d.complete(V=>{C&&E.length>0?d.singular_result?D(E[0]):D(E):D(V)})},d.__type_name="observable",d._is_obs=d._is_observable=!0,d._=new ri,d.meta=(D,E)=>{E===void 0||(d._[key]=value,d._.raise("change",{key:D,value:E}))},d})(n,a)};be._={name:"observable",return_type:"observable",async:!0};var md=(i,e)=>be((t,s,r)=>{i.on("next",n=>{e(n)&&t(n)}),i.on("complete",n=>{n?s(n):s()}),i.on("error",n=>{r(n)})}),gd=(i,e)=>be((t,s,r)=>{i.on("next",n=>t(e(n))),i.on("complete",s),i.on("error",r)}),pd=(i,e)=>{let t,s,r,n=hd(e);return n==="array"?[t,s,r]=e:n==="object"&&(t=e.next,s=e.complete,r=e.error),be((a,o,l)=>{t?i.on(t,a):i.on("next",a),s?i.on(s,o):i.on("complete",o),r?i.on(r,l):i.on("error",l)})},vd=(i,e,t)=>(i.on("next",s=>{let r=e(s);t.push(r)}),i),yd=()=>{throw console.trace(),"out of order"},Io=i=>be((e,t,s)=>{let r=0,n,a=()=>{if(r<i.length){let u=i[r];n=u[1].apply(u[0],u[2]),n.on("next",h=>{e(h)}),n.on("error",h=>{h(h)}),n.on("complete",h=>{r++,a()})}else t()};return a(),[()=>{n.stop(),t()},()=>{n.pause()},()=>{n.resume()}]}),xd=(i,e)=>{let t=be(i),s=[];t.on("next",r=>s.push(r)),t.on("error",r=>e(r)),t.on("complete",r=>{typeof r<"u"?e(null,r,s):e(null,s)})},bd=i=>be((e,t,s)=>(i.on("next",r=>{if("unpaged"in r){let n=r.unpaged;for(let a=0,o=n.length;a<o;a++)e(n[a])}else for(let n=0,a=r.length;n<a;n++)e(r[n])}),i.on("complete",()=>{t()}),i.on("error",r=>s(r)),[])),$o=(i,e,t)=>{if(e)xd(i,e);else return be(i,t)},wd=(i,e)=>{let t,s;typeof i[i.length-1]=="function"?(t=Array.prototype.slice.call(i,0,-1),s=i[i.length-1]):typeof i[i.length-1]>"u"?t=Array.prototype.slice.call(i,0,-1):t=Array.prototype.slice.call(i);let r=Wt(t),n=be((a,o,l)=>e(t,r,a,o,l,t.length));return $o(n,s)},kd=(i,e)=>{if(typeof e<"u")i(e);else return new Promise((t,s)=>{i((r,n)=>{r?s(r):t(n)})})},Cd=(i,e)=>{let t;if(i instanceof Promise?t=i:t=new Promise(i),e)t.then(s=>{e(null,s)},s=>{e(s)});else return t},qd=i=>i instanceof Promise?i:new Promise(i),jd=i=>i.is_obs===!0,Td=i=>i instanceof Promise||i.is_obs===!0,Ad=(i,e,t,s,r)=>i.is_obs===!0?e(i):i instanceof Promise?t(i):Array.isArray(i)?s(i):r(i),vt=Ho(),Dd={R:vt.R},Go=ud({name:"stages",return_type:"function"},function(){let i=arguments,e=i.length,t=Wt(i),s,r,n,a=f=>(g=>{let b={_raise_stage_event:!0},k=[],y={},T=0,j;return Os(g,(S,z)=>{b[z]||(y[z]=S,T++,j=z)}),Os(y,(S,z)=>{let U=z===j,Q=S.map_sigs;if(Object.keys(S).length===0){let Y={};U||(Y.o={p:vt.p});let W=ii(S,Y);W.name=z,k.push([z,W])}else if(Q){let Y={i:Dd};Y.o={p:vt.p,O:vt.O};let W=ii(S,Y);W.name=z,k.push([z,W])}else{let Y={};Y.o={p:vt.p,O:vt.O};let W=ii(S,Y);W.name=z,k.push([z,W])}}),k})(f),o=()=>{if(t==="[a]")valid=!0,Os(i[0],f=>{if(Wt(f)==="[s,f]"){let[p,g]=f;g.name||(g.name=p)}else throw valid=!1,console.trace(),"expected stage to be specified as an array [s,f]"}),valid&&(s=a(i[0]),r=s.length);else if(t==="[o]")input_ofns(i[0]);else if(t==="[f]")s=a(i[0]()),r=s.length;else throw console.trace(),"stages expected an array or object (may become more flexible in the future)"},l=Date.now(),_=o(),u=Date.now()-l;if(_)return pe("ms_prep_time",u),_;let h=new Array(s.length);return Os(s,(f,p)=>{let g=f[0];h[p]={name:g}}),(()=>{let f=function(){let p=arguments,g=p.length,b=Wt(p),k=p.length===0?void 0:p,y=be((T,j,S,z,U,Q)=>{let Y=[];y.log_stage_events=Y;let W={},ee,M=0,H=(F,K)=>{K=K||{name:F};let te=Date.now();K.ms=te,K.i_stage=M,K.stage_name=D[M][0],ee&&(K.ms_since_last=te-ee),ee=te,Y.push(K),W[F]=K,F==="have-response"&&(y.ms_latency=te-W["make-request"].ms),y.raise("stage",K)},C=Date.now(),R=i[0](H),D=a(R),E=Date.now()-C;U("reprep_time",E);let V=y.input={},L=y.output={},B=y.stages=Vo(h);Yo(p,F=>{let K=F.name});let P=-1,re=!1,Z=()=>{let F=!!D[M],K=M;if(U("have_next_stage",F),F){let te=D[M][0],m=D[M][1],v=m.main===!0,w=M===D.length-1,x=B[M],A=B[M-1],J=B[M+1];x.ms_start=Date.now(),v&&(x.main=!0);let ve,O=()=>{let ke=M;console.log("calling exec_fn "+te),console.trace();let qr=m.call(this,ve,Ie=>{let{name:De,sig:Aa,value:G}=Ie;if(De==="complete"){if(Ie.skipped===!0)x.skipped=!0;else{ke>P&&(P=ke);let oe;Yo(G,de=>{let et=Vo(de),le=de.name;if(le==="complete"){console.log("c",M),console.log("stage item complete");let ue=Date.now(),ce=ue-x.ms_start;if(x.ms_output_complete=ue,x.ms_output_start){let me=x.ms_output_taken=ue-x.ms_output_start;if(me>0&&x.bytes_out){let jr=x.bytes_out/(me/1e3);x.output_rate=jr,v&&(y.main_rate=jr)}}x.ms_taken=ce,console.log("c",M),console.log("i_stage",ke),console.log("is_last_stage",w)}else if(le==="available")de.content_length&&(x.content_length=de.content_length,v&&(oe=y.content_length=de.content_length)),x.ms_output_start=Date.now();else if(le==="data"){let{bytes:ue,bytes_total:ce,byte_rate:me,content_length:jr,bytes_remaining:Da,ms_est_remaining:Sa,ms_est_complete:Ea,ms_taken:ou,proportion:za}=de,ty=ou,Ba=me;x.bytes_out=ce,x.bytes_in&&(x.bytes_oi_ratio=x.bytes_out/x.bytes_in),v&&(y.main_bytes_out=ce,y.main_output_rate=Ba),P===ke&&(y.bytes_out=ce,y.output_rate=Ba,Ps(za)&&(y.proportion=za),Ps(Da)&&(y.bytes_remaining=Da),Ps(Sa)&&(y.ms_est_remaining=Sa),Ps(Ea)&&(y.ms_est_complete=Ea)),J&&(J.bytes_in=J.bytes_in||0,J.bytes_in+=et.bytes)}else throw U("event_name",le),console.trace(),"stop"})}k=G,M++,U("pre process next stage"),Z()}else if(U("transform_call_event",Ie),De==="input-transform-complete"){let oe=Date.now();x.ms_input_transform_complete=oe,x.ms_input_transform_taken=oe-x.ms_input_transform_start}else if(De==="input-transform-start")x.ms_input_transform_start=Date.now();else if(De==="exec-start")x.ms_exec_start=Date.now();else if(De==="exec-complete"){let oe=Date.now();x.ms_exec_complete=oe,x.ms_exec_taken=oe-x.ms_exec_start}else throw U("name",De),U("transform_call_event",Ie),console.trace(),"stop"})};ve=k,U("pre exec_fn"),O()}else{let te=Uo(k);M++,U("tsr",te),console.log("the stages exec is complete"),console.log("i_last_unskipped_stage",P),re=!0,j(k)}};Z()});return y};return f.is_staged=!0,f.return_type="observable",f})()});ni.exports={observable:be,nce:fd,obs:be,obsalias:pd,obscollect:vd,obsfilter:md,obspool:yd,obsmap:gd,seq:Io,sequence:Io,sig_obs_or_cb:wd,cb_to_prom_or_cb:kd,prom_or_cb:Cd,prom:qd,obs_or_cb:$o,unpage:bd,is_obs:jd,is_prom:Td,obs_prom_arr_item:Ad,stages:Go};if(ye.main===ni){console.log("running fnl as main");let e=(()=>be((a,o,l)=>{let _=2,u=!1,h=()=>{clearInterval(f)},d=()=>{clearInterval(f),o()},f=setInterval(()=>{if(!u){let p=_*2;a({v:p}),_++,_>6&&(l(new Error("A problem")),h()),_>8&&d()}},1e3);return[d,()=>{u=!0},()=>{u=!1}]}))();(()=>{e.on("paused",()=>pe("* paused")),e.on("resumed",()=>pe("* resumed")),e.on("error",a=>pe("* error",a)),e.next(a=>{pe("data",a)})})();let s=()=>{(async()=>{let a=await e;pe("awaited res",a)})()};pe("stages",Go);let r=()=>{e.on("paused",()=>pe("* paused")),e.on("resumed",()=>pe("* resumed"));let[a,o]=e.split(l=>l.v%3===0);a.on("next",l=>pe("obs1 data",l)),o.on("next",l=>pe("obs2 data",l))},n=()=>{e.filter(a=>a.v!==8).filter(a=>a.v%3!==0),e.next(a=>{a===8&&(e.delay(5e3),e.pause(),pe("paused"),setTimeout(()=>{pe("wait over"),e.resume()},2e3))}).end(()=>{pe("end")})}}});var Jo=q((Vx,ci)=>{var Be=xe(),Mx=ae(),Sd=Be.get_a_sig,Xe=Be.each,Rx=Be.clone,Ms=Be.Evented_Class,Ed=Be.Data_Object,zd=Be.Collection,we=Be.tof,Wo=Be.stringify,Bd=Bs(),{prop:Ls,field:Hx}=ae(),Ns=(i,e,t,s)=>{let r;var n=we(t);if(n==="number")r=t+"px";else if(n==="string"){var a=t.match(/(\d*\.?\d*)(.*)/);a.length===2?r=t+"px":r=t}return r},Xo={width:Ns,height:Ns,left:Ns,top:Ns},Fd=()=>{let i=new Ms({});i.__empty=!0,i.toString=()=>{var t=[],s=!0;return Xe(i,(r,n)=>{typeof r!=="function"&&n!=="toString"&&n!=="__empty"&&n!=="_bound_events"&&n!=="on"&&n!=="subscribe"&&n!=="raise"&&n!=="trigger"&&n!=={}&&(s?s=!1:t.push(" "),t.push(n+": "+r+";"))}),t.join("")};var e=new Proxy(i,{set:(t,s,r,n)=>{let a;t.__empty=!1;var o=t[s];return Xo[s]?a=t[s]=Xo[s](t,s,r,n):a=t[s]=r,i.raise("change",{key:s,name:s,old:o,new:r,value:r}),a},get:(t,s,r)=>t[s]});return e},ai=class extends Ms{constructor(e){super(e),this.style=Fd(),this.style.on("change",t=>{this.raise("change",{property:"style",key:"style",name:"style",value:this.style.toString()})})}},oi=class extends Ms{constructor(){super();var e=new ai,t=this.attrs=this.attributes=new Proxy(e,{set:(s,r,n,a)=>{if(r==="style"){var o=we(n);if(o==="string"){var l=n.trim().split(";"),_;Xe(l,h=>{_=h.split(":"),_.length===2&&(_[0]=_[0].trim(),_[1]=_[1].trim(),s.style[_[0]]=_[1])}),e.raise("change",{property:r})}}else{var u=s[r];s[r]=n,e.raise("change",{key:r,name:r,old:u,new:n,value:n})}return!0},get:(s,r,n)=>s[r]})}},li=class extends Ms{constructor(e={}){super(e);let t,s;Object.defineProperty(this,"color",{get(){return t},set(r){let n=t;t=r,this.raise("change",{name:"color",old:n,new:t,value:t})},enumerable:!0,configurable:!0})}set(e){}},Xt=class i extends Ed{constructor(e={},t){e.__type_name=e.__type_name||"control",super(e,t),e.id&&(this.__id=e.id),e.__id&&(this.__id=e.__id),this.mapListeners={},this.__type="control";var s;let r=this.dom=new oi;Ls(this,"background",new li,_=>{let{value:u}=_}),this.background.on("change",_=>{_.name==="color"&&(r.attributes.style["background-color"]=_.value)}),Ls(this,"disabled",!1),Ls(this,"size",e.size,_=>{let{value:u,old:h}=_,[d,f]=u,p=this.dom.attrs.style;p.width=d,p.height=f,this.raise("resize",{value:u})}),Ls(this,"pos",e.pos,_=>{let{value:u,old:h}=_;u.length===2&&h&&h.length===3&&(u=[u[0],u[1],h[2]],this.pos=u);let[d,f]=u,p={left:d,top:f};this.style(p),this.raise("move",{value:u})}),this.on("change",_=>{_.name==="disabled"&&(_.value===!0?this.add_class("disabled"):this.remove_class("disabled"))});let n=e.tagName||e.tag_name||"div";r.tagName=n;var a=this.content=new zd({});if(s=e.content,s){var o=we(s);o==="array"?Xe(e.content,_=>{a.add(_)}):(o==="string"||o==="control")&&a.add(s)}e.el&&(r.el=e.el,e.el.tagName&&(r.tagName=e.el.tagName.toLowerCase()));var l=this.context||e.context;l&&l.register_control&&l.register_control(this),e.class&&this.add_class(e.class),e.hide&&this.hide(),e.add&&this.add(e.add),e.attrs&&(this.dom.attributes=e.attrs)}hide(){let e={cancelDefault:!1};this.raise("hide",e),e.cancelDefault||this.add_class("hidden")}show(){let e={cancelDefault:!1};this.raise("show",e),e.cancelDefault||this.remove_class("hidden")}get html(){return this.all_html_render()}get internal_relative_div(){return this._internal_relative_div||!1}set internal_relative_div(e){var t=this._internal_relative_div;this._internal_relative_div=e}get color(){return this.background.color}set color(e){this.background.color=e}post_init(e){e&&e.id===!0&&(this.dom.attrs.id=this._id())}has(e){for(var t=e.split("."),s=0,r=t.length,n=this,a;s<r;){if(a=t[s],typeof n[a]>"u")return!1;n=n[a],s++}return n}renderDomAttributes(){this.beforeRenderDomAttributes&&this.beforeRenderDomAttributes();var e=this.dom.attributes;if(e){if(this._)for(var t=Object.keys(this._),l,s=0,r=t.length;s<r;s++)l=t[s],l!=="_bound_events"&&(l instanceof i?(this._ctrl_fields=this._ctrl_fields||{})[l]=this._[l]:(this._fields=this._fields||{},this._fields[l]=this._[l]));if(this._ctrl_fields){for(var n={},t=Object.keys(this._ctrl_fields),l,s=0,r=t.length;s<r;s++)l=t[s],l!=="_bound_events"&&(n[l]=this._ctrl_fields[l]._id());let p=Wo(n).replace(/"/g,"'");p.length>2&&(e["data-jsgui-ctrl-fields"]=p)}if(this._fields){let d=Wo(this._fields).replace(/"/g,"'");d.length>2&&(e["data-jsgui-fields"]=d)}var a=[];this._id()!==void 0&&a.push(' data-jsgui-id="'+this._id()+'"');let h={html:!0,head:!0,body:!0};this.context&&this.__type_name&&!h[this.__type_name]&&this.__type_name!==void 0&&a.push(' data-jsgui-type="'+this.__type_name+'"');for(var o=Object.keys(e),l,_,s=0,r=o.length;s<r;s++)if(l=o[s],l!="_bound_events")if(l==="style"){if(_=e[l],typeof _!="function")if(typeof _=="object")if(l==="style"){let p=[];Xe(_,(g,b)=>{if(typeof g!=="function"&&b!=="__empty"){let y=b+":"+g;p.push(y)}}),p.length>0&&a.push(" ",l,'="',p.join(";"),'"')}else throw console.trace(),"NYI";else{let p=_.toString();!_.__empty&&p.length>0&&a.push(" ",l,'="',p,'"')}}else _=e[l],_&&_.toString&&a.push(" ",l,'="',_.toString(),'"');return a.join("")}else throw"expecting dom_attrs"}renderBeginTagToHtml(){let e=this.dom.tagName;var t;return e===!1?t="":t=["<",e,this.renderDomAttributes(),">"].join(""),t}renderEndTagToHtml(){var e;let t=this.dom.tagName,s=this.dom.noClosingTag;return t===!1||s?e="":e=["</",t,">"].join(""),e}renderHtmlAppendment(){return this.htmlAppendment||""}renderEmptyNodeJqo(){return[this.renderBeginTagToHtml(),this.renderEndTagToHtml(),this.renderHtmlAppendment()].join("")}register_this_and_subcontrols(){let e=this.context;this.iterate_this_and_subcontrols(t=>{e.register_control(t)})}iterate_subcontrols(e){this.content.each(s=>{e(s),s&&s.iterate_subcontrols&&s.iterate_subcontrols(e)})}iterate_this_and_subcontrols(e){e(this);let t=this.content,s;typeof t!="string"&&t.each(r=>{s=we(r),s=="string"||s=="data_value"||r&&r.iterate_this_and_subcontrols&&r.iterate_this_and_subcontrols(e)})}all_html_render(e){if(e){var t=[];if(this.iterate_this_and_subcontrols(a=>{a.__status=="waiting"&&t.push(a)}),t.length==0)e(null,this.all_html_render());else{var s=t.length,r=()=>{this.pre_all_html_render();var a=this.dom;a&&e(null,[this.renderBeginTagToHtml(),this.all_html_render_internal_controls(),this.renderEndTagToHtml(),this.renderHtmlAppendment()].join(""))};Xe(t,(a,o)=>{a.on("ready",l=>{s--,s==0&&r()})})}}else{this.pre_all_html_render();var n=this.dom;if(n)return[this.renderBeginTagToHtml(),this.all_html_render_internal_controls(),this.renderEndTagToHtml(),this.renderHtmlAppendment()].join("")}}render_content(){var e=this.content;if(we(e)==="string")return e;var t=e.length(),s=new Array(t),r,n,a=e._arr,o,l=a.length,_;for(o=0;o<l;o++)if(_=a[o],r=we(_),r==="string")s.push(Be.output_processors.string(_));else if(r==="data_value")s.push(_._);else{if(r==="data_object")throw"stop";s.push(_.all_html_render())}return s.join("")}all_html_render_internal_controls(){return this.render_content()}render(){return this.all_html_render()}pre_all_html_render(){}compose(){}visible(e){this.style("display","block",e)}transparent(e){this.style("opacity",0,e)}opaque(e){return this.style({opacity:1},e)}remove(){let{parent:e}=this;e.content.remove(this)}add(e){let t=we(e),s;if(t==="array"){let n=[];Xe(e,a=>{n.push(this.add(a))})}else if(e){t==="string"?e=new Bd({text:e,context:this.context}):e.context||this.context&&(e.context=this.context);var r=this.inner_control;r?s=r.content.add(e):s=this.content.add(e),e.parent=this}return s}insert_before(e){let t=e.parent,s=e._index;t.content.insert(this,s)}style(){let e=arguments,t=Sd(e,1);e.l=e.length;let s=this.dom,r=s.attrs;var n,a,o=!0;if(t=="[s]"){n=e[0];var l=getComputedStyle(s.el)[n];return l}t=="[s,s,b]"&&([n,a,o]=e),(t=="[s,s]"||t=="[s,n]")&&([n,a]=e),n&&typeof a<"u"&&r.style&&(r.style[n]=a,r.raise("change",{property:"style",name:"style",value:r.style+""})),t=="[o]"&&Xe(e[0],(_,u)=>{this.style(u,_)})}active(){}find_selection_scope(){var e=this.selection_scope;if(e)return e;if(this.parent&&this.parent.find_selection_scope)return this.parent.find_selection_scope()}click(e){this.on("click",e)}add_class(e){let t=this.dom.attrs,s=t.class;if(!s)t.class=e;else{let r=we(s);if(r=="object")throw"removed";if(r=="string"){let n=s.split(" "),a=!1,o=n.length,l=0;for(;l<o&&!a;)n[l]===e&&(a=!0),l++;a||n.push(e),t.class=n.join(" ")}}}has_class(e){let t=this.dom.attrs,s=t.class;if(s){var r=we(s);if(r=="object")throw"removed";if(r=="string")for(var n=s.split(" "),a=[],o=n.length,l=0;l<o;){if(n[l]===e)return!0;l++}}}remove_class(e){let t=this.dom.attrs,s=t.class;if(s){var r=we(s);if(r=="object")throw"removed";if(r=="string"){for(var n=s.split(" "),a=[],o=n.length,l=0;l<o;)n[l]!=e&&a.push(n[l]),l++;t.class=a.join(" ")}}}is_ancestor_of(e){var t=we(e),s=this.dom.el,r=a=>{if(a==s)return!0;var o=a.parentNode;return o?r(o):!1};if(t==="object"&&s!==e){var n=e.parentNode;if(n)return r(n)}}find_selected_ancestor_in_scope(){var e=this.selection_scope,t=this.parent.selection_scope;if(e===t){var s=this.parent.selected;return s&&s.value&&s.value()==!0?this.parent:this.parent.find_selected_ancestor_in_scope()}}closest(e){let t=we(e);if(t==="function"){let s=r=>e(r)?r:r.parent?s(r.parent):void 0;return s(this)}}shallow_copy(){var e=new Control({context:this.context}),t=this.dom.attributes,s=t.class,r={selected:!0};Xe(s.split(" "),(a,o)=>{o&&!r[o]&&e.add_class(o)});var n=e.content;return this.content.each((a,o)=>{we(a)=="data_value"?n.add(a.value()):n.add(a.shallow_copy())}),e}matches_selector(e){throw"NYI"}find(e){let t=[],s=(r,n)=>{r.$match(e)&&n(r),r.content.each(a=>{s(a,n)})};return s(this,r=>t.push(r)),t}$match(e){if(typeof e=="function")return e(this);{let r=o=>o[0]==="."?()=>this.has_class(o.substr(1)):()=>this.__type_name===o,a=(o=>o.split(" ").map(u=>r(u)))(e);if(a.length===1)return a[0]();throw console.trace(),"NYI"}let t=!1,s=this.__type_name;return s&&s===e&&(t=!0),t}$(e,t){let s=this.$match(e),r=[];return s&&(t&&t(this),r.push(this)),this.content.each(n=>{if(n.$){let a=n.$(e,t);Array.prototype.push.apply(r,a)}}),r}clear(){this.content.clear()}activate(){}get this_and_descendents(){let e=[];return this.iterate_this_and_subcontrols(t=>e.push(t)),e}get descendents(){let e=[];return this.iterate_subcontrols(t=>e.push(t)),e}},Ko=Xt.prototype;Ko.connect_fields=!0;var Od=Symbol.for("nodejs.util.inspect.custom");Be.custom_rendering==="very-simple"&&(Ko[Od]=function(i,e,t){return"< "+this.dom.tagName+" "+this.__type_name+" >"});ci.exports=Xt;if(ye.main===ci){let e=function(){let r=[],n=[],a;try{a=new i({tagName:"svg"}),r.push("Create SVG control")}catch{n.push("Create SVG control")}try{let o=new i({tagName:"circle",attrs:{cx:100,cy:100,r:50}});a.add(o),r.push("Add circle to SVG control")}catch(o){console.log("error",o),n.push("Add circle to SVG control")}try{let o=new i({tagName:"rect",attrs:{x:150,y:150,width:100,height:100}});a.add(o),r.push("Add rectangle to SVG control")}catch(o){console.log("error",o),n.push("Add rectangle to SVG control")}try{let o='<svg><circle cx="100" cy="100" r="50"></circle><rect x="150" y="150" width="100" height="100"></rect></svg>',l=a.all_html_render();console.log("actual",l),o===l?r.push("Check rendering of SVG control"):n.push("Check rendering of SVG control")}catch(o){console.log("error",o),n.push("Check rendering of SVG control")}return{passed:r,failed:n}};Pd=e;let i=Xt;console.log(e());let s=(()=>{let r="#ff0000",n=[],a=[],o;try{o=new i({tagName:"div"}),n.push("Create div control")}catch(l){a.push(["Create div control",l])}try{o.background.color=r,n.push("Set background color of div control")}catch(l){a.push(["Set background color of div control",l])}try{o.background.color===r?n.push("Validate background color of div control"):a.push(["Validate background color of div control","Background color is not as expected"])}catch(l){a.push(["Validate background color of div control",l])}try{let l=`<div style="background-color:${r}"></div>`,_=o.all_html_render();l===_?n.push("Check rendering of div control"):a.push(["Check rendering of div control","Rendering does not match expected output",{expected:l,actual:_}])}catch(l){a.push(["Check rendering of div control",l])}return{passed:n,failed:a}})();console.log(s),console.log(s.failed)}var Pd});var Vs=q((Ux,il)=>{var sl=xe(),{get_a_sig:ot,each:Te,tof:lt,def:Ld}=sl,Ix=sl.util.v_subtract,{prom_or_cb:Nd}=yt(),Qo=Bs(),Zo=Jo(),el=typeof window<"u",_i=(i,e)=>{if(i.get){var t=i.get("content");if(t){var s=typeof t;if(!(s==="string"||s==="number")){var r=t._arr,n,a=r.length,o,l;for(n=0;n<a;n++)o=r[n],l=typeof o,l==="string"||l==="numbers"||(e(r[n]),_i(r[n],e))}}}},rl=(i,e)=>{e(i);for(var t=i.childNodes,s=t.length,r=0;r<s;r++)rl(t[r],e)},tl={change:!0,click:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,blur:!0,focus:!0,keydown:!0,keyup:!0,keypress:!0,contextmenu:!0,touchstart:!0,touchmove:!0,touchend:!0,touchcancel:!0,touchforcechange:!0,transitionend:!0,abort:!0,canplay:!0,canplaythrough:!0,durationchange:!0,emptied:!0,ended:!0,error:!0,loadeddata:!0,loadedmetadata:!0,loadstart:!0,pause:!0,play:!0,playing:!0,progress:!0,ratechange:!0,seeked:!0,seeking:!0,submit:!0,stalled:!0,suspend:!0,timeupdate:!0,volumechange:!0,waiting:!0},Rs=class extends Zo{constructor(e,t){if(e=e||{},super(e,t),e.id&&(this.__id=e.id),e.__id&&(this.__id=e.__id),e.__type_name&&(this.__type_name=e.__type_name),this.map_raises_dom_events={},e.el){var s=e.el.getAttribute("data-jsgui-fields");if(s){var r=s.replace(/\[DBL_QT\]/g,'"').replace(/\[SNG_QT\]/g,"'");r=r.replace(/\'/g,'"');var n=JSON.parse(r);let l={};Te(n,(_,u)=>{l[u]||(e[u]=_)})}}if(e.el){Ld(this.selection_scope)&&(this.selection_scope=this.context.new_selection_scope(this));var a=e.el.getAttribute("data-jsgui-type");a&&(this.__type_name=a);var o=e.el.getAttribute("data-jsgui-id");o&&(this.__id=o)}}ctrls(e){this._ctrl_fields=this._ctrl_fields||{};let t=this._ctrl_fields;return Te(e,(s,r)=>{t[r]=this[r]=s,this.add(s)}),this}bcr(){var e=arguments;e.l=e.length;var t=ot(e,1);if(t==="[]"){var s=this.dom.el,r=s.getBoundingClientRect(),n=[[r.left,r.top],[r.right,r.bottom],[r.width,r.height]];return n}if(t==="[a]"){let[a,o,l]=e[0];this.style({position:"absolute",left:a[0]+"px",top:a[1]+"px",width:l[0]+"px",height:l[1]+"px"})}}get size(){if(this._size)return this._size;if(this.dom.el){var e=this.dom.el.getBoundingClientRect();return[e.width,e.height]}}add_text(e){var t=new Qo({context:this.context,text:e+""});return this.add(t),t}computed_style(){var e=arguments;e.l=e.length;var t=ot(e,1),s;if(t=="[s]"){var r=e[0],n=this.dom.el;return n.currentStyle?s=n.currentStyle[styleProp]:window.getComputedStyle&&(s=document.defaultView.getComputedStyle(n,null).getPropertyValue(r)),s}}padding(){var e=arguments;e.l=e.length;var t=ot(e,1);if(t=="[]"){var s,r,n,a,o=this.computed_style("padding"),l=o.split(" ");if(l.length==3)return r=parseInt(l[0],10),n=parseInt(l[1],10),a=parseInt(l[2],10),[0,r,n,a]}else throw console.trace(),"Required argument: (array)"}border(){var e=arguments;e.l=arguments.length;var t=ot(e,1);if(t=="[]"){var s,r,n,a,o=this.computed_style("border");throw console.log("c_border",o),"stop"}else throw console.trace(),"Required argument: (array)"}border_thickness(){var e=arguments;e.l=arguments.length;var t=ot(e,1);if(t=="[]"){var s,r,n,a,o=this.computed_style("border"),l=o.split(", ").join(""),_=l.split(" "),u=parseInt(_[0],10);return u}}activate_recursive(){var e=this.dom.el,t=this.context,s=t.map_controls,r;recursive_dom_iterate_depth(e,n=>{if(n.nodeType==1){var o=n.getAttribute("data-jsgui-id");if(o){var l=s[o];l.__active||l.activate(n)}}})}add_dom_event_listener(e,t){if(el){let{context:s}=this,r=this.dom.el,n=this.map_handlers_to_outer_handlers=this.map_handlers_to_outer_handlers||new Map,a;n.has(t)?a=n.get(t):(a=o=>{let{target:l}=o,_=l.getAttribute("data-jsgui-id");_&&(o.ctrl_target=s.map_controls[_]),t(o)},n.set(t,a)),r&&r.addEventListener(e,a,!1)}}remove_dom_event_listener(e,t){if(el){let r=this.map_handlers_to_outer_handlers,n;r&&r.has(t)&&(n=r.get(t)),n=n||t;let a=this.dom.el;a&&a.removeEventListener(e,n,!1)}let s=()=>{var r=this._bound_events[e];let n,a=this.map_handlers_to_outer_handlers;a&&a.has(t)&&(n=a.get(t)),n=n||t;var o=this.dom.el;if(o){var l=lt(r);let _;if(_=t,l==="array"){let u=0;Te(r,h=>{h===_&&(o.removeEventListener(e,h,!1),u++)}),u===r.length&&(this.map_raises_dom_events[e]=!1)}else{let u;u=t.event_inner||t,r===u&&o.removeEventListener(e,r,!1)}}}}remove_event_listener(){let e=arguments,t=ot(e,1);if(t==="[s,f]"){let[s,r]=e;tl[s]&&this.remove_dom_event_listener(s,r),Zo.prototype.remove_event_listener.apply(this,e)}else t==="[o]"&&Te(e[0],(s,r)=>{this.remove_event_listener(r,s)})}add_event_listener(){let e=arguments,t=e.length,s=ot(e,1);if(t===1&&Te(e[0],(r,n)=>{this.add_event_listener(n,r)}),t===2&&super.add_event_listener(e[0],e[1]),t===3&&super.add_event_listener(e[0],e[2]),s==="[s,f]"||s==="[s,b,f]"){let r=e[0],n=!0;t===3&&e[1]===!1&&(n=!1);let a;t===2&&(a=e[1]),t===3&&(a=e[2]),tl[e[0]]&&n&&this.add_dom_event_listener(r,a)}}once_active(e){if(typeof document<"u")return Nd((t,s)=>{if(this.__active)t();else{let r=()=>{t(),setTimeout(()=>{this.off("activate",r)},0)};this.on("activate",r)}},e)}activate(e){if(typeof document<"u"&&!this.__active){if(this.__active=!0,!this.dom.el){let t=this.context.get_ctrl_el(this)||this.context.map_els[this._id()]||document.querySelectorAll('[data-jsgui-id="'+this._id()+'"]')[0];t&&(this.dom.el=t)}this.dom.el&&(this.activate_dom_attributes(),this.activate_content_controls(),this.activate_content_listen(),this.activate_other_changes_listen(),this.raise("activate"))}}activate_other_changes_listen(){var e=this.dom.attributes,t=this.dom.el;e.on("change",s=>{var r=s.name||s.key,n=s.value||s.new;t&&t.nodeType===1&&t.setAttribute(r,n)})}activate_this_and_subcontrols(){this.iterate_this_and_subcontrols(e=>{e.dom.el&&e.activate()})}activate_content_listen(){let{context:e}=this;var t=e.map_controls;let s=this.dom.el;this.content.on("change",r=>{let n;var a=r.name;if(a==="insert"){var o=r.value,l=o.dom.el,_=lt(l);if(_==="string")n=l;else if(l&&(n=l),n||e.map_els[o._id()]&&(n=e.map_els[o._id()]),!n){var u="div",h=o.dom.tagName;h&&(u=h);var d;if(u==="circle"||u==="line"||u==="polyline"){var f=r.item.context.document.createElement("div");f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.1">'+r.item.all_html_render()+"</svg>",n=f.childNodes[0].childNodes[0]}else d=r.item.context.document.createElement("div"),d.innerHTML=r.item.all_html_render(),n=d.childNodes[0];o.dom.el=n,e.map_els[o._id()]=n}var p=lt(n);p==="string"&&(n=document.createTextNode(n)),n&&(s.appendChild(n),r.item.register_this_and_subcontrols())}else if(a==="clear")s&&(s.innerHTML="");else if(a==="remove")r.value.dom.el&&r.value.dom.el.parentNode.removeChild(r.value.dom.el);else throw console.trace(),"NYI - Unexpected change type. e_change: "+r})}rec_desc_ensure_ctrl_el_refs(e){e=e||this.dom.el;var t=this.context;if(e){var s,r,n,a,o={};rl(e,l=>{l.getAttribute&&(a=l.getAttribute("data-jsgui-id"),a&&(o[a]=l,t.map_els[a]=l))}),_i(this,l=>{var _=lt(l);if(l!==this&&_==="control"){var u=l._id();o[u]&&l.dom.el!==o[u]&&(l.dom.el=o[u]),l.activate()}})}}rec_desc_activate(){_i(this,e=>{lt(e)==="control"&&e.activate()})}activate_content_controls(){if(!this.dom.el){let t=this.context.get_ctrl_el(this);t&&(this.dom.el=t)}let e=this.dom.el;if(e){let t=this.context,s={},r,n;if(e.getAttribute){let a=e.getAttribute("data-jsgui-ctrl-fields");a&&(s=JSON.parse(a.replace(/'/g,'"')));let o=Object.keys(s),l=o.length,_,u;for(r=0;r<l;r++)_=o[r],u=s[_],this[_]=t.map_controls[u];let h=e.childNodes,d=this.content;for(r=0,n=h.length;r<n;r++){let f=h[r];if(f){let p=f.nodeType;if(p===1){let g=f.getAttribute("data-jsgui-id"),b=t.map_controls[g],k=!1;if(b){let y=b.__id;y&&d.each((T,j)=>{T.__id&&T.__id==y&&(k=!0)}),k||d.add(b),b.activate(),b.parent=this}}if(p===3){let g=r,b=d._arr[g];b?b.text===f.nodeValue&&(b.dom.el=f):console.log("&&& no corresponding control");let k=()=>{let y=f.nodeValue;console.log("adding Text_Node control",y);let T=new Qo({context:this.context,text:y,el:f});console.log("content._arr.length",d._arr.length),d.add(T)}}}}}}}activate_dom_attributes(){let e=this.dom.el,t=this.dom.attributes,s,r,n,a;if(e){let o=e.attributes;if(o){let l=o.length;for(console.log("attrs l",l),a=0;a<l;a++)s=o.item(a),r=s.name,n=s.value,r==="data-jsgui-id"||r==="data-jsgui-type"||(t[r]=n)}}}attach_dom_events(){throw console.trace(),"stop - look into this";Te(this._bound_events,(e,t)=>{Te(e,s=>{this.add_dom_event_listener(t,s)})})}_search_descendents(e){let t=(r,n)=>{let a=r.content;lt(a)==="collection"&&a.length()>0&&a.each((l,_)=>{n(l),t(l,n)})},s=[];return t(this,r=>{r.__type_name===e&&s.push(r)}),s}_search_ancestor(e){let t=this.parent;if(t){if(t===e)return!0;if(typeof t.ancestor=="function")return t.ancestor(e)}else return!1}add(e){let{context:t}=this;if(t){let s=t.map_controls_being_added_in_frame=t.map_controls_being_added_in_frame||{};if(lt(e)==="array")Te(e,n=>{let a=n.this_and_descendents;a&&Te(a,o=>{o._id&&(s[o._id()]=o)})});else if(e){let n=e.this_and_descendents;n&&Te(n,a=>{a._id&&(s[a._id()]=a)})}}return super.add(e)}clear(){let{context:e}=this;e.map_controls_being_removed_in_frame=e.map_controls_being_removed_in_frame||{},Te(this.descendents,t=>{t._id&&(e.map_controls_being_removed_in_frame[t._id()]=t)}),super.clear()}},Hs=Rs.prototype;Hs.on=Hs.add_event_listener;Hs.off=Hs.remove_event_listener;il.exports=Rs});var al=q(($x,nl)=>{var Md=Vs();nl.exports=Md});var fi=q((Gx,ll)=>{var ui=xe(),ol=ui.each,Rd=ui.tof,Hd=al(),hi=class extends ui.Data_Object{constructor(e){super(e),e.context&&(this.context=e.context),typeof e.id<"u"&&(this.id=e.id),e.ctrl&&(this.control=e.ctrl),e.control&&(this.control=e.control),this.map_selected_controls={}}select_only(e,t=!1){var s,r=0,n;ol(this.map_selected_controls,(a,o)=>{a&&a!==e&&a!==this.control&&a.selected&&(a.selected=!1,r++),a===e&&a!==this.control&&(s=a.selected)}),this.map_selected_controls={},typeof e._id=="function"&&(this.map_selected_controls[e._id()]=e),s||(e.selected=!0,t||(this.raise("change",{name:"selected",value:e}),e.raise("select"))),r>0&!s}deselect_all(e=!1){ol(this.map_selected_controls,(t,s)=>{t&&t.selected&&(t.selected=!1,t.raise("deselect"))}),e||this.raise("change",{name:"selected",value:void 0}),this.map_selected_controls={}}deselect(e,t=!1){e.selected===!0&&(e.selected=!1),t||(e.raise("deselected"),this.raise("change",{name:"selected",map_selected_controls:this.map_selected_controls}))}select(e,t=!1){e.selected||(e.selected=!0),t||(e.raise("selected"),this.raise("change",{name:"selected",map_selected_controls:this.map_selected_controls}))}deselect_ctrl_content(e,t=!1){var s=e.selection_scope,r=this.map_selected_controls;e.content.each(n=>{if(n instanceof Hd){n.selected=!1;var a=n._id();r[a]&&(r[a]=!1),this.deselect_ctrl_content(n),t||n.raise("deselected")}}),t||this.raise("change",{name:"selected",map_selected_controls:this.map_selected_controls})}select_toggle(e,t=!1){var s=e.selected,r=this.map_selected_controls,n=e._id();if(s){var o=Rd(s);if(o==="boolean")if(s)e.selected=!1,r[n]=!1;else{var a=e.find_selected_ancestor_in_scope();a?console.log("2) not selecting because a selected ancestor in the selection scope has been found."):(this.deselect_ctrl_content(e,t),e.selected=!0,r[n]=e)}}else{var a=e.find_selected_ancestor_in_scope();a?console.log("1) not selecting because a selected ancestor in the selection scope has been found."):(e.selected=!0,this.deselect_ctrl_content(e,t),r[n]=e)}t||this.raise("change")}};ll.exports=hi});var hl=q((Wx,_l)=>{var cl=xe(),{each:di,tof:Vd,is_defined:Yd,get_a_sig:Id,Evented_Class:Ud}=cl,$d=fi(),mi=class extends Ud{constructor(e){e=e||{},super(e),e.browser_info&&(this.browser_info=e.browser_info),e.resource_pool&&(this.resource_pool=e.resource_pool),this.get_vector_methodology=function(){return this.browser_info.ie?"vml":"svg"},this.selection_scopes={},this.selection_scope_id_counter=0;var t={},s={},r=o=>{Yd(t[o])||(t[o]=0);var l=o+"_"+t[o];return t[o]++,l};this.new_id=r,this.set_max_ids=o=>{di(o,(l,_)=>{t[_]=l+1})};var n=this.map_Controls={},a=this.map_controls={};this.map_control_iids={},this.next_iid=1}new_selection_scope(e){var t=new $d({context:this,id:this.selection_scope_id_counter++,ctrl:e});return this.selection_scopes[t.id]=t,e&&(e.selection_scope=t,typeof document>"u"&&(e._fields=e._fields||{},e._fields.selection_scope=t.id)),t}make(e){if(Vd(e)==="string"){let s=cl.parse_and_mount(e,this)}}update_Controls(){var e=arguments;e.l=arguments.length;var t=Id(e,1);if(t==="[o]"){var s=e[0],r=this.map_Controls;di(s,(o,l)=>{o=o.toLowerCase(),r[o]=l})}if(t==="[s,f]"){var n=e[0],a=e[1];n=n.toLowerCase(),this.map_Controls[n]=a}}register_control(e){e.context=this;var t=e._id();this.map_controls[t]=e,e.iid=this.next_iid,this.map_control_iids[t]=this.next_iid++}first_ctrl_matching_type(e){var t;return di(this.map_controls,(s,r,n)=>{s.__type_name===e&&(n(),t=s)}),t}};_l.exports=mi});var fl=q((Ke,ul)=>{(function(){function i(){return typeof ye=="function"&&typeof Ke=="object"&&typeof ul=="object"&&typeof __filename=="string"&&typeof __dirname=="string"}if(!i()){if(!this.Tautologistics)this.Tautologistics={};else if(this.Tautologistics.NodeHtmlParser)return;this.Tautologistics.NodeHtmlParser={},Ke=this.Tautologistics.NodeHtmlParser}var e={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};function t(o,l){this._options=l||{},this._options.includeLocation==null&&(this._options.includeLocation=!1),this.validateHandler(o),this._handler=o,this.reset()}t._reTrim=/(^\s+|\s+$)/g,t._reTrimComment=/(^\!--|--$)/g,t._reWhitespace=/\s/g,t._reTagName=/^\s*(\/?)\s*([^\s\/]+)/,t._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g,t._reTags=/[\<\>]/g,t.prototype.parseComplete=function(l){this.reset(),this.parseChunk(l),this.done()},t.prototype.parseChunk=function(l){this._done&&this.handleError(new Error("Attempted to parse chunk after parsing already done")),this._buffer+=l,this.parseTags()},t.prototype.done=function(){if(!this._done){if(this._done=!0,this._buffer.length){var l=this._buffer;this._buffer="";var _={raw:l,data:this._parseState==e.Text?l:l.replace(t._reTrim,""),type:this._parseState};(this._parseState==e.Tag||this._parseState==e.Script||this._parseState==e.Style)&&(_.name=this.parseTagName(_.data)),this.parseAttribs(_),this._elements.push(_)}this.writeHandler(),this._handler.done()}},t.prototype.reset=function(){this._buffer="",this._done=!1,this._elements=[],this._elementsCurrent=0,this._current=0,this._next=0,this._location={row:0,col:0,charOffset:0,inBuffer:0},this._parseState=e.Text,this._prevTagSep="",this._tagStack=[],this._handler.reset()},t.prototype._options=null,t.prototype._handler=null,t.prototype._buffer=null,t.prototype._done=!1,t.prototype._elements=null,t.prototype._elementsCurrent=0,t.prototype._current=0,t.prototype._next=0,t.prototype._location=null,t.prototype._parseState=e.Text,t.prototype._prevTagSep="",t.prototype._tagStack=null,t.prototype.parseTagAttribs=function(l){for(var _=l.length,u=0;u<_;){var h=l[u++];(h.type==e.Tag||h.type==e.Script||h.type==e.style)&&this.parseAttribs(h)}return l},t.prototype.parseAttribs=function(l){if(!(l.type!=e.Script&&l.type!=e.Style&&l.type!=e.Tag)){var _=l.data.split(t._reWhitespace,1)[0],u=l.data.substring(_.length);if(!(u.length<1)){var h;for(t._reAttrib.lastIndex=0;h=t._reAttrib.exec(u);)l.attribs==null&&(l.attribs={}),typeof h[1]=="string"&&h[1].length?l.attribs[h[1]]=h[2]:typeof h[3]=="string"&&h[3].length?l.attribs[h[3].toString()]=h[4].toString():typeof h[5]=="string"&&h[5].length?l.attribs[h[5]]=h[6]:typeof h[7]=="string"&&h[7].length&&(l.attribs[h[7]]=h[7])}}},t.prototype.parseTagName=function(l){if(l==null||l=="")return"";var _=t._reTagName.exec(l);return _?(_[1]?"/":"")+_[2]:""},t.prototype.parseTags=function(){for(var l=this._buffer.length-1;t._reTags.test(this._buffer);){this._next=t._reTags.lastIndex-1;var _=this._buffer.charAt(this._next),u=this._buffer.substring(this._current,this._next),h={raw:u,data:this._parseState==e.Text?u:u.replace(t._reTrim,""),type:this._parseState},d=this.parseTagName(h.data);if(this._tagStack.length){if(this._tagStack[this._tagStack.length-1]==e.Script){if(d.toLowerCase()=="/script")this._tagStack.pop();else if(h.raw.indexOf("!--")!=0&&(h.type=e.Text,this._elements.length&&this._elements[this._elements.length-1].type==e.Text)){var f=this._elements[this._elements.length-1];f.raw=f.data=f.raw+this._prevTagSep+h.raw,h.raw=h.data=""}}else if(this._tagStack[this._tagStack.length-1]==e.Style){if(d.toLowerCase()=="/style")this._tagStack.pop();else if(h.raw.indexOf("!--")!=0)if(h.type=e.Text,this._elements.length&&this._elements[this._elements.length-1].type==e.Text){var f=this._elements[this._elements.length-1];h.raw!=""?(f.raw=f.data=f.raw+this._prevTagSep+h.raw,h.raw=h.data=""):f.raw=f.data=f.raw+this._prevTagSep}else h.raw!=""&&(h.raw=h.data=h.raw)}else if(this._tagStack[this._tagStack.length-1]==e.Comment){var p=h.raw.length;if(h.raw.charAt(p-2)=="-"&&h.raw.charAt(p-1)=="-"&&_==">")if(this._tagStack.pop(),this._elements.length&&this._elements[this._elements.length-1].type==e.Comment){var f=this._elements[this._elements.length-1];f.raw=f.data=(f.raw+h.raw).replace(t._reTrimComment,""),h.raw=h.data="",h.type=e.Text}else h.type=e.Comment;else if(h.type=e.Comment,this._elements.length&&this._elements[this._elements.length-1].type==e.Comment){var f=this._elements[this._elements.length-1];f.raw=f.data=f.raw+h.raw+_,h.raw=h.data="",h.type=e.Text}else h.raw=h.data=h.raw+_}}if(h.type==e.Tag){h.name=d;var g=d.toLowerCase();if(h.raw.indexOf("!--")==0){h.type=e.Comment,delete h.name;var p=h.raw.length;h.raw.charAt(p-1)=="-"&&h.raw.charAt(p-2)=="-"&&_==">"?h.raw=h.data=h.raw.replace(t._reTrimComment,""):(h.raw+=_,this._tagStack.push(e.Comment))}else h.raw.indexOf("!")==0||h.raw.indexOf("?")==0?h.type=e.Directive:g=="script"?(h.type=e.Script,h.data.charAt(h.data.length-1)!="/"&&this._tagStack.push(e.Script)):g=="/script"?h.type=e.Script:g=="style"?(h.type=e.Style,h.data.charAt(h.data.length-1)!="/"&&this._tagStack.push(e.Style)):g=="/style"&&(h.type=e.Style);h.name&&h.name.charAt(0)=="/"&&(h.data=h.name)}(h.raw!=""||h.type!=e.Text)&&(this._options.includeLocation&&!h.location&&(h.location=this.getLocation(h.type==e.Tag)),this.parseAttribs(h),this._elements.push(h),h.type!=e.Text&&h.type!=e.Comment&&h.type!=e.Directive&&h.data.charAt(h.data.length-1)=="/"&&this._elements.push({raw:"/"+h.name,data:"/"+h.name,name:"/"+h.name,type:h.type})),this._parseState=_=="<"?e.Tag:e.Text,this._current=this._next+1,this._prevTagSep=_}this._options.includeLocation&&(this.getLocation(),this._location.row+=this._location.inBuffer,this._location.inBuffer=0,this._location.charOffset=0),this._buffer=this._current<=l?this._buffer.substring(this._current):"",this._current=0,this.writeHandler()},t.prototype.getLocation=function(l){for(var _,u=this._location,h=this._current-(l?1:0),d=l&&u.charOffset==0&&this._current==0;u.charOffset<h;u.charOffset++)_=this._buffer.charAt(u.charOffset),_==`
`?(u.inBuffer++,u.col=0):_!="\r"&&u.col++;return{line:u.row+u.inBuffer+1,col:u.col+(d?0:1)}},t.prototype.validateHandler=function(l){if(typeof l!="object")throw new Error("Handler is not an object");if(typeof l.reset!="function")throw new Error("Handler method 'reset' is invalid");if(typeof l.done!="function")throw new Error("Handler method 'done' is invalid");if(typeof l.writeTag!="function")throw new Error("Handler method 'writeTag' is invalid");if(typeof l.writeText!="function")throw new Error("Handler method 'writeText' is invalid");if(typeof l.writeComment!="function")throw new Error("Handler method 'writeComment' is invalid");if(typeof l.writeDirective!="function")throw new Error("Handler method 'writeDirective' is invalid")},t.prototype.writeHandler=function(l){if(l=!!l,!(this._tagStack.length&&!l))for(;this._elements.length;){var _=this._elements.shift();switch(_.type){case e.Comment:this._handler.writeComment(_);break;case e.Directive:this._handler.writeDirective(_);break;case e.Text:this._handler.writeText(_);break;default:this._handler.writeTag(_);break}}},t.prototype.handleError=function(l){if(typeof this._handler.error=="function")this._handler.error(l);else throw l};function s(o){s.super_.call(this,o,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1})}a(s,r),s.prototype.done=function(){var l={},_,u=n.getElementsByTagName(function(h){return h=="rss"||h=="feed"},this.dom,!1);if(u.length&&(_=u[0]),_){if(_.name=="rss"){l.type="rss",_=_.children[0],l.id="";try{l.title=n.getElementsByTagName("title",_.children,!1)[0].children[0].data}catch{}try{l.link=n.getElementsByTagName("link",_.children,!1)[0].children[0].data}catch{}try{l.description=n.getElementsByTagName("description",_.children,!1)[0].children[0].data}catch{}try{l.updated=new Date(n.getElementsByTagName("lastBuildDate",_.children,!1)[0].children[0].data)}catch{}try{l.author=n.getElementsByTagName("managingEditor",_.children,!1)[0].children[0].data}catch{}l.items=[],n.getElementsByTagName("item",_.children).forEach(function(h,d,f){var p={};try{p.id=n.getElementsByTagName("guid",h.children,!1)[0].children[0].data}catch{}try{p.title=n.getElementsByTagName("title",h.children,!1)[0].children[0].data}catch{}try{p.link=n.getElementsByTagName("link",h.children,!1)[0].children[0].data}catch{}try{p.description=n.getElementsByTagName("description",h.children,!1)[0].children[0].data}catch{}try{p.pubDate=new Date(n.getElementsByTagName("pubDate",h.children,!1)[0].children[0].data)}catch{}l.items.push(p)})}else{l.type="atom";try{l.id=n.getElementsByTagName("id",_.children,!1)[0].children[0].data}catch{}try{l.title=n.getElementsByTagName("title",_.children,!1)[0].children[0].data}catch{}try{l.link=n.getElementsByTagName("link",_.children,!1)[0].attribs.href}catch{}try{l.description=n.getElementsByTagName("subtitle",_.children,!1)[0].children[0].data}catch{}try{l.updated=new Date(n.getElementsByTagName("updated",_.children,!1)[0].children[0].data)}catch{}try{l.author=n.getElementsByTagName("email",_.children,!0)[0].children[0].data}catch{}l.items=[],n.getElementsByTagName("entry",_.children).forEach(function(h,d,f){var p={};try{p.id=n.getElementsByTagName("id",h.children,!1)[0].children[0].data}catch{}try{p.title=n.getElementsByTagName("title",h.children,!1)[0].children[0].data}catch{}try{p.link=n.getElementsByTagName("link",h.children,!1)[0].attribs.href}catch{}try{p.description=n.getElementsByTagName("summary",h.children,!1)[0].children[0].data}catch{}try{p.pubDate=new Date(n.getElementsByTagName("updated",h.children,!1)[0].children[0].data)}catch{}l.items.push(p)})}this.dom=l}s.super_.prototype.done.call(this)};function r(o,l){this.reset(),this._options=l||{},this._options.ignoreWhitespace==null&&(this._options.ignoreWhitespace=!1),this._options.verbose==null&&(this._options.verbose=!0),this._options.enforceEmptyTags==null&&(this._options.enforceEmptyTags=!0),typeof o=="function"&&(this._callback=o)}r._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},r.reWhitespace=/^\s*$/,r.prototype.dom=null,r.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},r.prototype.done=function(){this._done=!0,this.handleCallback(null)},r.prototype.writeTag=function(l){this.handleElement(l)},r.prototype.writeText=function(l){this._options.ignoreWhitespace&&r.reWhitespace.test(l.data)||this.handleElement(l)},r.prototype.writeComment=function(l){this.handleElement(l)},r.prototype.writeDirective=function(l){this.handleElement(l)},r.prototype.error=function(l){this.handleCallback(l)},r.prototype._options=null,r.prototype._callback=null,r.prototype._done=!1,r.prototype._tagStack=null,r.prototype.handleCallback=function(l){if(typeof this._callback!="function"){if(l)throw l;return}this._callback(l,this.dom)},r.prototype.isEmptyTag=function(o){var l=o.name.toLowerCase();return l.charAt(0)=="/"&&(l=l.substring(1)),this._options.enforceEmptyTags&&!!r._emptyTags[l]},r.prototype.handleElement=function(l){if(this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()")),this._options.verbose||(delete l.raw,(l.type=="tag"||l.type=="script"||l.type=="style")&&delete l.data),!this._tagStack.last())l.type!=e.Text&&l.type!=e.Comment&&l.type!=e.Directive?l.name.charAt(0)!="/"&&(this.dom.push(l),this.isEmptyTag(l)||this._tagStack.push(l)):this.dom.push(l);else if(l.type!=e.Text&&l.type!=e.Comment&&l.type!=e.Directive)if(l.name.charAt(0)=="/"){var _=l.name.substring(1);if(!this.isEmptyTag(l)){for(var u=this._tagStack.length-1;u>-1&&this._tagStack[u--].name!=_;);if(u>-1||this._tagStack[0].name==_)for(;u<this._tagStack.length-1;)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(l),this.isEmptyTag(l)||this._tagStack.push(l);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(l)};var n={testElement:function(l,_){if(!_)return!1;for(var u in l)if(u=="tag_name"){if(_.type!="tag"&&_.type!="script"&&_.type!="style"||!l.tag_name(_.name))return!1}else if(u=="tag_type"){if(!l.tag_type(_.type))return!1}else if(u=="tag_contains"){if(_.type!="text"&&_.type!="comment"&&_.type!="directive"||!l.tag_contains(_.data))return!1}else if(!_.attribs||!l[u](_.attribs[u]))return!1;return!0},getElements:function(l,_,u,h){if(u=u==null||!!u,h=isNaN(parseInt(h))?-1:parseInt(h),!_)return[];var d=[],f;function p(k){return function(y){return y==k}}for(var g in l)typeof l[g]!="function"&&(l[g]=p(l[g]));if(n.testElement(l,_)&&d.push(_),h>=0&&d.length>=h)return d;if(u&&_.children)f=_.children;else if(_ instanceof Array)f=_;else return d;for(var b=0;b<f.length&&(d=d.concat(n.getElements(l,f[b],u,h)),!(h>=0&&d.length>=h));b++);return d},getElementById:function(l,_,u){var h=n.getElements({id:l},_,u,1);return h.length?h[0]:null},getElementsByTagName:function(l,_,u,h){return n.getElements({tag_name:l},_,u,h)},getElementsByTagType:function(l,_,u,h){return n.getElements({tag_type:l},_,u,h)}};function a(o,l){var _=function(){};_.prototype=l.prototype,o.super_=l,o.prototype=new _,o.prototype.constructor=o}Ke.Parser=t,Ke.DefaultHandler=r,Ke.RssHandler=s,Ke.ElementType=e,Ke.DomUtils=n})()});var pl=q((Kx,gl)=>{var dl=fl(),{tof:Gd,each:ct}=_e(),Wd={name:!0,class:!0,content:!0,__type_name:!0,context:!0,key:!0,size:!0},Je=()=>{},ml=function(i,e,t,s){i=i.trim();let r=new dl.DefaultHandler(function(a,o){if(a)Je("parse error",a);else{Je("dom",o);let l=(g,b,k)=>{let y=Gd(g),T;Je("tdom",y),Je("dom item",g),y==="array"?ct(g,(j,S)=>{l(j,b+1,k),k(j,b,S)}):y==="object"?g.children&&ct(g.children,(j,S)=>{l(j,b+1,k),k(j,b,S)}):Je("dom",g)},_=0,u={},h={},d=(g,b,k)=>{let y=new t.Text_Node({text:g,context:e,sibling_index:k});h.unnamed=h.unnamed||[],h.unnamed.push(y),u[b]=u[b]||[],u[b].push(y),_=b},f=(g,b,k)=>{let y={};g.raw&&(y.raw=g.raw),g.data&&(y.data=g.data),g.type&&(y.type=g.type),g.name&&(y.name=g.name),g.attribs&&(y.attribs=g.attribs);let T=(z,U)=>{if(t[z.name]){let Q=t[z.name];Je("tag",z);let Y=z.attribs||{};U&&(Y.content=U),ct(U,M=>{}),Je("attribs a",Y),Je(`

`),Y.context=e;let W=new Q(Y);Y.name?(h.named=h.named||{},h.named[Y.name]=W):(h.unnamed=h.unnamed||[],h.unnamed.push(W));let ee=[];return ct(Y,(M,H)=>{Wd[H]||ee.push([H,M])}),ct(ee,M=>{let[H,C]=M;W.dom.attributes[H]=C}),W}else throw console.trace(),"lacking jsgui control for "+z.name},j,S;b>_?(S=T(y),u[b]=[],u[b].push(S)):b<_?(j=u[_],j?S=T(y,j):S=T(y),u[b]=u[b]||[],u[_]=null,u[b].push(S)):(S=T(y),u[b]=u[b]||[],u[b].push(S)),_=b};l(o,0,(g,b,k)=>{g.type==="text"?g.data.trim().length>0&&d(g.raw,b,k):g.type==="tag"&&f(g,b,k)});let p=u[0];s(null,[p,h])}});var n=new dl.Parser(r);n.parseComplete(i)},Xd=function(i,e,t){return new Promise(async(s,r)=>{let n,a=arguments;a.length===4?(n=a[2],t=a[3]):n=e;let{context:l}=e;ml(i,l,t,(_,u)=>{if(_)r(_);else{let[h,d]=u;ct(d.named,(p,g)=>{e[g]=p});let f=l.__is_active;ct(h,p=>{n.add(p),f&&setTimeout(()=>{p.activate()},0)}),d.named&&(e._ctrl_fields=e._ctrl_fields||{},Object.assign(e._ctrl_fields,d.named)),s(h)}})})},Kd={parse:ml,parse_mount:Xd};gl.exports=Kd});var N=q((eb,kl)=>{var X=xe(),gi=Bs(),Jx=ae(),Jd=hl(),Qd=fi(),{parse_mount:Zd,parse:em}=pl(),vl=X.str_arr_mapify,tm=X.get_a_sig,pi=X.each,Qe=X.Control=Vs();X.load_type("control","C",i=>i instanceof Qe);var sm=X.Evented_Class,Qx=X.tof,yl=X.map_Controls={},rm=X.is_defined,{prop:xl}=ae(),im=vl(function(i){X.controls[i]=X[i]=class extends Qe{constructor(e){let t;typeof e=="string"?(t=e,e={__type_name:i}):typeof e=="object"&&(e.__type_name=i),super(e),this.dom.tagName=i}},X[i].prototype._tag_name=i,yl[i]=X[i]}),nm=vl(function(i){X[i]=class extends Qe{constructor(e){e.__type_name=i,super(e),this.dom.tagName=i,this.dom.noClosingTag=!0}},X[i].prototype._tag_name=i,yl[i]=X[i]}),bl=function(i,e){e(i);for(var t=i.childNodes,s=0,r=t.length;s<r;s++)bl(t[s],e)},wl=function(i,e){for(var t=i.childNodes,s=0,r=t.length;s<r;s++)wl(t[s],e);e(i)},am=function(i){if(console.log("jsgui html-core activate"),console.log("jsgui.def_server_resources",X.def_server_resources),!i)throw"jsgui-html-enh activate(context) - need to supply context parameter.";var e=i.map_controls,t={},s={},r=[],n={},a=function(u){var h=u.lastIndexOf("_"),d=u.substr(0,h);return d},o=function(u){return parseInt(u.substr(u.lastIndexOf("_")+1),10)};(()=>{bl(document,u=>{if(u.nodeType===1){let f=u.getAttribute("data-jsgui-id");if(f){let p=a(f),g=o(f);rm(n[p])?g>n[p]&&(n[p]=g):n[p]=g,t[f]=u;var d=u.getAttribute("data-jsgui-type");d&&(s[f]=d)}}})})(),i.set_max_ids(n),pi(t,(u,h)=>{let d=u.tagName.toLowerCase();if(h){var f=s[h];if(e[h]){var g=e[h];g.dom.el=u,g.attach_dom_events&&g.attach_dom_events()}else{var p=i.map_Controls[f];if(p){var g=new p({context:i,__type_name:f,id:h,el:u});r.push(g),d==="html"&&(i.ctrl_document=g),e[h]=g}else{console.log("Missing context.map_Controls for type "+f+", using generic Control");var g=new Qe({context:i,__type_name:f,id:h,el:u});r.push(g),e[h]=g}}}});let _;wl(document,u=>{var h=u.nodeType;if(h===1){var d=u.getAttribute("data-jsgui-id");if(d){let f=e[d];f.activate(f.dom.el),_&&(_.parent=f),_=f}}})};X.controls=X.controls||{Control:Qe};X.controls.span=X.span=class extends Qe{constructor(e){e.__type_name="span",super(e),this.dom.tagName="span",e=e||{},xl(this,"text",e.text||""),this.on("change",t=>{let{name:s}=t;if(s==="text"){if(this.content._arr.length===1)this.content._arr[0]instanceof gi&&(this.content._arr[0].text=t.value);else if(this.content._arr.length!==0)throw console.log("this.content._arr",this.content._arr),console.trace(),"NYI"}}),e.el||this.compose_span()}compose_span(){this.text&&this.text.length>0&&this.add(this.tn=this.text_node=new gi({context:this.context,text:this.text}))}};var vi=class extends Qe{constructor(e={}){e.__type_name="string_control",super(e),this.dom.tagName=void 0,e=e||{},typeof e.text<"u"?this._text=e.text:this._text="",e.el}get text(){return this._text}set text(e){this._text=e,this.raise("change",{name:"text",value:e})}all_html_render(){return this._text}activate(){}};X.activate=am;im("html head title body div h1 h2 h3 h4 h5 h6 label p a script button form textarea img ul li audio video table tr td caption thead colgroup col svg defs marker polygon line section code samp");nm("link input meta");var Ys=class extends X.Control{constructor(e={}){e.tag_name="html",super(e)}},yi=class extends Ys{constructor(e={}){super(e);var t=this.context;if(!e.el){var s=new X.head({context:t});this.content.add(s);var r=new X.title({context:t});s.content.add(r);var n=new X.body({context:t});this.content.add(n),this.head=s,this.title=r,this.body=n}}body(){var e=arguments;e.l=arguments.length;var t=tm(e,1);if(t=="[]"){var s=this.content,r=s.get(1);return r}}},xi=class extends sm{constructor(e){super(e);let t,s=()=>{t=[],pi(e.controls||e.ctrls,a=>{t.push([a.bcr(),a])})},r=new Map,n=a=>{s();let o=[],l=[],_=[],[u,h]=a;return pi(t,d=>{let[f,p]=d,[g,b,k]=f;g[0]<=h[0]&&u[0]<=b[0]&&g[1]<=h[1]&&u[1]<=b[1]?(r.get(p)!==!0&&(l.push(p),r.set(p,!0)),o.push(p)):r.get(p)===!0&&(_.push(p),r.set(p,!1))}),[o,l,_]};xl(this,"coords",a=>{if(a[0][1]>a[1][1]){let[o,l]=a;a=[l,o]}if(a[0][0]>a[1][0]){let o=a[1][0];a[1][0]=a[0][0],a[0][0]=o}return a},a=>{let o=n(a[0]);(o[1].length>0||o[2].length>0)&&this.raise("change",{name:"intersections",value:o})}),this.find_intersections=n}},bi=class extends Qe{constructor(e){e.class="relative",super(e)}};X.Relative=bi;X.String_Control=X.controls.String_Control=vi;X.HTML_Document=Ys;X.Blank_HTML_Document=yi;X.Text_Node=X.controls.Text_Node=X.Text_Node=X.controls.Text_Node=gi;X.Page_Context=Jd;X.Selection_Scope=Qd;X.Intersection_Finder=xi;X.parse_mount=Zd;X.parse=em;kl.exports=X});var ql=q((rb,Cl)=>{"use strict";Cl.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var Al=q(wi=>{"use strict";var om=Object.prototype.hasOwnProperty,lm;function jl(i){try{return decodeURIComponent(i.replace(/\+/g," "))}catch{return null}}function Tl(i){try{return encodeURIComponent(i)}catch{return null}}function cm(i){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},s;s=e.exec(i);){var r=jl(s[1]),n=jl(s[2]);r===null||n===null||r in t||(t[r]=n)}return t}function _m(i,e){e=e||"";var t=[],s,r;typeof e!="string"&&(e="?");for(r in i)if(om.call(i,r)){if(s=i[r],!s&&(s===null||s===lm||isNaN(s))&&(s=""),r=Tl(r),s=Tl(s),r===null||s===null)continue;t.push(r+"="+s)}return t.length?e+t.join("&"):""}wi.stringify=_m;wi.parse=cm});var Pl=q((nb,Ol)=>{"use strict";var Sl=ql(),Is=Al(),hm=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,El=/[\n\r\t]/g,um=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,zl=/:\d+$/,fm=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,dm=/^[a-zA-Z]:/;function Ci(i){return(i||"").toString().replace(hm,"")}var ki=[["#","hash"],["?","query"],function(e,t){return Fe(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],Dl={hash:1,query:1};function Bl(i){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};i=i||t;var s={},r=typeof i,n;if(i.protocol==="blob:")s=new Oe(unescape(i.pathname),{});else if(r==="string"){s=new Oe(i,{});for(n in Dl)delete s[n]}else if(r==="object"){for(n in i)n in Dl||(s[n]=i[n]);s.slashes===void 0&&(s.slashes=um.test(i.href))}return s}function Fe(i){return i==="file:"||i==="ftp:"||i==="http:"||i==="https:"||i==="ws:"||i==="wss:"}function Fl(i,e){i=Ci(i),i=i.replace(El,""),e=e||{};var t=fm.exec(i),s=t[1]?t[1].toLowerCase():"",r=!!t[2],n=!!t[3],a=0,o;return r?n?(o=t[2]+t[3]+t[4],a=t[2].length+t[3].length):(o=t[2]+t[4],a=t[2].length):n?(o=t[3]+t[4],a=t[3].length):o=t[4],s==="file:"?a>=2&&(o=o.slice(2)):Fe(s)?o=t[4]:s?r&&(o=o.slice(2)):a>=2&&Fe(e.protocol)&&(o=t[4]),{protocol:s,slashes:r||Fe(s),slashesCount:a,rest:o}}function mm(i,e){if(i==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(i.split("/")),s=t.length,r=t[s-1],n=!1,a=0;s--;)t[s]==="."?t.splice(s,1):t[s]===".."?(t.splice(s,1),a++):a&&(s===0&&(n=!0),t.splice(s,1),a--);return n&&t.unshift(""),(r==="."||r==="..")&&t.push(""),t.join("/")}function Oe(i,e,t){if(i=Ci(i),i=i.replace(El,""),!(this instanceof Oe))return new Oe(i,e,t);var s,r,n,a,o,l,_=ki.slice(),u=typeof e,h=this,d=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=Is.parse),e=Bl(e),r=Fl(i||"",e),s=!r.protocol&&!r.slashes,h.slashes=r.slashes||s&&e.slashes,h.protocol=r.protocol||e.protocol||"",i=r.rest,(r.protocol==="file:"&&(r.slashesCount!==2||dm.test(i))||!r.slashes&&(r.protocol||r.slashesCount<2||!Fe(h.protocol)))&&(_[3]=[/(.*)/,"pathname"]);d<_.length;d++){if(a=_[d],typeof a=="function"){i=a(i,h);continue}n=a[0],l=a[1],n!==n?h[l]=i:typeof n=="string"?(o=n==="@"?i.lastIndexOf(n):i.indexOf(n),~o&&(typeof a[2]=="number"?(h[l]=i.slice(0,o),i=i.slice(o+a[2])):(h[l]=i.slice(o),i=i.slice(0,o)))):(o=n.exec(i))&&(h[l]=o[1],i=i.slice(0,o.index)),h[l]=h[l]||s&&a[3]&&e[l]||"",a[4]&&(h[l]=h[l].toLowerCase())}t&&(h.query=t(h.query)),s&&e.slashes&&h.pathname.charAt(0)!=="/"&&(h.pathname!==""||e.pathname!=="")&&(h.pathname=mm(h.pathname,e.pathname)),h.pathname.charAt(0)!=="/"&&Fe(h.protocol)&&(h.pathname="/"+h.pathname),Sl(h.port,h.protocol)||(h.host=h.hostname,h.port=""),h.username=h.password="",h.auth&&(o=h.auth.indexOf(":"),~o?(h.username=h.auth.slice(0,o),h.username=encodeURIComponent(decodeURIComponent(h.username)),h.password=h.auth.slice(o+1),h.password=encodeURIComponent(decodeURIComponent(h.password))):h.username=encodeURIComponent(decodeURIComponent(h.auth)),h.auth=h.password?h.username+":"+h.password:h.username),h.origin=h.protocol!=="file:"&&Fe(h.protocol)&&h.host?h.protocol+"//"+h.host:"null",h.href=h.toString()}function gm(i,e,t){var s=this;switch(i){case"query":typeof e=="string"&&e.length&&(e=(t||Is.parse)(e)),s[i]=e;break;case"port":s[i]=e,Sl(e,s.protocol)?e&&(s.host=s.hostname+":"+e):(s.host=s.hostname,s[i]="");break;case"hostname":s[i]=e,s.port&&(e+=":"+s.port),s.host=e;break;case"host":s[i]=e,zl.test(e)?(e=e.split(":"),s.port=e.pop(),s.hostname=e.join(":")):(s.hostname=e,s.port="");break;case"protocol":s.protocol=e.toLowerCase(),s.slashes=!t;break;case"pathname":case"hash":if(e){var r=i==="pathname"?"/":"#";s[i]=e.charAt(0)!==r?r+e:e}else s[i]=e;break;case"username":case"password":s[i]=encodeURIComponent(e);break;case"auth":var n=e.indexOf(":");~n?(s.username=e.slice(0,n),s.username=encodeURIComponent(decodeURIComponent(s.username)),s.password=e.slice(n+1),s.password=encodeURIComponent(decodeURIComponent(s.password))):s.username=encodeURIComponent(decodeURIComponent(e))}for(var a=0;a<ki.length;a++){var o=ki[a];o[4]&&(s[o[1]]=s[o[1]].toLowerCase())}return s.auth=s.password?s.username+":"+s.password:s.username,s.origin=s.protocol!=="file:"&&Fe(s.protocol)&&s.host?s.protocol+"//"+s.host:"null",s.href=s.toString(),s}function pm(i){(!i||typeof i!="function")&&(i=Is.stringify);var e,t=this,s=t.host,r=t.protocol;r&&r.charAt(r.length-1)!==":"&&(r+=":");var n=r+(t.protocol&&t.slashes||Fe(t.protocol)?"//":"");return t.username?(n+=t.username,t.password&&(n+=":"+t.password),n+="@"):t.password?(n+=":"+t.password,n+="@"):t.protocol!=="file:"&&Fe(t.protocol)&&!s&&t.pathname!=="/"&&(n+="@"),(s[s.length-1]===":"||zl.test(t.hostname)&&!t.port)&&(s+=":"),n+=s+t.pathname,e=typeof t.query=="object"?i(t.query):t.query,e&&(n+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(n+=t.hash),n}Oe.prototype={set:gm,toString:pm};Oe.extractProtocol=Fl;Oe.location=Bl;Oe.trimLeft=Ci;Oe.qs=Is;Ol.exports=Oe});var Nl=q((ab,Ll)=>{var Kt=class{constructor(e){e=e||{},e.handler&&(this.handler=e.handler),this.mapNormalPathChildren={}}},Us=class{constructor(e){this.name=e.name,e.handler&&(this.handler=e.handler),this.mapNormalPathChildren={}}},$s=class{constructor(e){}},xt=class{constructor(e){this.root=new Kt}get arr_paths(){let e=[],t=s=>{if(s.mapNormalPathChildren){console.log("node.name",s.name);let r=Object.entries(s.mapNormalPathChildren);if(r.length>0)for(let n=0;n<r.length;n++)t(r[n])}};return e}setRoot404(e){this.root404Handler=e}set(e,t,s){if(s||(s=t,t=void 0),e=="/")t&&(this.root.context=t),this.root.handler=s;else{e.substr(0,1)=="/"&&(e=e.substr(1)),e.substr(e.length-1)=="/"&&(e=e.substr(0,e.length-1));for(var r=e.split("/"),n=this.root,a=0;a<r.length;){var o=r[a],l=o.substr(0,1)==":",_=o=="*";if(l){var u=o.substr(1);n.variableChild||(n.variableChild=new Us({name:u}),a==r.length-1&&(n.variableChild.handler=s,t&&(n.variableChild.context=t))),n=n.variableChild}else if(_)n.wildcardChild=new $s,n.wildcardChild.handler=s,t&&(n.wildcardChild.context=t);else{var h=n.mapNormalPathChildren[o];h||(n.mapNormalPathChildren[o]=new Kt,h=n.mapNormalPathChildren[o]),a===r.length-1&&(n.mapNormalPathChildren[o].handler=s,t&&(n.mapNormalPathChildren[o].context=t)),n=h}a++}}}get(e){var t;if(e=="/"){var s=this.root;if(s.context)return[s.context,this.root.handler,{}];var r;if(this.root.handler)r=this.root.handler;else if(this.root.wildcardChild&&this.root.wildcardChild.handler)return this.root.wildcardChild.context?[this.root.wildcardChild.context,this.root.wildcardChild.handler,{}]:this.root.wildcardChild.handler;return r}else{e.substr(e.length-1)=="/"&&(e=e.substr(0,e.length-1)),e.substr(0,1)=="/"&&(e=e.substr(1));var n=e.indexOf("?");n>-1&&(e=e.substr(0,n));for(var a=e.split("/"),o=this.root,l=0;l<a.length;){var _=a[l];if(o){var u=o.mapNormalPathChildren[_];if(!u){if(o.variableChild)u=o.variableChild,t=t||{},t[o.variableChild.name]=decodeURI(_);else if(o.wildcardChild){var h=a.slice(l),d=h.join("/");return e.endsWith("/")&&(d+="/"),o.wildcardChild.context?[o.wildcardChild.context,o.wildcardChild.handler,{wildcard_value:d}]:[o.wildcardChild.handler,{wildcard_value:d}]}}}if(l===a.length-1){if(u){if(u.handler)return t?u.context?[u.context,u.handler,t]:[u.handler,t]:u.context?[u.context,u.handler]:u.handler;if(u.wildcardChild){var h=a.slice(l),d=h.join("/");return t?(t.wildcard_value=decodeURI(d),u.wildcardChild.context?[u.wildcardChild.context,u.wildcardChild.handler,t]:[u.wildcardChild.handler,t]):u.wildcardChild.context?[u.wildcardChild.context,u.wildcardChild.handler,t]:[u.wildcardChild.handler,{wildcard_value:d}]}}else if(o)return[o.handler,t]}o=u,l++}return this.root404Handler}}};xt.Node=Kt;xt.Variable_Node=Us;xt.Wildcard_Node=$s;Ll.exports=xt});var Vl=q((ob,Hl)=>{var vm=Pl(),Ml=_e(),qi=Ml.tof,ym=Ml.get_item_sig,Rl=Nl(),Gs=class{constructor(e){e=e||{},e.name?this.name=e.name:this.name="Router",this.routing_tree=new Rl}start(e){e(null,!0)}set_route(e,t,s){return this.routing_tree.set(e,t,s)}meets_requirements(){return!0}get arr_paths(){return this.routing_tree.arr_paths}process(e,t){var s=this.routing_tree;let r;try{r=vm(e.url,!0)}catch{console.log("error parsing url",e.url)}if(r){var n=r.pathname.substr(1).split("/"),a=s.get(e.url),o,l;if(qi(a)==="array"){o=a;var _,u,h;if(a.length===2){var d=ym(a,1);d=="[D,f]"&&(_=o[0],u=o[1]),d=="[f,o]"&&(u=o[0],h=o[1])}if(a.length===3&&(_=o[0],u=o[1],h=o[2]),h&&(e.params=h),_)u.call(_,e,t);else if(l=typeof u,typeof u=="function")u(e,t);else if(l==="undefined"){let f=e.connection.remoteAddress;return n[n.length-1].indexOf(".php")>-1,console.log("1) no defined route result ",f.padEnd(16," "),n),!1}else throw console.log("handler",u),"Expected handler to be a function"}else if(qi(a)==="function")_?a.call(_,e,t):a(e,t);else if(qi(a)==="undefined")return console.log("2) no defined route result",n),!1;return!0}else return!1}};Gs.Routing_Tree=Rl;Hl.exports=Gs});var Jt=q((mb,Ul)=>{var Ae=xe(),lb=Ae.stringify,Yl=Ae.each,cb=Ae.arrayify,_b=Ae.tof,Il=Ae.get_a_sig,hb=Ae.filter_map_by_regex,xm=Ae.Evented_Class,ub=Ae.Data_Object,fb=Ae.fp,db=Ae.is_defined,bm=Ae.Collection,ji=class extends xm{constructor(e){super(e),this.resources=new bm({fn_index:t=>{var s=t.name;return s}})}add(e){var t=e.name;let s=()=>{console.log(""),console.log("** obj_name "+t),console.trace(),console.log("")};if(t===void 0)throw console.log("obj",e),console.trace(),"Resource_Pool.add(undefined) error";if(this.has_resource(t))throw"Resource pool already has resource with name "+t;this.resources.add(e),e.pool=this,e.name!==void 0&&Object.defineProperty(this,e.name,{get(){return e}}),this.raise_event("added",e)}push(e){return this.add(e)}has_resource(){let e=arguments;if(Il(e,1)=="[s]"){let s=e[0];return this.resources.has(s)}}get resource_names(){var e=[];return Yl(this.resources,t=>{e.push(t.name)}),e}get_resource(){var e=arguments;e.l=arguments.length;var t=Il(e,1);if(t==="[s]"){var s=e[0],r=this.resources.find(s);if(r)var n=r;return n}}count(){return this.resources.length}start(e){var t=[];this.resources.each(function(_,u){var h=_.meets_requirements();h&&t.push(_)});var s=this.resources.length();if(t.length===s){var r=[],n=t.length,a=0,o=0,l=function(_,u){a--,o++,o==n&&e&&e(null,!0)};Yl(t,_=>{_.start(l),a++})}}};Ul.exports=ji});var Xs=q((Cb,Gl)=>{var Pe=xe(),wm=Jt(),km=Pe.Evented_Class,gb=Pe.Class,pb=Pe.Collection,$l=Pe.is_defined,vb=Pe.fp,yb=Pe.stringify,xb=Pe.tof,bb=Pe.call_multi,wb=Pe.get_a_sig,kb=Pe.each,Ws=class extends km{constructor(e){$l(e)||(e={}),super(e),e.name&&(this.name=e.name),e.pool&&(this.pool=e.pool),$l(e.startup_type)&&(this.startup_type=e.startup_type),this.getters={},this.setters={}}start(e){e(null,!0)}meets_requirements(){return!0}get_abstract(){}authenticate(e){return!0}};Ws.Pool=wm;Gl.exports=Ws});var Kl=q((Fb,Xl)=>{var Le=xe(),Cm=Jt(),qb=Le.Evented_Class,jb=Le.Class,Tb=Le.Collection,Ti=Le.is_defined,Ab=Le.fp,Db=Le.stringify,Sb=Le.tof,Eb=Le.call_multi,zb=Le.get_a_sig,Bb=Le.each,Wl=Xs(),Ai=class extends Wl{constructor(e){Ti(e)||(e={}),super(e),Ti(e.name),e.name&&(this.name=e.name),e.pool&&(this.pool=e.pool),Ti(e.startup_type)&&(this.startup_type=e.startup_type),this.getters={},this.setters={}}start(e){e(null,!0)}meets_requirements(){return!0}get_abstract(){}authenticate(e){return!0}set(e,t,s){var r=arguments.length;r===3&&this.setters[e]&&this.setters[e](t,s)}get(e,t){var s=arguments.length;s===2&&this.getters[e]&&this.getters[e](t)}};Wl.Pool=Cm;Xl.exports=Ai});var Ks=q((Yb,Ql)=>{var Ne=xe(),qm=Jt(),Ob=Ne.Evented_Class,Pb=Ne.Class,Lb=Ne.Collection,Di=Ne.is_defined,Nb=Ne.fp,Mb=Ne.stringify,jm=Ne.tof,Rb=Ne.call_multi,Hb=Ne.get_a_sig,Vb=Ne.each,Jl=Xs(),Si=class extends Jl{constructor(e){Di(e)||(e={}),super(e),Di(e.name),e.name&&(this.name=e.name),e.pool&&(this.pool=e.pool);let t={info:{},fn:{}};Object.defineProperty(this,"meta",{get(){return t}}),Object.defineProperty(this,"m",{get(){return t}}),Object.defineProperty(t,"i",{get(){return t.info}}),Object.defineProperty(t,"fns",{get(){return t.fn}}),Object.defineProperty(t,"fn",{get(){return t.fn}}),Object.defineProperty(t,"f",{get(){return t.fn}}),e.fn_transform&&jm(e.transform)==="function"&&(t.fn.transform=e.fn_transform),Di(e.startup_type)&&(this.startup_type=e.startup_type)}start(e){e(null,!0)}meets_requirements(){return!0}get_abstract(){}authenticate(e){return!0}transform(e,t){throw"Need specific implementation"}};Jl.Pool=qm;Ql.exports=Si});var ec=q((Ib,Zl)=>{var Tm=Ks(),Ei=class extends Tm{constructor(e){super(e)}};Zl.exports=Ei});var sc=q((Ub,tc)=>{var Am=Ks(),zi=class extends Am{constructor(e){super(e)}};tc.exports=zi});var _t=q(($b,Bi)=>{var Dm=N(),Sm=Dm.Control,Js=class extends Sm{constructor(e={},t,s){e.__type_name=e.__type_name||"button",e.tag_name="button",super(e),this.add_class("button"),(e.text||e.label)&&(this.text=e.text||e.label),e.el||this.compose_button()}compose_button(){this.text&&this.add(this.text)}activate(){super.activate()}};Bi.exports=Js;if(ye.main===Bi){class i extends Js{constructor(s={},r,n){s.text="London, England",super(s,r,n)}}let e=new i;console.log(e.all_html_render())}});var Oi=q((Xb,ic)=>{var Qt=N(),Wb=Qt.Control,rc=Qt.is_defined,Em=_t(),Fi=class extends Em{constructor(e,t,s){e.size=e.size||[32,32],e.text=void 0,e.__type_name=e.__type_name||"arrow_button",super(e);let r=0;Object.defineProperty(this,"rotation",{get(){return r},set(a){r=a,this.raise("change",{name:"rotation",value:a})},enumerable:!0,configurable:!0});let n;this.on("change",a=>{a.name==="rotation"&&(this.line.dom.attributes.transform="rotate("+a.value+", 50, 50)",this.polygon.dom.attributes.transform="rotate("+a.value+", 50, 50)"),a.name==="direction"&&(a.value==="left"&&(this.rotation=270),a.value==="up"&&(this.rotation=0),a.value==="right"&&(this.rotation=90),a.value==="down"&&(this.rotation=180))}),Object.defineProperty(this,"direction",{get(){return n},set(a){n=a,this.raise("change",{name:"direction",value:a})},enumerable:!0,configurable:!0}),rc(e.rotation)&&(r=e.rotation),e.el||this.compose_arrow_button(),rc(e.direction)&&(this.direction=e.direction)}compose_arrow_button(){this.add_class("arrow");let e=this.svg=new Qt.svg({context:this.context});e.dom.attributes.viewBox="0 0 100 100";let t=this.polygon=new Qt.polygon({context:this.context});t.dom.attributes.points="50 0, 70 20, 30 20";let s=this.line=new Qt.line({context:this.context});s.dom.attributes.x1=50,s.dom.attributes.y1=96,s.dom.attributes.x2=50,s.dom.attributes.y2=10,s.dom.attributes.transform="rotate("+this.rotation+", 50, 50)",t.dom.attributes.transform="rotate("+this.rotation+", 50, 50)",s.dom.attributes["stroke-width"]=8,e.add(s),e.add(t),this.add(e)}activate(){super.activate()}};ic.exports=Fi});var Pi=q((Jb,ac)=>{var{prop:Kb,field:zm}=ae(),{each:nc,tof:Bm}=xe(),Fm=(i,e={})=>{let{bounds:t,handle:s,mode:r,start_action:n,condition:a}=e;n=n||["touchstart","mousedown"],Bm(n)==="string"&&(n=[n]);let o,l=t&&t===i.parent;t==="parent"&&(t=i.parent,l=!0),t&&(o=t.pos||[t.dom.el.offsetLeft,t.dom.el.offsetTop]),s=s||i;let _=i.dragable,u=e.drag_mode||e.mode||"body";l&&(u="within-parent");let h,d,f,p,g=i.context.body(),b=!1,k=e.start_distance||6,y,T,j,S,z,U,Q=i.dom.el,Y=new Float32Array(3),W,ee,M=E=>{if(u==="within-parent"&&(b=!0,T=i.pos,i.pos=[T[0]-y[0],T[1]-y[1]]),u==="translate")ee=i.ta.slice(6,8),b=!0;else if(u==="x")b=!0,T=i.pos||[i.dom.el.offsetLeft,i.dom.el.offsetTop],z=Math.round(i.dom.el.offsetWidth/2),U=i.dom.el.offsetWidth,S=[t.dom.el.offsetLeft,t.dom.el.offsetTop],i.pos=[T[0]+y[0],T[1]];else throw console.log("drag_mode",u),"NYI";i.raise("dragstart")},H=E=>{let V=[i.dom.el.offsetWidth,i.dom.el.offsetHeight];if(u==="translate")i.ta[6]=y[0]+ee[0],i.ta[7]=y[1]+ee[1];else if(u==="within-parent"){t=t||i.parent,j=t.bcr()[2];let L=[T[0]+y[0],T[1]+y[1]];L[0]<0&&(L[0]=0),L[1]<0&&(L[1]=0),L[0]>j[0]-V[0]&&(L[0]=j[0]-V[0]),L[1]>j[1]-V[1]&&(L[1]=j[1]-V[1]),i.pos=L}else if(u==="x"){j=[t.dom.el.offsetWidth,t.dom.el.offsetHeight];let L=[T[0]+y[0],T[1]];L[0]<o[0]-z&&(L[0]=o[0]-z),L[0]>j[0]-V[0]+S[0]+z&&(L[0]=j[0]-V[0]+S[0]+z),i.pos=L}},C=E=>{let V=1;if(E.touches&&(V=E.touches.length),d=[E.pageX||E.touches[0].pageX,E.pageY||E.touches[0].pageY],V===1&&(E.pageX||E.touches)){let L=[E.pageX||E.touches[0].pageX,E.pageY||E.touches[0].pageY];if(y=[L[0]-h[0],L[1]-h[1]],b)H(L);else{let B=[Math.abs(y[0]),Math.abs(y[1])];Math.sqrt(Math.pow(B[0],2)+Math.pow(B[1],2))>=k&&M(L)}}},R=E=>{g.off("mousemove",C),g.off("mouseup",I),g.off("touchmove",C),g.off("touchend",I),b&&(b=!1,i.raise("dragend",{movement_offset:y}))},I=E=>{R(E)},D=E=>{(!a||a())&&(E.pageX?p=[E.offsetX,E.offsetX]:p=[0,0],b=!1,h=[E.pageX||E.touches[0].pageX,E.pageY||E.touches[0].pageY],g.on("mousemove",C),g.on("mouseup",I),g.on("touchmove",C),g.on("touchend",I))};_||(zm(i,"dragable"),i.on("change",E=>{let V=E.name,L=E.value;if(V==="dragable")if(L===!0){if(!(typeof document>"u")){let B=P=>{s.has_drag_md_handler||(s.has_drag_md_handler=!0,nc(P,re=>{s.on(re,D)}))};i.once_active(()=>{B(n)})}}else typeof document>"u"||((B=>{nc(B,P=>{s.off(P,D)})})(n),s.has_drag_md_handler=!1)})),_!==void 0&&(i.dragable=_)};ac.exports=Fm});var Mi=q((r0,oc)=>{var Zt=N(),Qb=Zt.stringify,Zb=Zt.each,e0=Zt.tof,Qs=Zt.Control,t0=Zt.v_subtract,{prop:s0,field:Li}=ae(),Om=Pi(),Ni=class extends Qs{constructor(e,t,s){e.__type_name=e.__type_name||"horizontal_slider",super(e),Li(this,"min",e.min||0),Li(this,"value",e.value||0),Li(this,"max",e.max||100),e.el||this.compose_horizontal_slider()}compose_horizontal_slider(){let e,t,s=this.context,r=this.add(new Qs({class:"relative",context:s}));this.add_class("horizontal slider"),e=new Qs({class:"h-bar",context:s}),t=new Qs({class:"v-bar",context:s}),r.add(e),r.add(t);let n={div_relative:r,h_bar:e,v_bar:t};this._ctrl_fields=this._ctrl_fields||{},Object.assign(this._ctrl_fields,n)}activate(){if(!this.__active){super.activate(),console.log("Horizontal Slider activate");var e=this.h_bar,t=this.v_bar;Om(t,{mode:"x",bounds:e,start_distance:1}),t.dragable=!0,t.on("dragend",s=>{let r=t.dom.el.offsetLeft,n=Math.round(t.dom.el.offsetWidth/2),a=r-n,o=e.dom.el.offsetWidth,l=a/o,_=this.max-this.min,u=l*_+this.min;this._.value=u,this.raise("choose-value",u)}),this.on("change",s=>{var r=s.name,n=s.value;r==="value"&&(this.bar_value=n)}),this.on("resize",s=>{this.bar_value=this._.value})}}set bar_value(e){let{h_bar:t,v_bar:s}=this;var r=this.min,n=this.max;let a=(e-r)/(n-r);var o=t.size||[t.dom.el.offsetWidth,t.dom.el.offsetHeight];let _=Math.round(o[0]*a)+t.dom.el.offsetLeft-Math.round(s.dom.el.offsetWidth/2),u=s.dom.el.offsetTop;s.pos?s.pos=[_,s.pos[1]]:s.dom.attributes.style.left=_,this._.value=e}};oc.exports=Ni});var cc=q((l0,lc)=>{var es=N(),Pm=Mi(),i0=es.stringify,n0=es.each,a0=es.tof,Lm=es.Control,o0=es.v_subtract,Ri=class extends Lm{constructor(e,t,s){if(super(e),this.__type_name="audio_volume",!e.abstract&&!e.el){this.add_class("audio-volume");var r=t(Pm({min:0,max:100,value:100})),n={h_slider:r._id()};this.active()}}activate(){super.activate(),console.log("Audio Volume activate");var e=this.h_slider}};lc.exports=Ri});var Zs=q((c0,uc)=>{var hc=N(),{stringify:Nm,each:Mm,tof:_c,Control:Hi}=hc,Vi=class i extends Hi{constructor(e,t,s){if(super(e),this.__type_name="menu_node",!this._abstract&&!e.el){this.add_class("menu-node");var r=e.state,n,a=s(Hi({class:"main"}));if(this.add(a),e.img_src,e.text){this.text=e.text;var o=s(hc.span({}));o.add(e.text),a.add(o)}var l=e.menu;l&&this.set("menu",l);var _=this.inner_control=s(Hi({class:"inner hidden"}));if(this.add(_),e.value){var u=e.value,h=_c(u);console.log("t_obj_menu",h),h=="array"&&Mm(u,function(f){var p=_c(f);if(p=="string"){var g=s(i({text:f,menu:l}));_.add(g)}})}var d={inner_control:_._id(),main_control:a._id(),menu:e.menu._id()};if(this.set("dom.attributes.data-jsgui-ctrl-fields",Nm(d).replace(/"/g,"'")),r)if(r=="open"||r=="closed")n=this.set("state",r);else throw'spec.state expects "open" or "closed".';else n=this.set("state","open")}}activate(){if(!this.__active){super.activate();var e=this.inner_control,t=this.main_control,s=this.menu,r=this}}close_all(){console.log("menu-node close_all");var e=this.inner_control;e.content.each(function(t,s){var r=t.__type_name;r=="menu_node"&&t.close_all()}),e.hide(),this.set("state","closed",!0)}close(){var e=this.inner_control;e.hide(),this.set("state","closed",!0)}open(){var e=this.inner_control;e.show(),this.set("state","open",!0)}};uc.exports=Vi});var mc=q((u0,dc)=>{var bt=N(),fc=Zs(),_0=bt.stringify,Yi=bt.each,Rm=bt.tof,h0=bt.is_defined,Hm=bt.Control,Ii=class extends Hm{constructor(e,t,s){if(super(e),this.__type_name="context_menu",this.add_class("context menu"),!e.abstract){let r=e.value,n=Rm(r);n==="object"&&Yi(r,(a,o)=>{let l=s(fc({text:o,value:a,menu:this}));this.add(l)}),n==="array"&&Yi(r,(a,o)=>{var l=bt.get_item_sig(a,1);if(l=="[s,f]"){var _=a[0],u=a[1],h=s(fc({text:_,value:_,menu:this}));this.add(h)}})}this._features=this._features||[],Yi(["menu"],this._features.push)}activate(){super.activate()}close_all(){console.log("menu close_all"),this.content.each(function(e,t){e.close_all()})}};dc.exports=Ii});var wt=q((d0,pc)=>{var{prop:f0,field:gc}=ae(),Vm=(i,e,t)=>{let s=!1,r=!1,n,a=!0,o=["mousedown","touchstart"];t||e&&(e.activate||(t=e,e=void 0)),t&&(t.handle&&(e=t.handle),(t.select_toggle||t.toggle)&&(s=!0),(t.select_multi||t.multi)&&(r=!0),t.single&&(r=!1),t.selection_action&&(o=t.selection_action),t.condition&&(n=t.condition),t.preventDefault===!1&&(a=!1)),e=e||i;let l=i.selectable,_=f=>{if(console.log("selectable click e",f),i.selectable&&!i.selection_scope&&!i.disabled)if(!n||n()){var p=f.ctrlKey,g=f.metaKey;r?p||g||s?i.action_select_toggle():i.action_select_only():s&&i.selected?i.deselect():i.action_select_only(),a&&f.preventDefault()}else console.log("failed condition check")};i.on("change",f=>{let{name:p,value:g}=f;return p==="selected"&&(g?i.add_class("selected"):i.remove_class("selected")),!0});let u,h=f=>{let p=f._id();f.on("change",g=>{let b=g.name,k=g.value,y=f.find_selection_scope();b==="selected"&&(k===!0?(f.add_class("selected"),y.map_selected_controls[p]=f):(f.remove_class("selected"),y.map_selected_controls[p]=null)),b==="selectable"&&(k===!0?d(f):typeof document>"u"||(Array.isArray(o)?o.forEach(T=>{e.off(T,_)}):e.off(o,_),e.has_selection_click_handler=!1))})},d=f=>{f.deselect=f.deselect||(()=>{u=u||f.find_selection_scope(),u&&u.deselect(f),f.raise("deselect")}),f.select=f.select||(()=>{u=u||f.find_selection_scope(),u&&u.select(f),f.raise("select")}),f.action_select_only=f.action_select_only||(()=>{u=u||f.find_selection_scope(),u&&u.select_only(f)}),f.action_select_toggle=f.action_select_toggle||(()=>{u=u||f.find_selection_scope(),u.select_toggle(f)}),typeof document>"u"||f.once_active(()=>{e.has_selection_click_handler||(e.has_selection_click_handler=!0,Array.isArray(o)?o.forEach(p=>{e.on(p,_)}):e.on(o,_))})};l||(gc(i,"selected"),gc(i,"selectable"),h(i)),i.on("activate",f=>{i.selectable&&h(i)}),l!==void 0&&(i.selectable=l)};pc.exports=Vm});var rs=q((p0,vc)=>{var tr=N(),{stringify:m0,each:er,tof:Ui,def:g0,Control:Me}=tr,Ym=wt(),{prop:Im,field:ht}=ae(),ts=class extends Me{constructor(e){(e=e||{}).__type_name="grid_cell",super(e),this.add_class("cell"),ht(this,"x",e.x),ht(this,"y",e.y),ht(this,"data",e.data),e.el||this.compose_grid_cell()}compose_grid_cell(){let e={context:this.context};this.data&&(e.text=this.data),this.add(this.span=new tr.span(e))}activate(){this.__active||(super.activate(),Ym(this))}},ss=class extends Me{constructor(e,t,s){e=e||{},e.__type_name=e.__type_name||"grid",super(e),e.cell_selection&&(this.cell_selection=e.cell_selection),this.add_class("grid");var r=e.data;this._arr_rows=[],ht(this,"composition_mode"),e.composition_mode?this.composition_mode=e.composition_mode:this.composition_mode="divs";let n;if(Object.defineProperty(this,"grid_size",{get(){return n},set(o){if(Array.isArray(o)&&o.length===2){let l=n;n=o,console.log("set _grid_size",o),this.raise("change",{name:"grid_size",old:l,value:o})}else throw"Invalid grid_size. Expected [x, y]"}}),e.grid_size&&(n=e.grid_size),ht(this,"cell_size"),e.cell_size&&(this.cell_size=e.cell_size),ht(this,"column_headers",!1),ht(this,"row_headers",!1),Im(this,"data",!1),this.map_cells={},this.arr_cells={},e.data&&Ui(e.data)==="array"){let l=-1,_,u,h,d,f=e.data,p;for(h=f.length,_=0;_<h;_++)for(p=f[_],d=p.length,d>l&&(l=d),u=0;u<d;u++);n=[l,h]}if(!e.el){var a;this.full_compose_as_divs(),this._fields=this._fields||{},Object.assign(this._fields,{composition_mode:this.composition_mode,grid_size:this.grid_size}),this.cell_size&&(this._fields.cell_size=this.cell_size)}this.changes({grid_size:o=>{e.el||(this.clear(),this.full_compose_as_divs())}})}refresh_size(){if(console.log("grid.js refresh_size this.composition_mode",this.composition_mode),this.composition_mode==="divs"){let[n,a]=this.grid_size;var e=1,t=e*2;if(this.size){var s=this.cell_size||[Math.floor(this.size[0]/n)-t,Math.floor(this.size[1]/a)-t],r=2;this.each_row(o=>{o.size=[this.size[0],s[1]+r]}),this.each_cell(o=>{o.size=s})}else console.log(".size was not available")}}each_row(e){er(this._arr_rows,e)}each_cell(e){console.log("this._arr_rows.length",this._arr_rows.length),er(this._arr_rows,(t,s)=>{t.content.each((r,n)=>{e(r,[n,s])})})}get_cell(e,t){}add_cell(e){var t=new ts({context:this.context});return this.cell_selection&&(t.selectable=!0),e&&t.add(e),t.active(),this.main.add(t),t}full_compose_as_divs(){console.log("* full_compose_as_divs");let e=this.main=new Me({context:this.context,class:"main"});this.add(e);let t=this.main=new Me({context:this.context,class:"rows"});e.add(t);let s=this.map_cells,r=this.arr_cells;if(this.grid_size){let[h,d]=this.grid_size;var n=0,a=n*2;let f;this.size?f=this.cell_size||[Math.floor(this.size[0]/h)-a,Math.floor(this.size[1]/d)-a]:f=this.cell_size;let p,g,b;this.cell_size?(this.row_headers?(b=this.row_headers.width||b,p=this.cell_size[0]*h+b):p=this.cell_size[0]*h,g=this.cell_size[1]):this.size&&(g=Math.floor(this.size[1]/d));let k=this.data;var o,l;if(this.column_headers){let y=new Me({context:this.context});if(y.add_class("header"),y.add_class("row"),g&&y.style("height",g),p&&y.style("width",p),t.add(y),this.row_headers){var _=new Me({context:this.context,__type_name:"grid_cell"});_.add_class("grid-header"),_.add_class("cell"),b?_.size=[b,f[1]]:_.size=f,y.add(_)}for(o=0;o<h;o++){var _=new Me({context:this.context,__type_name:"grid_cell"});_.add_class("column-header"),_.add_class("cell"),_.size=f,y.add(_)}}for(l=0;l<d;l++){var u=new Me({context:this.context});if(g&&u.style("height",g),p&&u.style("width",p),u.add_class("row"),this._arr_rows.push(u),t.add(u),this.row_headers){var _=new Me({context:this.context,__type_name:"grid_cell"});_.add_class("row-header"),_.add_class("cell"),b?_.size=[b,f[1]]:_.size=f,u.add(_)}for(o=0;o<h;o++){let y={context:this.context,x:o,y:l};k&&(y.data=k[l][o]);var _=new ts(y);f&&(_.size=f),u.add(_),r[o]=r[o]||[],r[o][l]=_,s["["+o+","+l+"]"]=_}}}this._ctrl_fields=this._ctrl_fields||{},this._ctrl_fields.main=e,this._ctrl_fields.rows=t}full_compose_as_table(){this.dom.tagName=table;var e=this.data,t=e.range,s;if(Ui(e)==="data_grid"){var r,n,a=t[0],o=t[1],l,_,u=this.size().value(),h={context:this.context,tagName:"tbody"};u&&(h.size=[u[0][0],u[1][0]]);var d=new Me(h);for(this.add(d),n=0;n<=o;n++)for(_=new tr.tr({context:this.context}),d.add(_),r=0;r<=a;r++)l=new tr.td({context:this.context}),_.add(l),s=e.get(r,n),l.add_text(s)}else throw"Unexpected data type. Expected data_grid, got "+Ui(e)}activate(){if(!this.__active){super.activate(),console.log("activate Grid"),this.selection_scope=this.context.new_selection_scope(this);var e=()=>{var s=this._arr_rows=[];this.rows.content._arr.forEach(r=>{s.push(r)})};e();var t=()=>{er(this._arr_rows,s=>{er(s.content._arr,r=>{})})};this.each_cell(s=>{s.activate()})}}};ss.Cell=ss.Grid_Cell=ts;vc.exports=ss});var bc=q((w0,Gi)=>{var kt=N(),Um=rs(),$m=kt.stringify,v0=kt.each,y0=kt.tof,x0=kt.is_defined,Gm=kt.Control,Wm=kt.util.v_subtract,{field:b0,prop:yc}=ae(),xc=[{hex:"#EFDECD",name:"Almond",rgb:"(239, 222, 205)"},{hex:"#CD9575",name:"Antique Brass",rgb:"(205, 149, 117)"},{hex:"#FDD9B5",name:"Apricot",rgb:"(253, 217, 181)"},{hex:"#78DBE2",name:"Aquamarine",rgb:"(120, 219, 226)"},{hex:"#87A96B",name:"Asparagus",rgb:"(135, 169, 107)"},{hex:"#FFA474",name:"Atomic Tangerine",rgb:"(255, 164, 116)"},{hex:"#FAE7B5",name:"Banana Mania",rgb:"(250, 231, 181)"},{hex:"#9F8170",name:"Beaver",rgb:"(159, 129, 112)"},{hex:"#FD7C6E",name:"Bittersweet",rgb:"(253, 124, 110)"},{hex:"#000000",name:"Black",rgb:"(0,0,0)"},{hex:"#ACE5EE",name:"Blizzard Blue",rgb:"(172, 229, 238)"},{hex:"#1F75FE",name:"Blue",rgb:"(31, 117, 254)"},{hex:"#A2A2D0",name:"Blue Bell",rgb:"(162, 162, 208)"},{hex:"#6699CC",name:"Blue Gray",rgb:"(102, 153, 204)"},{hex:"#0D98BA",name:"Blue Green",rgb:"(13, 152, 186)"},{hex:"#7366BD",name:"Blue Violet",rgb:"(115, 102, 189)"},{hex:"#DE5D83",name:"Blush",rgb:"(222, 93, 131)"},{hex:"#CB4154",name:"Brick Red",rgb:"(203, 65, 84)"},{hex:"#B4674D",name:"Brown",rgb:"(180, 103, 77)"},{hex:"#FF7F49",name:"Burnt Orange",rgb:"(255, 127, 73)"},{hex:"#EA7E5D",name:"Burnt Sienna",rgb:"(234, 126, 93)"},{hex:"#B0B7C6",name:"Cadet Blue",rgb:"(176, 183, 198)"},{hex:"#FFFF99",name:"Canary",rgb:"(255, 255, 153)"},{hex:"#1CD3A2",name:"Caribbean Green",rgb:"(28, 211, 162)"},{hex:"#FFAACC",name:"Carnation Pink",rgb:"(255, 170, 204)"},{hex:"#DD4492",name:"Cerise",rgb:"(221, 68, 146)"},{hex:"#1DACD6",name:"Cerulean",rgb:"(29, 172, 214)"},{hex:"#BC5D58",name:"Chestnut",rgb:"(188, 93, 88)"},{hex:"#DD9475",name:"Copper",rgb:"(221, 148, 117)"},{hex:"#9ACEEB",name:"Cornflower",rgb:"(154, 206, 235)"},{hex:"#FFBCD9",name:"Cotton Candy",rgb:"(255, 188, 217)"},{hex:"#FDDB6D",name:"Dandelion",rgb:"(253, 219, 109)"},{hex:"#2B6CC4",name:"Denim",rgb:"(43, 108, 196)"},{hex:"#EFCDB8",name:"Desert Sand",rgb:"(239, 205, 184)"},{hex:"#6E5160",name:"Eggplant",rgb:"(110, 81, 96)"},{hex:"#CEFF1D",name:"Electric Lime",rgb:"(206, 255, 29)"},{hex:"#71BC78",name:"Fern",rgb:"(113, 188, 120)"},{hex:"#6DAE81",name:"Forest Green",rgb:"(109, 174, 129)"},{hex:"#C364C5",name:"Fuchsia",rgb:"(195, 100, 197)"},{hex:"#CC6666",name:"Fuzzy Wuzzy",rgb:"(204, 102, 102)"},{hex:"#E7C697",name:"Gold",rgb:"(231, 198, 151)"},{hex:"#FCD975",name:"Goldenrod",rgb:"(252, 217, 117)"},{hex:"#A8E4A0",name:"Granny Smith Apple",rgb:"(168, 228, 160)"},{hex:"#95918C",name:"Gray",rgb:"(149, 145, 140)"},{hex:"#1CAC78",name:"Green",rgb:"(28, 172, 120)"},{hex:"#1164B4",name:"Green Blue",rgb:"(17, 100, 180)"},{hex:"#F0E891",name:"Green Yellow",rgb:"(240, 232, 145)"},{hex:"#FF1DCE",name:"Hot Magenta",rgb:"(255, 29, 206)"},{hex:"#B2EC5D",name:"Inchworm",rgb:"(178, 236, 93)"},{hex:"#5D76CB",name:"Indigo",rgb:"(93, 118, 203)"},{hex:"#CA3767",name:"Jazzberry Jam",rgb:"(202, 55, 103)"},{hex:"#3BB08F",name:"Jungle Green",rgb:"(59, 176, 143)"},{hex:"#FEFE22",name:"Laser Lemon",rgb:"(254, 254, 34)"},{hex:"#FCB4D5",name:"Lavender",rgb:"(252, 180, 213)"},{hex:"#FFF44F",name:"Lemon Yellow",rgb:"(255, 244, 79)"},{hex:"#FFBD88",name:"Macaroni and Cheese",rgb:"(255, 189, 136)"},{hex:"#F664AF",name:"Magenta",rgb:"(246, 100, 175)"},{hex:"#AAF0D1",name:"Magic Mint",rgb:"(170, 240, 209)"},{hex:"#CD4A4C",name:"Mahogany",rgb:"(205, 74, 76)"},{hex:"#EDD19C",name:"Maize",rgb:"(237, 209, 156)"},{hex:"#979AAA",name:"Manatee",rgb:"(151, 154, 170)"},{hex:"#FF8243",name:"Mango Tango",rgb:"(255, 130, 67)"},{hex:"#C8385A",name:"Maroon",rgb:"(200, 56, 90)"},{hex:"#EF98AA",name:"Mauvelous",rgb:"(239, 152, 170)"},{hex:"#FDBCB4",name:"Melon",rgb:"(253, 188, 180)"},{hex:"#1A4876",name:"Midnight Blue",rgb:"(26, 72, 118)"},{hex:"#30BA8F",name:"Mountain Meadow",rgb:"(48, 186, 143)"},{hex:"#C54B8C",name:"Mulberry",rgb:"(197, 75, 140)"},{hex:"#1974D2",name:"Navy Blue",rgb:"(25, 116, 210)"},{hex:"#FFA343",name:"Neon Carrot",rgb:"(255, 163, 67)"},{hex:"#BAB86C",name:"Olive Green",rgb:"(186, 184, 108)"},{hex:"#FF7538",name:"Orange",rgb:"(255, 117, 56)"},{hex:"#FF2B2B",name:"Orange Red",rgb:"(255, 43, 43)"},{hex:"#F8D568",name:"Orange Yellow",rgb:"(248, 213, 104)"},{hex:"#E6A8D7",name:"Orchid",rgb:"(230, 168, 215)"},{hex:"#414A4C",name:"Outer Space",rgb:"(65, 74, 76)"},{hex:"#FF6E4A",name:"Outrageous Orange",rgb:"(255, 110, 74)"},{hex:"#1CA9C9",name:"Pacific Blue",rgb:"(28, 169, 201)"},{hex:"#FFCFAB",name:"Peach",rgb:"(255, 207, 171)"},{hex:"#C5D0E6",name:"Periwinkle",rgb:"(197, 208, 230)"},{hex:"#FDDDE6",name:"Piggy Pink",rgb:"(253, 221, 230)"},{hex:"#158078",name:"Pine Green",rgb:"(21, 128, 120)"},{hex:"#FC74FD",name:"Pink Flamingo",rgb:"(252, 116, 253)"},{hex:"#F78FA7",name:"Pink Sherbet",rgb:"(247, 143, 167)"},{hex:"#8E4585",name:"Plum",rgb:"(142, 69, 133)"},{hex:"#7442C8",name:"Purple Heart",rgb:"(116, 66, 200)"},{hex:"#9D81BA",name:"Purple Mountain's Majesty",rgb:"(157, 129, 186)"},{hex:"#FE4EDA",name:"Purple Pizzazz",rgb:"(254, 78, 218)"},{hex:"#FF496C",name:"Radical Red",rgb:"(255, 73, 108)"},{hex:"#D68A59",name:"Raw Sienna",rgb:"(214, 138, 89)"},{hex:"#714B23",name:"Raw Umber",rgb:"(113, 75, 35)"},{hex:"#FF48D0",name:"Razzle Dazzle Rose",rgb:"(255, 72, 208)"},{hex:"#E3256B",name:"Razzmatazz",rgb:"(227, 37, 107)"},{hex:"#EE204D",name:"Red",rgb:"(238,32 ,77 )"},{hex:"#FF5349",name:"Red Orange",rgb:"(255, 83, 73)"},{hex:"#C0448F",name:"Red Violet",rgb:"(192, 68, 143)"},{hex:"#1FCECB",name:"Robin's Egg Blue",rgb:"(31, 206, 203)"},{hex:"#7851A9",name:"Royal Purple",rgb:"(120, 81, 169)"},{hex:"#FF9BAA",name:"Salmon",rgb:"(255, 155, 170)"},{hex:"#FC2847",name:"Scarlet",rgb:"(252, 40, 71)"},{hex:"#76FF7A",name:"Screamin' Green",rgb:"(118, 255, 122)"},{hex:"#9FE2BF",name:"Sea Green",rgb:"(159, 226, 191)"},{hex:"#A5694F",name:"Sepia",rgb:"(165, 105, 79)"},{hex:"#8A795D",name:"Shadow",rgb:"(138, 121, 93)"},{hex:"#45CEA2",name:"Shamrock",rgb:"(69, 206, 162)"},{hex:"#FB7EFD",name:"Shocking Pink",rgb:"(251, 126, 253)"},{hex:"#CDC5C2",name:"Silver",rgb:"(205, 197, 194)"},{hex:"#80DAEB",name:"Sky Blue",rgb:"(128, 218, 235)"},{hex:"#ECEABE",name:"Spring Green",rgb:"(236, 234, 190)"},{hex:"#FFCF48",name:"Sunglow",rgb:"(255, 207, 72)"},{hex:"#FD5E53",name:"Sunset Orange",rgb:"(253, 94, 83)"},{hex:"#FAA76C",name:"Tan",rgb:"(250, 167, 108)"},{hex:"#18A7B5",name:"Teal Blue",rgb:"(24, 167, 181)"},{hex:"#EBC7DF",name:"Thistle",rgb:"(235, 199, 223)"},{hex:"#FC89AC",name:"Tickle Me Pink",rgb:"(252, 137, 172)"},{hex:"#DBD7D2",name:"Timberwolf",rgb:"(219, 215, 210)"},{hex:"#17806D",name:"Tropical Rain Forest",rgb:"(23, 128, 109)"},{hex:"#DEAA88",name:"Tumbleweed",rgb:"(222, 170, 136)"},{hex:"#77DDE7",name:"Turquoise Blue",rgb:"(119, 221, 231)"},{hex:"#FFFF66",name:"Unmellow Yellow",rgb:"(255, 255, 102)"},{hex:"#926EAE",name:"Violet (Purple)",rgb:"(146, 110, 174)"},{hex:"#324AB2",name:"Violet Blue",rgb:"(50, 74, 178)"},{hex:"#F75394",name:"Violet Red",rgb:"(247, 83, 148)"},{hex:"#FFA089",name:"Vivid Tangerine",rgb:"(255, 160, 137)"},{hex:"#8F509D",name:"Vivid Violet",rgb:"(143, 80, 157)"},{hex:"#FFFFFF",name:"White",rgb:"(255, 255, 255)"},{hex:"#A2ADD0",name:"Wild Blue Yonder",rgb:"(162, 173, 208)"},{hex:"#FF43A4",name:"Wild Strawberry",rgb:"(255, 67, 164)"},{hex:"#FC6C85",name:"Wild Watermelon",rgb:"(252, 108, 133)"},{hex:"#CDA4DE",name:"Wisteria",rgb:"(205, 164, 222)"},{hex:"#FCE883",name:"Yellow",rgb:"(252, 232, 131)"},{hex:"#C5E384",name:"Yellow Green",rgb:"(197, 227, 132)"},{hex:"#FFAE42",name:"Yellow Orange",rgb:"(255, 174, 66)"}],$i=class extends Gm{constructor(e){e=e||{},e.__type_name=e.__type_name||"color_palette",super(e),this.add_class("color-palette"),this.internal_relative_div=!0,yc(this,"palette",e.palette||xc),yc(this,"grid_size",e.grid_size||[12,12]),!e.abstract&&!e.el&&this.compose_color_palette(),this.on("resize",t=>{if(this.grid){var s=12,r=Wm(t.value,[s,s]);this.grid.size=r}})}activate(){this.activate.__active||(super.activate(),this.grid.selection_scope.on("change",e=>{let{name:t,value:s}=e;if(t==="selected"){let r=s;if(r){let n=r._color;this.raise("choose-color",{value:n})}}}),this.grid.each_cell(e=>{e.selectable=!0}))}each_cell(e){return this.grid.each_cell(e)}add_grid_cells(){let e=0;this.grid.each_cell(t=>{var s=this.palette[e++];s&&(s.hex?t.color=s.hex:typeof s=="string"&&(t.color=s))})}refresh(){this.clear(),this.compose_color_palette()}compose_color_palette(){console.log("compose_color_palette");var e=6;console.log("this.grid_size",this.grid_size);let t=this.grid=new Um({context:this.context,grid_size:this.grid_size,cell_selection:"single"});console.log(`pre each cell

`),t.each_cell((s,[r,n])=>{}),this.add(t),this.__active&&(console.log("pre activate grid"),this.grid.activate()),this.add_grid_cells(),this.dom.attributes["data-jsgui-ctrl-fields"]=$m({grid:this.grid._id()}).replace(/"/g,"'")}};ye.main===Gi&&console.log("pal_crayola.length",xc.length);Gi.exports=$i});var kc=q((T0,wc)=>{var Ct=N(),Xm=Ct.stringify,C0=Ct.each,q0=Ct.tof,Km=Ct.is_defined,Wi=Ct.Control,j0=Ct.group,Xi=class extends Wi{constructor(e,t,s){super(e),this.__type_name="checkbox",this.add_class("checkbox");var r=this.context;if(!e.abstract&&!e.el){var n=this.name,a=new Wi({context:r});a.set("dom.tagName","input"),a.set("dom.attributes.type","checkbox"),a.set("dom.attributes.name",n),a.set("dom.attributes.id",html_radio._id());var o=new Wi({context:r});o.set("dom.tagName","label");var l=this.get("text").value();Km(l)&&o.add(l),o.set("dom.attributes.for",a._id()),this.add(a),this.add(o),this.set("check",a),this.set("label",o),this.set("dom.attributes.data-jsgui-fields",Xm({value:this.get("value")}).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]"))}}activate(){if(!this.__active){super.activate();var e=this.check,t=e.dom.el,s=this.label;radio.on("change",r=>{this.raise("change",{name:"checked",value:t.checked})})}}};wc.exports=Xi});var qc=q((A0,Cc)=>{var Jm=N(),Qm=Jm.Control,Ki=class extends Qm{constructor(e){e.__type_name=e.__type_name||"combo_box",super(e)}};Cc.exports=Ki});var Qi=q((B0,jc)=>{var sr=N(),D0=sr.stringify,S0=sr.each,E0=sr.tof,Zm=sr.Control,{prop:z0,field:eg}=ae(),Ji=class extends Zm{constructor(e){e.__type_name=e.__type_name||"text_input",e.class="text-input",super(e),eg(this,"value"),e.placeholder&&(this.placeholder=e.placeholder),e.el||this.compose_text_input()}compose_text_input(){this.dom.tagName="input",this.dom.attributes.type="input",this.dom.attributes.value=this.value,this.placeholder&&(this.dom.attributes.placeholder=this.placeholder)}activate(){if(!this.__active){super.activate();let{dom:e}=this;this.on("keypress",t=>{setTimeout(()=>{this.value=e.el.value},0)})}}};jc.exports=Ji});var en=q((L0,Tc)=>{var is=N(),F0=is.stringify,O0=is.each,P0=is.tof,tg=is.Control,sg=[["value",String,""]],Zi=class extends tg{constructor(e){super(e,sg),this.__type_name="text_item",this.add_class("item"),this.add(new is.textNode({text:this.value,context:this.context}))}};Tc.exports=Zi});var rr=q((N0,Ac)=>{var ns=N(),rg=Qi(),ig=en(),ng=ns.Control,ag=[["text",String],["name",String],["value",String],["type",String],["editable",Boolean,!0],["show_text",Boolean,!0]],tn=class extends ng{constructor(e){super(e,ag),this.__type_name="text_field",this.add_class("field"),e.type&&(this.type=e.type),e.placeholder&&(this.placeholder=e.placeholder),e.el||this.compose_text_field()}compose_text_field(){var e=new ns.div({context:this.context});e.add_class("left");var t=new ns.div({context:this.context});t.add_class("right"),this.add(e),this.add(t);var s=new ns.div({context:this.context});if(s.add_class("clearall"),this.add(s),this.show_text){var r=new ns.label({context:this.context});r.add(this.text),e.add(r)}let n=this._ctrl_fields=this._ctrl_fields||{};if(this.editable){let _={context:this.context,value:this.value};this.placeholder&&(_.placeholder=this.placeholder);var a=new rg(_),o=a._id();a.dom.attributes.id=o,a.dom.attributes.name=this.name,r.dom.attributes.for=o,a.dom.attributes.type=this.type,t.add(a),n.textInput=a,this.text_input=n.text_input=a}else{var l=new ig({context:this.context,value:this.value});t.add(l)}}};Ac.exports=tn});var Sc=q((Y0,Dc)=>{var qt=N(),M0=rr(),og=_t(),R0=qt.stringify,H0=qt.each,V0=qt.tof,lg=qt.Control,sn=class extends lg{constructor(e){super(e);var t=this.make,s=e.autosubmit||!1,r="medium";e.mode&&(r=e.mode),(r=="icon"||r=="mini"||r=="compact")&&(s=!0),this.__type_name="file_upload";var n=this.context.req,a=new qt.form({context:this.context});this.action=e.action||"/upload/";var o=this.dom.attrs;o.action=this.action,o.method="POST",o.enctype="multipart/form-data",this.add(a);var l=new qt.input({context:this.context});if(l.set("dom.attributes.type","file"),l.set("dom.attributes.name","file"),a.add(l),r==="normal"||r==="large"){var _=new og({context:this.context}),u=_.dom.attrs;u.type="submit",u.value="submit",u.class="upload",_.add("Upload"),a.add(_)}var h={input_file:l._id(),form:a._id()}}activate(){super.activate(),console.log("activate File_Upload");var e=this.mode,t=this.autosubmit,s=this.input_file,r=this.form;t&&s.add_event_listener("change",function(n){console.log("e_change",n),r.dom.el.submit()})}};Dc.exports=sn});var nn=q((G0,Ec)=>{var jt=N(),cg=Zs(),I0=jt.stringify,_g=jt.each,hg=jt.tof,U0=jt.is_defined,ug=jt.Control,$0=jt.group,rn=class extends ug{constructor(e,t,s){if(super(e),this.__type_name="horizontal_menu",this.dom.attrs.class="horizontal menu",!e.abstract&&!e.el){var r=e.value,n=hg(r);n=="object"&&_g(r,(a,o)=>{var l=s(cg({text:o,value:a,menu:this}));this.add(l)})}}activate(){if(!this.__active){super.activate();var e;this.content.each((t,s)=>{t.on("click",r=>{var n=t.state;t.open(),t.one_mousedown_anywhere(function(a){a.within_this||t.close()})}),t.on("mouseup",function(r){})})}}close_all(){console.log("menu close_all"),this.content.each((e,t)=>{e.close_all()})}};Ec.exports=rn});var Bc=q((J0,zc)=>{var as=N(),W0=as.stringify,X0=as.each,K0=as.tof,fg=as.Control,dg=[["value",Object]],an=class extends fg{constructor(e){super(e,dg),this.__type_name="data_item",this.add_class("data-item");let t=this.context;this.add(new as.textNode({text:this.value+"",context:this.context}))}};zc.exports=an});var Oc=q((e1,Fc)=>{var ir=N(),Q0=ir.stringify,mg=ir.each,Z0=ir.tof,gg=ir.Control,pg=Bc(),on=class extends gg{constructor(e){super(e),this.add_class("data-row");let t=this.context,s=this.items=[];e.items&&mg(e.items,r=>{s.push(this.add(new pg({context:t,value:r})))})}};Fc.exports=on});var cn=q((n1,Lc)=>{var Pc=N(),{Control:vg,parse_mount:s1,parse:r1}=Pc,{prop:i1,field:yg}=ae(),ln=class extends vg{constructor(e){e.__type_name=e.__type_name||"icon";let t=e.size=e.size||[64,64];super(e);let{context:s}=this;this.add_class("icon"),yg(this,"key",e.icon_key||e.key);let r=()=>{let{key:n}=this,a="/img/icons/"+n,o=new Pc.img({context:s,size:[64,64]});o.dom.attributes.src=a,this.add(o),this._ctrl_fields=this._ctrl_fields||{},this._ctrl_fields.img=o};e.el||r()}activate(){if(!this.__active){super.activate();let{img:e}=this;this.on("change",({name:t,value:s})=>{if(t==="key"){let r="/img/icons/"+s;e.dom.attributes.src=r}})}}};Lc.exports=ln});var os=q((l1,Nc)=>{var xg=N(),{Control:_n,controls:bg,tf:wg,are_equal:kg,each:Cg}=xg,{span:qg}=bg,{prop:a1,field:o1}=ae(),jg=cn(),Tg=(i,e,t)=>{let s=new _n({context:i,class:"left"});s.add(e);let r=new _n({context:i,class:"right"});return r.add(t),[s,r]},nr=class extends _n{constructor(e){e.__type_name=e.__type_name||"item",super(e),this.add_class("item");let t=this.item=e.item,{context:s}=this,r=()=>{if(wg(t)==="o"){let a=Object.keys(t).sort();if(a.length===2&&kg(a,["icon","text"])){let o=new qg({context:s});o.add(t.text);let l=Tg(s,new jg({context:s,key:t.icon,size:[64,64]}),o);console.log("lr"),Cg(l,_=>{this.add(_)})}}};e.el||r()}};nr.css=`
.item .icon {
    width: 64px;
    height: 64px;
}
`;Nc.exports=nr});var ar=q((h1,Rc)=>{var ls=N(),Ag=os(),c1=ls.stringify,Mc=ls.each,_1=ls.tof,Dg=ls.Control,Sg=ls.Collection,Eg=wt(),hn=class extends Dg{constructor(e,t,s){super(e);var r=this;if(this.__type_name="list",this.add_class("list"),e.items?this.items=e.items:this.items=new Sg,!e.el){let n=this.context.new_selection_scope(this);this.compose_list()}}compose_list(){Mc(this.items,(e,t)=>{var s=new Ag({context:this.context,value:e});s._fields=s._fields||{},s._fields.index=t,Eg(s),s.selectable=!0,this.add(s)})}activate(){if(!this.__active){super.activate(),Mc(this.$("item"),t=>{t.selectable=!0});let e=this.find_selection_scope();e.on&&e.on("change",t=>{let s=t.value;this.selected_index=s.index,this.raise("change",{name:"selection",value:s.index})})}}};Rc.exports=hn});var fn=q((m1,Hc)=>{var or=N(),u1=or.stringify,f1=or.each,d1=or.tof,un=or.Control,zg=i=>{let e=i.ctrl_document,t=i.map_controls.body_0;return t.popup_layer||(t.popup_layer=new un({context:i,__type_name:"popup_layer"}),t.popup_layer.add_class("popup-layer"),t.add(t.popup_layer)),t.popup_layer},Bg=i=>{let e=i.context;i.popup=()=>{let t=zg(e),s,r;return setTimeout(()=>{r=new un({context:e,__type_name:"placeholder"}),s=i.parent;let a=new un({context:e});t.add(a),a.add(r),s.content.swap(i,r);let o=r.dom.el.getBoundingClientRect();a.dom.attrs.style.position="absolute",a.dom.attrs.style.left=o.left+"px",a.dom.attrs.style.top=o.top+"px",i.remove_class("hidden")},0),()=>{i.add_class("hidden"),s.content.swap(r,i)}}};Hc.exports=Bg});var mn=q((y1,Ic)=>{var cs=N(),g1=cs.stringify,p1=cs.each,v1=cs.tof,Fg=cs.Control,Vc=cs.is_defined,Og=os(),Pg=ar(),Yc=fn(),dn=class extends Fg{constructor(e){e.__type_name=e.__type_name||"item_selector",super(e),this.add_class("item-selector"),e.items?this.items=e.items:this.items=[],e.loop&&(this.loop=e.loop),Vc(e.item_index)?this.item_index=e.item_index:Vc(this.item_index)||(this.item_index=0),e.el||(this.compose_item_selector(),this.finish_item_selector())}finish_item_selector(){this.item_list.on("change",e=>{if(e.name==="selection"){let t=e.value;this.item_index=t,this.current_item_view.item=this.items[t],this.raise("change",{name:"value",value:this.items[t],index:t}),this.value=this.items[t],setTimeout(()=>{this.item_list.hide()},120)}})}compose_item_selector(){let e=this.current_item_view=new Og({context:this.context,item:this.items[this.item_index]});this.add(e);let t=this.item_list=new Pg({context:this.context,items:this.items});t.hide(),t.add_class("item-selector"),Yc(t),this.add(t),this._fields=this._fields||{},this._fields.item_index=this.item_index,this._fields.items=this.items,this.loop&&(this._fields.loop=this.loop),this._ctrl_fields=this._ctrl_fields||{},this._ctrl_fields.current_item_view=e,this._ctrl_fields.item_list=t}previous(e=!0){let t;this.item_index>0?(this.item_index--,this.current_item_view.item=this.items[this.item_index],e&&(t={value:this.items[this.item_index],index:this.item_index,size:-1})):this.loop&&(this.item_index=this.items.length-1,this.current_item_view.item=this.items[this.item_index],e&&(this.raise("loop",-1),t={value:this.items[this.item_index],loop:-1,index:this.item_index,size:-1})),t&&(this.item_index===0&&(t.first=!0),this.item_index===this.items.length-1&&(t.last=!0),this.raise("change",t))}next(e=!0){let t=this.item_index,s=this.items[this.item_index],r;this.item_index<this.items.length-1?(this.item_index++,this.current_item_view.item=this.items[this.item_index],e&&(r={value:this.items[this.item_index],index:this.item_index,size:1})):this.loop&&(this.item_index=0,this.current_item_view.item=this.items[this.item_index],e&&(this.raise("loop",1),r={value:this.items[this.item_index],loop:1,index:this.item_index,size:1})),r&&(this.item_index===0&&(r.first=!0),this.item_index===this.items.length-1&&(r.last=!0),this.raise("change",r))}activate(){let e=this;if(!this.__active){super.activate();let t=this.item_list;Yc(t);let s=!1,r=!1;this.on("touchstart",n=>{r=!0,t.popup(),n.preventDefault()}),this.on("touchend",n=>{s=!1,t.hide()}),this.on("touchmove",n=>{s=!0}),this.on("click",n=>{if(!r){let a=t.popup(),o=this.context.map_controls.body_0,l=_=>{this.context.map_controls[_.target.getAttribute("data-jsgui-id")].ancestor(t)||(o.off("click",l),a())};setTimeout(()=>{o.on("click",l)},0)}}),this.finish_item_selector()}}};Ic.exports=dn});var pn=q((x1,Gc)=>{var $c=N(),Lg=$c.Control,lr=$c.is_defined,Uc=Oi(),Ng=mn(),gn=class extends Lg{constructor(e){e.__type_name=e.__type_name||"left_right_arrows_selector",super(e),this.add_class("left-right"),this.add_class("arrows-selector"),e.items&&(this.items=e.items),lr(e.item_index)&&(this.item_index=e.item_index),lr(e.loop)&&(this.loop=e.loop),e.el||this.compose_lras()}compose_lras(){let e=this.context,t=new Uc({context:e,direction:"left"}),s={context:e};this.items&&(s.items=this.items),this.item_index&&(s.item_index=this.item_index),this.loop&&(s.loop=this.loop);let r=new Ng(s),n=new Uc({context:e,direction:"right"});this.add(t),this.add(r),this.add(n),this._fields=this._fields||{},this.items&&(this._fields.items=this.items),lr(this.item_index)&&(this._fields.item_index=this.item_index),lr(this.loop)&&(this._fields.loop=this.loop),this._ctrl_fields={left_arrow:t,item_selector:r,right_arrow:n}}previous(e=!0){this.item_selector.previous(e)}next(e=!0){this.item_selector.next(e)}activate(){if(!this.__active){super.activate();let{left_arrow:e,item_selector:t,right_arrow:s}=this;e.on("click",r=>{this.previous()}),t.on("change",r=>{this.loop||(r.first?e.disabled=!0:e.disabled=!1,r.last?s.disabled=!0:s.disabled=!1),this.raise("change",r)}),s.on("click",r=>{this.next()}),this.loop&&t.on("loop",r=>{this.raise("loop",r)})}}};Gc.exports=gn});var vn=q((C1,Xc)=>{var cr=N(),b1=cr.stringify,w1=cr.each,k1=cr.tof,Tt=cr.Control,Mg=yt(),Wc=Mg.prom_or_cb,_s=class extends Tt{constructor(e){e=e||{},e.__type_name="tile_slider",super(e),e.el||this.compose_tile_slider()}compose_tile_slider(){let e=this.context,t=new Tt({contect:e});t.add_class("above"),this.add(t);let s=new Tt({contect:e});s.add_class("left"),this.add(s);let r=new Tt({contect:e});r.add_class("right"),this.add(r);let n=new Tt({contect:e});n.add_class("below"),this.add(n);let a=new Tt({contect:e});a.add_class("central"),this.add(a),this.above=t,this.left=s,this.central=a,this.right=r,this.below=n,this._ctrl_fields={above:t,left:s,central:a,right:r,below:n},this._fields={size:this.size}}slide_to_left(){return Wc((e,t)=>{let r=333/1e3;this.central.dom.attributes.style.transition="transform "+r+"s",this.central.dom.attributes.style.transform="translate("+-1*this.size[0]+"px, 0px)",this.right.dom.attributes.style.transition="transform "+r+"s",this.right.dom.attributes.style.transform="translate("+-1*this.size[0]+"px, 0px)",this.right.one("transitionend",n=>{e()})},callback)}slide_to_right(e){return Wc((t,s)=>{this.central.dom.attributes.style.transition="transform 0.33s",this.central.dom.attributes.style.transform="translate("+this.size[0]+"px, 0px)",this.left.dom.attributes.style.transition="transform 0.33s",this.left.dom.attributes.style.transform="translate("+this.size[0]+"px, 0px)",this.left.one("transitionend",r=>{t()})},e)}activate(){this.__active||(super.activate(),setTimeout(async()=>{await this.slide_to_right(),console.log("awaited slide to right")},2e3))}},Rg=function(i,e,t,s={left:-1,right:1}){class r extends _s{constructor(a){let o={context:a.context,size:a.size};super(o),a.size&&(o.size=a.size,this.size=a.size),this.spec=a,a.el||this.compose_tile_sliding_ctrl(),a.size}compose_tile_sliding_ctrl(){let a=e(this.spec),o=t(this.spec);if(this.spec.size&&(this.central.size=this.spec.size,this.dom.attributes.style.overflow="hidden",this.dom.attributes.style.position="relative",this.left.dom.attributes.style.position="absolute",this.left.dom.attributes.style.left=-1*this.spec.size[0]+"px",this.right.dom.attributes.style.position="absolute",this.right.dom.attributes.style.left=this.spec.size[0]+"px",this.left.size=this.spec.size,this.right.size=this.spec.size),s.left===-1){let _=new i(a);this.left.add(_)}let l=new i(this.spec);if(this.central.add(l),s.right===1){let _=new i(o);this.right.add(_),o.size}}}return r};_s.wrap=Rg;Xc.exports=_s});var _r=q((q1,Jc)=>{var Hg=_e(),Kc=Hg.is_defined,Vg=(i,e)=>{let t,s,r,n;e?(()=>{if(Object.defineProperty(i,"date",{get(){return t},set(l){let _=t;t=l,typeof document>"u"&&(i._fields=i._fields||{},i._fields.date=l),i.raise("change",{name:"date",old:_,value:t})},enumerable:!0,configurable:!1}),Object.defineProperty(i,"year",{get(){return s},set(l){let _=s;s=l,typeof document>"u"&&(i._fields=i._fields||{},i._fields.year=l),i.raise("change",{name:"year",old:_,value:s})},enumerable:!0,configurable:!1}),Object.defineProperty(i,"month",{get(){return r},set(l){let _=r;r=l,typeof document>"u"&&(i._fields=i._fields||{},i._fields.month=l),i.raise("change",{name:"month",old:_,value:r})},enumerable:!0,configurable:!1}),Object.defineProperty(i,"day",{get(){return n},set(l){let _=n;n=l,typeof document>"u"&&(i._fields=i._fields||{},i._fields.day=l),i.raise("change",{name:"day",old:_,value:n})},enumerable:!0,configurable:!1}),Kc(e.year)&&Kc(e.month))i.month=e.month,i.year=e.year;else{let l=new Date;i.month=l.getMonth(),i.year=l.getFullYear()}Object.assign(i,{next_month:()=>{i.month===11?(i.month=0,i.year=i.year+1):i.month=i.month+1,i.refresh_month_view()},previous_month:()=>{i.month===0?(i.month=11,i.year=i.year-1):i.month=i.month-1,i.refresh_month_view()},next_year:()=>{i.year=i.year+1,i.refresh_month_view()},previous_year:()=>{i.year=i.year-1,i.refresh_month_view()}})})():(()=>{})()};Jc.exports=Vg});var xn=q((D1,s_)=>{var At=N(),Qc=At.clone,j1=At.stringify,Zc=At.each,T1=At.tof,yn=At.is_defined,A1=At.Control,Yg=rs(),Ig=vn(),e_=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],hs="#DDDDDD",t_="inherit",Ug=_r(),us=class extends Yg{constructor(e){e.grid_size=[7,7],e.size=e.size||[360,200],e.__type_name="month_view",super(e),Ug(this,e),e.el||this.compose_month_view(),this.context.new_selection_scope(this)}activate(){super.activate();let e=this.$("grid_cell");Zc(e,t=>{t.on("change",s=>{s.name==="selected"&&s.value&&yn(t.value)&&(this.day=t.value)})})}compose_month_view(){this.refresh_month_view();let e=()=>{this.add_class("month-view");let t=this._arr_rows[0];t.add_class("days"),t.add_class("header"),Zc(t.content._arr,(u,h)=>{});let s=[0,1],r=this._arr_rows[s[1]],n=()=>{if(s[0]===r.content._arr.length-1)if(s[1]<this._arr_rows.length-1)s[0]=0,s[1]++,r=this._arr_rows[s[1]];else return!1;else s[0]++;return!0},a=new Date(this.year,this.month,1),o=a.getDay()-1;o<0&&(o=6);let l=e_[o];for(;s[0]<o;){let u=r.content._arr[s[0]];u.selectable=!1,u.select_unique=!0,u.background.color=hs,s[0]++}let _=!0;for(;_;){let u=r.content._arr[s[0]];u.selectable=!0,u.select_unique=!0,u.value=a.getDate(),u._fields=u._fields||{},u._fields.value=u.value,a.setDate(a.getDate()+1),_=n()&&a.getDate()!==1}for(;s[0]<=6;){let u=r.content._arr[s[0]];u.selectable=!1,u.select_unique=!0,u.background.color=hs,s[0]++}if(s[1]<6)for(s[0]=0,s[1]=6,r=this._arr_rows[s[1]];s[0]<=6;){let u=r.content._arr[s[0]];u.selectable=!1,u.select_unique=!0,r.content._arr[s[0]].background.color=hs,s[0]++}}}refresh_month_view(){let e=new Date(this.year,this.month,1),t=e.getMonth(),s=e.getDay()-1;s<0&&(s=6);let r=e_[s],n,a=this.day;this.each_cell((o,l)=>{let[_,u]=l;u>0&&(u===1?_<s?(o.background.color=hs,o.selectable=!1,o.deselect&&o.deselect(),o.value=null,o.iterate_this_and_subcontrols(h=>{h.dom.tagName==="span"&&(h.text="")})):(o.background.color=t_,o.selectable=!0,o.iterate_this_and_subcontrols(h=>{h.dom.tagName==="span"&&(n=e.getDate(),o.value=n,h.text=n+"",e.setDate(e.getDate()+1),n===a&&o.action_select_only())})):e.getMonth()===t?(o.background.color=t_,o.selectable=!0,o.iterate_this_and_subcontrols(d=>{d.dom.tagName==="span"&&(n=e.getDate(),o.value=n,d.text=n+"",e.setDate(e.getDate()+1),n===a&&o.action_select_only())})):(o.background.color=hs,o.selectable=!1,o.deselect&&o.deselect(),o.value=null,o.iterate_this_and_subcontrols(d=>{d.dom.tagName==="span"&&(d.text="")})))})}};us.Tiled=Ig.wrap(us,i=>{if(i=Qc(i),!yn(i.month)){let e=new Date;i.month=e.getMonth(),i.year=e.getFullYear()}return i.month=i.month-1,i.month<0&&(i.month=11,i.year=i.year-1),i},i=>{if(i=Qc(i),!yn(i.month)){let e=new Date;i.month=e.getMonth(),i.year=e.getFullYear()}return i.month=i.month+1,i.month>11&&(i.month=0,i.year=i.year+1),i});s_.exports=us});var n_=q((B1,i_)=>{var hr=N(),S1=hr.stringify,E1=hr.each,z1=hr.tof,$g=hr.Control,r_=pn(),Gg=xn(),Wg=["January","February","March","April","May","June","July","August","September","October","November","December"],Xg=[2014,2015,2016,2017,2018,2019,2020,2021,2022],Kg=_r(),bn=class extends r_{constructor(e){Object.assign(e,{items:Xg,item_index:4,loop:!1}),super(e),this.add_class("year-picker")}},wn=class extends r_{constructor(e){Object.assign(e,{items:Wg,item_index:7,loop:!0}),super(e),this.add_class("month-picker")}},kn=class extends $g{constructor(e){e.__type_name=e.__type_name||"date_picker",super(e),this.add_class("date-picker"),Kg(this,e),e.el||(this.compose_date_picker(),this.finish_date_picker())}finish_date_picker(){this.year_picker.on("change",e=>{let t=e.value;this.year=t}),this.month_picker.on("change",e=>{let t=e.index;this.month=t}),this.on("change",e=>{console.log("Date_Picker e_change",e),e.name==="year"&&(this.month_view.year=e.value,this.month_view.refresh_month_view()),e.name==="month"&&(this.month_view.month=e.value,this.month_view.refresh_month_view())})}compose_date_picker(){this._ctrl_fields=this._ctrl_fields||{},Object.assign(this._ctrl_fields,{year_picker:this.year_picker=new bn({context:this.context}),month_picker:this.month_picker=new wn({context:this.context}),month_view:this.month_view=new Gg({context:this.context})}),this.add(this.year_picker),this.add(this.month_picker),this.add(this.month_view)}activate(){if(!this.__active){super.activate();let e,t,s,r,n=()=>{t&&e?this.month_picker.left_arrow.disabled=!0:this.month_picker.left_arrow.disabled=!1,r&&s?this.month_picker.right_arrow.disabled=!0:this.month_picker.right_arrow.disabled=!1,r?this.year_picker.right_arrow.disabled=!0:this.year_picker.right_arrow.disabled=!1,t?this.year_picker.left_arrow.disabled=!0:this.year_picker.left_arrow.disabled=!1};this.year_picker.on("change",a=>{a.size===-1&&this.month_view.previous_year(),a.size===1&&this.month_view.next_year(),t=!!a.first,r=!!a.last,n()}),this.month_picker.on("change",a=>{e=!!a.first,s=!!a.last,a.size===-1&&this.month_view.previous_month(),a.size===1&&this.month_view.next_month(),a.loop===-1&&this.year_picker.previous(),a.loop===1&&this.year_picker.next(),n()}),this.month_view.on("change",a=>{let l=a.value.value;a.name==="day"&&(this.day=l)}),this.finish_date_picker()}}};i_.exports=kn});var o_=q((F1,a_)=>{var fs=N(),Jg=fs.each,Qg=fs.tof,Zg=fs.Control,Cn=class extends Zg{constructor(e){super(e),this.options=e.options,e.skip_compose||this.compose()}compose(){let e=this.context;Jg(this.spec.options,t=>{let s=Qg(t),r=new fs.option({context:e});s==="string"&&(r.dom.attributes.value=t,r.add(new fs.textNode("option")))})}};a_.exports=Cn});var Dt=q((N1,c_)=>{var ds=N(),O1=ds.stringify,P1=ds.each,L1=ds.tof,l_=ds.is_defined,ep=ds.Control,qn=class extends ep{constructor(e,t,s){if(e=e||{},e.__type_name=e.__type_name||"panel",super(e),this.add_class("panel"),l_(e.name)&&(this.name=e.name),!e.abstract&&!e.el){var r=0;let n=this.name;if(l_(n)){let a=this._fields=this._fields||{};a.name=n}}}};c_.exports=qn});var ur=q((Y1,h_)=>{var __=N(),{stringify:M1,each:R1,tof:H1,def:V1,Control:tp}=__,sp=[["text",String]],jn=class extends tp{constructor(e){if(e=e||{},e.__type_name=e.__type_name||"title_bar",super(e,sp),!e.el){this.add_class("title-bar title bar");var t=new __.span({context:this.context,text:this.text});this.add(t)}}};h_.exports=jn});var dr=q(($1,f_)=>{var fr=N(),{stringify:rp,each:ip,tof:np,def:I1,Control:ap}=fr,{prop:U1,field:u_}=ae(),Tn=class extends ap{constructor(e,t,s){if(e=e||{},e.__type_name=e.__type_name||"toggle_button",super(e),this.add_class("toggle-button"),u_(this,"states",e.states||""),u_(this,"state",e.state||""),!e.abstract&&!e.el){let r=()=>{var a=this.span_state=new fr.span({context:this.context,text:this.state});this.add(a)};(()=>fr.parse_mount(`<span name='span_state'>${this.state}</span>`,this,fr.controls))()}this.on("change",r=>{this.span_state&&(this.span_state.text=r.value)}),typeof document>"u"&&(this.dom.attributes["data-jsgui-ctrl-fields"]=rp({span_state:this.span_state._id()}).replace(/"/g,"'"))}activate(){this.__active||(super.activate(),this.on("click",e=>{var t=this.state,s=this.states,r;if(np(s)==="array"){ip(s,(o,l)=>{o===t&&(r=l)});var n=r+1;n===s.length&&(n=0);var a=s[n];this.raise("toggle",{state:a}),this.state=a}else throw"stop"}))}};f_.exports=Tn});var Dn=q((J1,d_)=>{var mr=N(),op=dr(),G1=mr.stringify,W1=mr.each,X1=mr.tof,K1=mr.Control,An=class extends op{constructor(e,t,s){e.__type_name="plus_minus_toggle_button",e.states=["+","-"],e.state=e.state||"-",super(e);let r=this.state=e.state}};d_.exports=An});var En=q((Z1,g_)=>{var lp=N(),cp=lp.Control,{prop:Q1,field:m_}=ae(),Sn=class extends cp{constructor(e){e.__type_name="vertical_expander",super(e),this.add_class("vertical expander"),m_(this,"state"),m_(this,"states"),this.state=e.state,this.states=e.states}activate(){super.activate();var e,t=this.dom.el;if(t){t.style.transition="height 0.125s linear";var s=()=>{var n=t.childNodes[0].offsetHeight;e=n,t.style.height=e+"px",setTimeout(function(){t.style.overflow="hidden",t.style.height="0px"},0)},r=()=>{var n=function(a){t.removeEventListener("transitionend",n)};t.addEventListener("transitionend",n,!1),t.style.height=e+"px"};this.on("change",n=>{var a=n.value;a=="closed"&&s(),a=="open"&&r()})}else console.log("WARNING: vertical_expander expected el to activate"),console.trace()}toggle(){this.state=="open"&&(this.state="closed"),this.state=="closed"&&(this.state="open")}open(){this.state="open"}close(){this.state="closed"}};g_.exports=Sn});var gr=q((rw,v_)=>{var Bn=N(),_p=Dn(),hp=En(),up=wt(),{prop:ew,field:p_}=ae(),{stringify:tw,each:fp,tof:sw,def:zn,Control:ms}=Bn,Fn=class i extends ms{constructor(e){if(e=e||{},e.__type_name=e.__type_name||"tree_node",zn(e.expandable)||(e.expandable=!0),super(e),up(this),p_(this,"depth"),p_(this,"state","open"),this.expandable=e.expandable,zn(e.depth)&&(this.depth=e.depth),e){var t=e.state,s;(t==="open"||t==="closed")&&(this.state=t),e.text?this.text=e.text:e.name&&(this.text=e.name)}else this.state="open";e.img_src,typeof e.el>"u"&&this.compose_tree_node(e),this.inner_control&&this.inner_control.content.on("change",r=>{let n=r.target,a=!1;fp(n,(o,l,_)=>{o instanceof i&&(a=!0,_())}),a?this.toggle_button.show():this.toggle_button.hide()})}compose_tree_node(e){let t=f=>(f.context=this.context,f),s=f=>this.add(f),r=f=>this.make(f);var n=s(new ms(t({class:"top-line"})));let a;if(zn(this.depth))for(let f=0;f<this.depth;f++){let p=new ms(t({class:"depth-block"}));n.add(p)}let o,l,_={};this.state==="closed"&&(_.state="+"),n.add(o=new _p(t(_))),this.toggle_button=o,o.hide();var u=n.add(new ms(t({class:"main-box"})));this.img_src&&a.add(new Bn.img(t({dom:{attributes:{src:this.img_src}}}))),u.add(new Bn.span(t({text:this.text,class:"text"})));let h;if(this.expandable)if(h=s(new hp(t({}))),h.add(l=new ms(t({class:"inner"}))),this.inner_control=l,this.expander=h,e.nodes){for(let f of e.nodes){f.context=this.context,f.depth=this.depth+1;let p=new i(f);this.inner_control.add(p)}h.state=this.state="open"}else h.state=this.state="closed";else o.hide();var d=this._ctrl_fields=Object.assign(this._ctrl_fields||{},{toggle_button:o});h&&(d.inner_control=l,d.expander=h),this.add_class("tree-node"),this.active()}activate(e){if(!this.__active){super.activate(e),this.rec_desc_ensure_ctrl_el_refs();var t=this.toggle_button,s=this.inner_control,r=this.expander;r&&t&&t.on("toggle",n=>{n.state==="-"?(r.open(),this.raise("expand"),this.raise("open")):(r.close(),this.raise("contract"),this.raise("close"))})}}};v_.exports=Fn});var Pn=q((cw,y_)=>{var dp=N(),{stringify:iw,each:nw,tof:aw,def:ow,Control:mp}=dp,gp=Dt(),pp=ur(),vp=gr(),{prop:lw,field:yp}=ae(),On=class extends mp{constructor(e,t,s){e=e||{},e.__type_name=e.__type_name||"tree",super(e),this.add_class("tree"),yp(this,"title"),this.title=e.title,e.el||this.compose_tree(e),this.on("change",r=>{r.name==="title"&&(this.title_bar.text=r.value)})}compose_tree(e){if(this.title!==void 0&&this.add(this.title_bar=new pp({context:this.context,text:this.title})),this.add(this.main=new gp({context:this.context})),e.nodes)for(let t of e.nodes){t.context=this.context,t.depth=0;let s=new vp(t);this.main.add(s)}this._ctrl_fields=Object.assign(this._ctrl_fields||{},{main:this.main}),this.title_bar&&(this._ctrl_fields.title_bar=this.title_bar)}clear(){this.main.clear()}activate(){super.activate(),this.selection_scope=this.context.new_selection_scope()}};y_.exports=On});var b_=q((hw,x_)=>{var _w=N(),xp=Pn(),Ln=class extends xp{constructor(e){e.__type_name="file_tree",super(e),this.add_class("file tree file-tree");let t=this.context,s=e.fs||e.fs_resource;if(s)this.fs_resource=s;else{let r=t.resources;console.log("File_Tree context resources",r),console.log("File_Tree context.resource_pool",t.resource_pool),console.log("Object.keys(context)",Object.keys(t))}e.el||this.compose_file_tree()}compose_file_tree(){}activate(){}};x_.exports=Ln});var k_=q((fw,w_)=>{var uw=N(),bp=gr(),Nn=class extends bp{constructor(e){if(e.file){let t=e.file,s=t.name;e.text=t.name}e.__type_name="file_tree_node",e.expandable=!1,super(e),this.add_class("file"),e.el}};w_.exports=Nn});var q_=q((pw,C_)=>{var Ze=N(),dw=Ze.stringify,mw=Ze.each,wp=Ze.tof,kp=Ze.extend,Re=Ze.Control,gw=Ze.Collection,Mn=class extends Re{constructor(e){if(super(e),this.__type_name="line_chart",!e.abstract&&!e.el){this.add_class("line-chart no-select");var t=10,s=80,r=24,n=2,a=e.x_major_notch_spacing||e.major_notch_spacing||50,o=e.y_major_notch_spacing||e.major_notch_spacing||50,l=e.x_minor_notch_spacing||e.major_minor_spacing||10,_=e.y_minor_notch_spacing||e.major_minor_spacing||10,u=!0;this.set({vert_margin:t,left_margin:s,right_margin:r,axis_thickness:n,x_major_notch_spacing:a,y_major_notch_spacing:o,x_minor_notch_spacing:l,y_minor_notch_spacing:_,suppress_0_axes_labels:u}),this.add_full_axes()}var h=this.get("num_days");typeof window>"u"&&kp(this._fields=this._fields||{},{vert_margin:t,left_margin:s,right_margin:r,axis_thickness:n,x_major_notch_spacing:a,y_major_notch_spacing:o,x_minor_notch_spacing:l,y_minor_notch_spacing:_,suppress_0_axes_labels:u,range:this.get("range").value(),x_origin:this.get("x_origin").value(),y_origin:this.get("y_origin").value()})}add_full_axes(){var e=this.get("vert_margin"),t=this.get("left_margin"),s=this.get("right_margin"),r=this.get("axis_thickness"),n=this.get("x_major_notch_spacing"),a=this.get("y_major_notch_spacing"),o=this.get("x_minor_notch_spacing"),l=this.get("y_minor_notch_spacing"),_=this.get("suppress_0_axes_labels"),u=this.get("size").value(),h=u[0][0],d=u[1][0],f=this.get("range").value();console.log("range",f);var p,g,b=f[0][0],k=f[0][1],y=f[1][0],T=f[1][1],j=y-b,S=T-k,z=b<=0&&y>=0,U=k<=0&&T>=0,Q=t,Y=h-s,F=e,K=d-e,W=Y-Q,ee=K-F,M=h-t-s,H=d-2*e,C=j/M,R=S/H,I,D,E=function(G){var oe=[G[0]-I,G[1]-D],de=[Math.round(oe[0]*C),Math.round(oe[1]*R*-1)];return de},V=function(G){var oe=[Math.round(origin[0]+G[0]*1/C),Math.round(origin[1]+G[1]*-1/R)];return oe},L=function(G){return Math.round(I+G*1/C)},B=function(G){return Math.round(D+G*-1/R)},P=new Re({context:this.context,tag_name:"svg"});if(P.set("dom.attributes",{width:h,height:d,viewPort:"0 0 "+h+" "+d,version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),this.add(P),this.set("svg",P),z){var re=-1*b/j,Z=W*re;I=Q+Z,p=I}else throw"stop";if(U){var re=-1*k/S,Z=ee*re;D=K-Z,g=D}else throw"stop";this.x_origin=I,this.y_origin=D;var F=e,K=d-e,te=function(){var G=new Re({context:this.context,tag_name:"line"});G.set("dom.attributes",{width:10,height:d,x1:p,y1:F,x2:p,y2:K,stroke:"#000000","stroke-width":2}),P.add(G)},m=function(){var G=new Re({context:this.context,tag_name:"line"});G.set("dom.attributes",{width:10,height:d,x1:Q,y1:g,x2:Y,y2:g,stroke:"#000000","stroke-width":2}),P.add(G)},v=function(G,oe){for(var de=Math.floor(b*-1/G),et=Math.floor(y/G),le=de*G*-1,ue=le;ue<=y;){var ce=new Re({context:this.context,tag_name:"line"}),me=L(ue);ce.set("dom.attributes",{width:2,height:oe,x1:me,y1:D,x2:me,y2:D+oe,stroke:"#AAAAAA","stroke-width":2}),P.add(ce),ue+=G}},w=function(G){for(var oe=Math.floor(b*-1/G),de=Math.floor(y/G),et=oe*G*-1,le=et;le<=y;){if(!(_&&le===0)){var ue=L(le),ce=new Re({context:this.context,tag_name:"text"});ce.set("dom.attributes",{x:ue-4,y:D+28,"font-family":"Verdana","font-size":14}),ce.add(le+""),P.add(ce)}le+=G}},x=function(G){for(var oe=Math.floor(k*-1/G),de=Math.floor(T/G),et=oe*G*-1,le=et;le<=T;){if(!(_&&le===0)){var ue=new Re({context:this.context,tag_name:"line"}),ce=B(le),me=new Re({context:this.context,tag_name:"text"});me.set("dom.attributes",{x:I-48,y:ce+6,"font-family":"Verdana","font-size":14}),me.add(le+""),P.add(me)}le+=G}},A=function(G,oe){for(var de=Math.floor(k*-1/G),et=Math.floor(T/G),le=de*G*-1,ue=le;ue<=T;){var ce=new Re({context:this.context,tag_name:"line"}),me=B(ue);ce.set("dom.attributes",{width:oe,height:2,x1:I-oe,y1:me,x2:I,y2:me,stroke:"#AAAAAA","stroke-width":2}),P.add(ce),ue+=G}},J=function(){v(n,20)},ve=function(){v(o,10)},O=function(){var G=new Re({context:this.context,tag_name:"text"});G.set("dom.attributes",{x:I-14,y:D+14,"font-family":"Verdana","font-size":14}),G.add("0"),P.add(G)},ke=function(){A(a,20)},qr=function(){console.log("x_minor_notch_spacing",l),A(l,10)},Ie=function(){w(n)},De=function(){x(a)},Aa=function(){Ie(),De()};ve(),J(),qr(),ke(),m(),te(),Aa(),O()}render_axes(){}values_from_pixel_location(e){var t=this.dom.el,s=t.clientWidth,r=t.clientHeight,n=this.x_origin,a=this.y_origin,o=this.vert_margin,l=this.left_margin,_=this.right_margin,u=s-l-_,h=r-2*o,d=this.range,f=d[0][0],p=d[0][1],g=d[1][0],b=d[1][1],k=g-f,y=b-p,T=k/u,j=y/h,S=[e[0]-n,e[1]-a],z=[Math.round(S[0]*T),Math.round(S[1]*j*-1)];return z}pixel_location_from_values(e){var t=this.dom.el,s,r;if(t)s=t.clientWidth,r=t.clientHeight;else{var n=this.size();s=n._[0][0],r=n._[1][0]}var a=this.x_origin,o=this.y_origin,l=this.vert_margin,_=this.left_margin,u=this.right_margin,h=s-_-u,d=r-2*l,f=this.range,p=f[0][0],g=f[0][1],b=f[1][0],k=f[1][1],y=b-p,T=k-g,j=y/h,S=T/d,z=[Math.round(a+e[0]*1/j),Math.round(o+e[1]*-1/S)];return z}activate(){if(!this.__active){super.activate();var e=this,t=this.dom.el,s=t.clientWidth,r=t.clientHeight,n=[s,r],a=this.vert_margin,o=this.left_margin,l=this.right_margin,_=this.axis_thickness,u=this.x_major_notch_spacing,h=this.y_major_notch_spacing,d=this.x_minor_notch_spacing,f=this.y_minor_notch_spacing,p=this.suppress_0_axes_labels,g=this.x_origin,b=this.y_origin,k=this.range,y=k[0][0],T=k[0][1],j=k[1][0],S=k[1][1],z=y<=0&&j>=0,U=T<=0&&S>=0,Q=o,Y=s-l,W=a,ee=r-a,M=s-o-l,H=r-2*a,C=j-y,R=S-T,I=C/M,D=R/H,E=function(){console.log("x_range",C),console.log("y_range",R),console.log("x_scale",I),console.log("y_scale",D),console.log("left_margin",o),console.log("right_margin",l),console.log("range",k),console.log("tof range",wp(k))},V=this.context,L=function(F){var K=[F[0]-g,F[1]-b],te=[Math.round(K[0]*I),Math.round(K[1]*D*-1)];return te},B=function(F){var K=[Math.round(origin[0]+F[0]*1/I),Math.round(origin[1]+F[1]*-1/D)];return K},P=function(F){return Math.round(g+F*1/I)},re=function(F){return Math.round(b+F*-1/D)},Z=function(F){var K=curtop=0;if(F.offsetParent)do K+=F.offsetLeft,curtop+=F.offsetTop;while(F=F.offsetParent);return[K,curtop]};this.add_event_listener("mousemove",function(F){var K=Z(t),te,m;(F.pageX||F.pageY)&&(te=F.pageX,m=F.pageY);var v=[te,m],w=Ze.v_subtract(v,K),x=L(w);F.chart_position=x}),this.add_event_listener("click",function(F){var K=Z(t),te,m;(F.pageX||F.pageY)&&(te=F.pageX,m=F.pageY);var v=[te,m],w=Ze.v_subtract(v,K),x=L(w);F.chart_position=x})}}};C_.exports=Mn});var D_=q((xw,A_)=>{var He=N(),j_=rr(),T_=He.stringify,vw=He.each,yw=He.tof,Cp=He.Control,Rn=class extends Cp{constructor(e){super(e);var t=this.make;this.add_class("login-control");var s=this.context.req;console.log("--- Within Login Control ---");var r=s.headers;console.log("headers "+T_(r));var n=this.context.auth;if(console.log("auth "+T_(n)),n&&n.verified){var a=new He.div({context:this.context}),o=new He.span({context:this.context});o.add("Logged in as: "+n.username),a.add(o);var l=new He.form({context:this.context});l.dom.attrs.set({action:"/logout/?returnurl=%2F",method:"POST"}),a.add(l);var _=new He.button({context:this.context});_.dom.attrs.set({type:"submit",value:"submit",class:"logout"}),_.add("Logout"),l.add(_),this.add(a)}else{var l=new He.form({context:this.context});l.dom.attrs.set({action:"/logout/?returnurl=%2F",method:"POST"}),this.add(l);var u=new j_({text:"Username",name:"username",value:"",type:"text",context:this.context});l.add(u);var h=new j_({text:"Password",name:"password",value:"",type:"password",context:this.context});l.add(h);var _=new He.button({context:this.context});_.dom.attrs.set({type:"submit",value:"submit",class:"login"}),_.add("Login"),l.add(_)}}};A_.exports=Rn});var E_=q((qw,S_)=>{var gs=N(),bw=gs.stringify,ww=gs.each,kw=gs.tof,Cw=gs.is_defined,qp=gs.Control,Hn=class extends qp{constructor(e){e.__type_name=e.__type_name||"modal",super(e),this.add_class("modal")}};S_.exports=Hn});var Gn=q((jw,B_)=>{var $n=N(),jp=$n.Control,Tp=wt(),z_=$n.each,Vn=Dt(),Ap=ar(),Yn=class extends jp{constructor(e){e.__type_name=e.__type_name||"tab",super(e);let t;Object.defineProperty(this,"name",{get(){return t},set(s){let r=t;t=s,this.raise("change",{name:"name",old:r,value:s})}}),t=e.name,this.add_class("tab"),Tp(this),this.selectable=!0,e.el||this.construct_tab()}construct_tab(){this.add(this.span=new $n.span({context:this.context,text:this.name})),(this._fields=this._fields||{}).name=this.name}},In=class extends Ap{constructor(e){e.__type_name=e.__type_name||"tab_group",super(e),this.add_class("tab-group"),this.selection_scope=this.context.new_selection_scope(this),this.tab_names=e.tab_names||e.tabs,e.el||this.construct_tab_group(),this.selection_scope.on("change",t=>{console.log("Tab_Group selection_scope e_change",t)})}construct_tab_group(){z_(this.tab_names,e=>{let t=new Yn({context:this.context,name:e});this.add(t)})}},Un=class extends Vn{constructor(e){e.__type_name=e.__type_name||"tabbed_panel",super(e),this.add_class("tabbed-panel"),e.el||this.compose_tabbed_panel(e.tabs)}compose_tabbed_panel(e){let t=Object.keys(e);this.add(this.tab_group=new In({context:this.context,tabs:t})),this.add(this.main=new Vn({context:this.context}));let s={};z_(e,(r,n)=>{r.name=n;let a=new Vn({context:this.context,name:n});s[n]=a,r.__type_name&&a.add(r),this.main.add(a)})}};B_.exports=Un});var P_=q((Bw,O_)=>{var St=N(),Ve=Dt(),Tw=Gn(),Aw=St.stringify,Dw=St.each,Sw=St.tof,Ew=St.is_defined,F_=St.Control,zw=St.group,Wn=class extends F_{constructor(e){e.__type_name=e.__type_name||"multi_layout_mode",super(e),this.layout_mode=e.layout_mode;var t=this.context.make,s=this.context;this.add_class("multi-layout-mode"),e.el||this.compose_mlm(),this._features=this._features||[]}compose_mlm(){var e=this.layout_mode;let t=this.context;e&&this.add_class(e);var s=new Ve({context:t,name:"title",class:"title"}),r=new Ve({context:t,name:"navigation",class:"navigation"}),n=new Ve({context:t,name:"main",class:"main"}),a=new Ve({context:t,name:"misc",class:"misc"});if(e=="fluid-fixed"){var o=new Ve({context:t,name:"top"});o.add_class("top");var l=new Ve({context:t,name:"left-wrapper"});l.add_class("left-wrapper");var _=new Ve({context:t,name:"left"});_.add_class("left");var u=new Ve({context:t,name:"right"});u.add_class("right");var h=new Ve({context:t,name:"bottom"});h.add_class("bottom"),this.add(o),this.add(l),l.add(_),this.add(u),this.add(h),o.add(s),h.add(r),_.add(n),u.add(a)}else if(e==="tools-at-top"){this.add(s),this.add(r);var d=new F_({context:t,class:"main-column"});this.add(d),d.add(a),d.add(n)}else this.add(s),this.add(r),this.add(n),this.add(a);this.title=s,this.nav=this.navigation=r,this.main=n,this.misc=a,this._ctrl_fields=this._ctrl_fields||{},Object.assign(this._ctrl_fields,{title:s,nav:r,main:n,misc:a})}activate(){this.__active||super.activate()}};O_.exports=Wn});var R_=q((Pw,M_)=>{var Et=N(),L_=Et.stringify,Dp=Et.each,Fw=Et.tof,Ow=Et.is_defined,Sp=_t(),N_=os(),Ep=Et.Collection,zp=Et.Data_Value,Xn=class extends Sp{constructor(e,t,s){e.no_compose=!0,e.class="popup-menu-button",super(e),this.__type_name="popup_menu_button";var r=this.context,n=function(){this.mixin(["open_closed","closed"],["item_container"])};this.states=["closed","open"],this.state=new zp("closed"),this.i_state=0;var a=this.active_fields={};a.states=this.states,a.state=this.state,a.i_state=this.i_state;var o=()=>{this.text=e.text||e.label||"";var l=new N_({context:r,item:this.text});if(l.add_class("popup-menu"),this.add(l),l.inner.add_class("popup-menu"),this.root_menu_item=l,e.items){let u=this.items=new Ep(e.items);Dp(u,h=>{var d=new N_({context:r,item:h});d.add_class("popup-menu"),l.inner.add(d)})}var _={root_menu_item:l._id()};this.dom.attrs["data-jsgui-fields"]=L_(a).replace(/"/g,"'"),this.dom.attrs["data-jsgui-ctrl-fields"]=L_(_).replace(/"/g,"'")};!e.abstract&&!e.el&&o(),e.el&&o()}activate(){if(!this.__active){super.activate();var e=this.root_menu_item;this.state.on("change",t=>{var s=t.value;s==="open"&&(e.inner.pop_into_body(),this.one_mousedown_elsewhere(r=>{console.log("e_mousedown_elsewhere",r),setTimeout(function(){this.i_state=0,this.state.set("closed")},300)})),e.state.set(s)}),e.on("click",t=>{var s=that.i_state+1;s===that.states.length&&(s=0),this.i_state=s,this.state.set(that.states[s])}),e.inner.content.each(t=>{t.on("click",s=>{e.state.set("closed"),this.i_state=0})})}}};M_.exports=Xn});var Qn=q((Rw,H_)=>{var zt=N(),Bp=zt.stringify,Lw=zt.each,Nw=zt.tof,Fp=zt.is_defined,Kn=zt.Control,Mw=zt.group,Jn=class extends Kn{constructor(e,t,s){super(e),this.__type_name="radio_button",this.add_class("radio-button");var r=this.context;if(!e.abstract&&!e.el){var n=this.name,a=new Kn({context:r});a.set("dom.tagName","input"),a.set("dom.attributes.type","radio"),a.set("dom.attributes.name",n),a.set("dom.attributes.id",a._id());var o=new Kn({context:r});o.set("dom.tagName","label");var l=this.get("text").value();Fp(l)&&o.add(l),o.set("dom.attributes.for",a._id()),this.add(a),this.add(o),this.set("radio",a),this.set("label",o),this.set("dom.attributes.data-jsgui-fields",Bp({value:this.get("value")}).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]"))}}activate(){if(!this.__active){super.activate();var e=this.radio,t=e.dom.el,s=this.label;e.on("change",r=>{this.raise("change",{name:"checked",value:t.checked})})}}};H_.exports=Jn});var Y_=q((Uw,V_)=>{var Bt=N(),Hw=Bt.stringify,Op=Bt.each,Vw=Bt.tof,Yw=Bt.is_defined,Pp=Bt.Control,Iw=Bt.group,Lp=Qn(),Zn=class extends Pp{constructor(e,t,s){super(e),this.__type_name="radio_button_group",this.add_class("radio-button-group");var r=this.context;if(!e.abstract&&!e.el){var n=this._id(),a=this.get("items").value();Op(a,(o,l)=>{var _=new Lp({context:r,name:n,text:o,value:o});this.add(_)})}}activate(){if(!this.__active){var e=this;super.activate();var t;this.content.each(function(s,r){s.on("change",!1,function(n){t=s,e.raise("change",{checked:t})})})}}};V_.exports=Zn});var G_=q((Xw,$_)=>{var pr=N(),Np=pr.stringify,$w=pr.each,Gw=pr.tof,Mp=Vs(),U_=pr.util,I_=U_.v_subtract,Ww=U_.v_add,ea=class extends Mp{constructor(e,t,s){e=e||{},e.__type_name=e.__type_name||"resize_handle",super(e);var r=this,n=this.context;this.target=e.target,this.position=e.position,!e.abstract&&!e.el&&(this.add_class("resize-handle"),this.dom.attributes["data-jsgui-ctrl-fields"]=Np({target:this.target._id()}).replace(/"/g,"'"))}activate(){if(!this.__active){super.activate();var e=this.context,t=e.body(),s=this.target;this.add_event_listener("mousedown",r=>{var n=[r.pageX,r.pageY];s.begin_resize();var a=l=>{var _=[l.pageX,l.pageY],u=I_(_,n);s.mid_resize(u)},o=l=>{console.log("e_mouseup",l);var _=[l.pageX,l.pageY],u=I_(_,n);console.log("mu offset",u),t.remove_event_listener("mousemove",a),t.remove_event_listener("mouseup",o),s.end_resize(u)};t.add_event_listener("mousemove",a),t.add_event_listener("mouseup",o)})}}};$_.exports=ea});var ia=q((Zw,X_)=>{var vr=N(),Kw=vr.stringify,Jw=vr.each,Qw=vr.tof,ta=vr.Control,W_=_t(),Ye=class extends ta{constructor(e,t,s){super(e),this.__type_name="scrollbar",this.active();var r=this,n=this.context;if(!e.abstract&&!e.el){this.add_class("scrollbar");var a=new W_({context:n}),o=new ta({context:n}),l=new ta({context:n}),_=new W_({context:n});this.add(a),o.add(l),this.add(o),this.add(_)}}activate(){if(!this.__active){super.activate();var e=this}}},sa=class extends Ye{constructor(e){super(e),this.__direction="horizontal"}},ra=class extends Ye{constructor(e){super(e),this.__direction="vertical"}};Ye.H=Ye.Horizontal=sa;Ye.V=Ye.Vertical=ra;X_.exports=Ye});var Z_=q((r2,Q_)=>{var yr=N(),e2=yr.stringify,t2=yr.each,s2=yr.tof,K_=yr.Control,J_=ia(),Rp=J_.H,Hp=J_.V,na=class extends K_{constructor(e,t,s){if(super(e),this.__type_name="toggle_button",this.add_class("scrollbar"),!e.abstract&&!e.el){var r=new K_({context:this.context}),n=new Rp({context:this.context}),a=new Hp({context:this.context});this.add(r),this.add(n),this.add(a),this.active()}var o=this}activate(){if(!this.__active){super.activate();var e=this}}};Q_.exports=na});var th=q((n2,eh)=>{var aa=N(),{Control:Vp}=aa,{prop:i2,field:Yp}=ae(),oa=class extends Vp{constructor(e){if(e.__type_name=e.__type_name||"search_bar",super(e),this.add_class("search-bar"),Yp(this,"value"),!e.el){let t='<Text_Input name="input"></Text_Input><Button name="btn"></Button>';aa.parse_mount(t,this,aa.controls)}}activate(){if(!this.__active){super.activate();let{input:e,btn:t}=this;e.on("change",s=>{let{name:r,value:n}=s;r==="value"&&(this.value=n)})}}};eh.exports=oa});var rh=q((c2,sh)=>{var ps=N(),a2=ps.stringify,o2=ps.each,l2=ps.tof,Ip=ps.Control,la=class extends Ip{constructor(e){super(e),this.add_class("single-line"),this.__type_name="single_line";var t=this.value,s,r=this.get("meta_field");r&&(s=t.meta.get(r.value()));var n=this.dom.el;if(!n){var a=new ps.span({context:this.context});s&&a.add(s),this.add(a),this.set("span",a)}}activate(){super.activate();var e=this.content,t=e.get(0),s=t.dom.el.innerHTML;this.value=s}};sh.exports=la});var nh=q((_2,ih)=>{var Up=N(),ca=class extends Up.Blank_HTML_Document{constructor(e){super(e)}};ih.exports=ca});var oh=q((m2,ah)=>{var xr=N(),$p=dr(),h2=xr.stringify,u2=xr.each,f2=xr.tof,d2=xr.Control,_a=class extends $p{constructor(e,t,s){e.states=["start","stop"],e.state=e.state||"start",super(e),this.__type_name="start_stop_toggle_button",this.add_class("start-stop toggle-button"),this.on("change",r=>{let{name:n,value:a}=r;n==="state"&&(a==="stop"&&this.raise("start"),a==="start"&&this.raise("stop"))})}activate(){this.__active||super.activate()}};ah.exports=_a});var br=q((g2,lh)=>{var{get_truth_map_from_arr:Gp,each:Wp}=_e(),Xp=(i,e={})=>{i.__mx=i.__mx||{},i.__mx.press_events=!0;let s=Gp(["press-start","press-move","press-end","press-hold","press-drag-start"]),r=i.context.body(),{css:n}=e,a=!1,o,l,_,u,h,d=!1,f,p=4,g,b=500,k=C=>{if(C.touches.length===1)return C.pos=[C.pageX=C.touches[0].pageX,C.pageY=C.touches[0].pageY],f=C.el=C.touches[0].target,Y(C)},y=C=>{let R=C.path||C.composedPath();return f=C.el=R[0],Y(C)},T=C=>(C.pos=[C.pageX=C.pageX,C.pageY=C.pageY],S(C)),j=C=>(C.pos=[C.pageX=C.touches[0].pageX,C.pageY=C.touches[0].pageY],S(C)),S=C=>{_=C.pos,C.movement_offset=u=[C.pos[0]-o[0],C.pos[1]-o[1]],l.push(u),C.movement_offsets=l,C.move_mag=g=Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2)),C.ctrl=i,i.raise("press-move",C),g>=4&&!d&&(i.raise("press-drag-start",C),d=!0)},z=C=>{C.movement_offsets=l,C.move_mag=g,C.ctrl=i,C.el=f,h&&clearTimeout(h),r.off({touchend:Q,touchmove:j,mouseup:U,mousemove:T}),i.raise("press-end",C)},U=C=>(r.off({mouseup:U,mousemove:T}),C.pos=[C.pageX,C.pageY],z(C)),Q=C=>(r.off({touchend:Q,touchmove:j}),C.pos=_||o,z(C)),Y=C=>{l=[],g=0,d=!1;let R=!!C.touches;C.is_touch_event=R,o=[C.pageX,C.pageY],R?r.on({touchend:Q,touchmove:j}):r.on({mouseup:U,mousemove:T}),C.ctrl=i,i.raise("press-start",C),h=setTimeout(()=>{g<=p&&i.raise("press-hold",C)},b)},W=()=>{console.log("press-events setup (inner)"),i.on({touchstart:k,mousedown:y}),a=!0},ee=()=>{console.log("press-events unsetup"),console.log("--------------------"),i.off({touchstart:k,mousedown:y}),a=!1};(()=>{i.event_events=!0,i.on("add-event-listener",C=>{let{name:R}=C;s[R]&&(a||W())}),i.on("remove-event-listener",C=>{let{name:R}=C;if(s[R]){console.log("ctrl remove-event-listener",R);let I=i.bound_named_event_counts;console.log("bound_named_event_counts bnec",I),console.log("name",R);let D=0;Wp(I,(E,V)=>{s[V]&&(D+=E)}),D===0&&ee()}})})();let H=()=>{let C=i.context.body(),{css:R}=e;R&&i.on({"press-start":()=>i.add_class("pressed"),"press-end":()=>i.remove_class("pressed")});let I,D,E,V,L,B=!1,P,re=4,Z,F=500,K=O=>{if(O.touches.length===1)return O.pos=[O.pageX=O.touches[0].pageX,O.pageY=O.touches[0].pageY],P=O.el=O.touches[0].target,ve(O)},te=O=>{let ke=O.path||O.composedPath();return P=O.el=ke[0],ve(O)},m=O=>(O.pos=[O.pageX=O.pageX,O.pageY=O.pageY],w(O)),v=O=>(O.pos=[O.pageX=O.touches[0].pageX,O.pageY=O.touches[0].pageY],w(O)),w=O=>{E=O.pos,O.movement_offset=V=[O.pos[0]-I[0],O.pos[1]-I[1]],D.push(V),O.movement_offsets=D,O.move_mag=Z=Math.sqrt(Math.pow(V[0],2)+Math.pow(V[1],2)),O.ctrl=i,i.raise("press-move",O),Z>=4&&!B&&(i.raise("press-drag-start",O),B=!0)},x=O=>{O.movement_offsets=D,O.move_mag=Z,O.ctrl=i,O.el=P,L&&clearTimeout(L),i.raise("press-end",O)},A=O=>(C.remove_event_listener({mouseup:A,mousemove:m}),O.pos=[O.pageX,O.pageY],x(O)),J=O=>(C.remove_event_listener({touchend:J,touchmove:v}),O.pos=E||I,x(O)),ve=O=>{D=[],Z=0,B=!1;let ke=!!O.touches;O.is_touch_event=ke,I=[O.pageX,O.pageY],ke?C.on({touchend:J,touchmove:v}):C.on({mouseup:A,mousemove:m}),O.ctrl=i,i.raise("press-start",O),L=setTimeout(()=>{Z<=re&&i.raise("press-hold",O)},F)}}};lh.exports=Xp});var uh=q((y2,hh)=>{var Kp=N(),{controls:Jp,parse:p2,each:ch,are_equal:Qp}=Kp,{Control:Zp,Text_Node:ev}=Jp,_h=_t(),{field:ha,prop:v2}=ae(),tv=br(),sv=i=>{let e=i.bcr(),t=()=>{requestAnimationFrame(s=>{let r=i.bcr();Qp(e,r)||(i.raise("resize"),e=r),t()})};t()},rv=(i,e={offset:0})=>{let{context:t}=i,s=t.body(),r=[],n=[],{offset:a}=e,o=()=>{let f=i.bcr();return console.log("bcr",f),f},l=()=>{ch(r,f=>{f.remove()}),r=[],n=[]},_=(f,p)=>{let g=o(),[b,k,y]=g,T={tl:()=>[b[0]-a,b[1]-a],tm:()=>[t1[0]+1/2*y[0],t1[1]-a],tr:()=>[k[0]+a,b[1]-a]};if(T[p]){let j=T[p]();if(j)if(f.size){let S=[f.size[0]/2,f.size[1]/2];return[j[0]-S[0],j[1]-S[1]]}else return j}},u=(f,p)=>{let g=_(f,p);console.log("docpos",g),f.style({position:"absolute",left:g[0]+"px",top:g[1]+"px"}),s.add(f),r.push(f),n.push([f,p]),f.activate()},h=()=>{ch(n,f=>{let[p,g]=f,b=_(p,g);p.style({left:b[0]+"px",top:b[1]+"px"})})};return sv(i),i.on("resize",f=>{h()}),{add:u,clear:l}},iv=i=>{ha(i,"editable",!0),ha(i,"editing",!1);let{context:e}=i;i.on("activate",t=>{console.log("new mini mixin editable ctrl on activate");let s=i.dom.el.textContent;tv(i);let r=rv(i,{offset:8}),n=new _h({context:e,class:"cancel button",size:[24,24],text:"\u2B8C"});n.style({"line-height":"18px",color:"#8B0000","font-weight":"bold"});let a=new _h({context:e,class:"ok button",size:[24,24],text:"\u2713"});a.style({"line-height":"18px",color:"#228B22","font-weight":"bold"});let o=()=>{console.log("cancel_editing"),r.clear(),i.remove_class("editing"),i.editing=!1,i.dom.attributes.contenteditable=!1,i.dom.el.textContent=s},l=()=>{console.log("save_editing");let h=i.dom.el.textContent;console.log("new_text",h),r.clear(),i.remove_class("editing"),i.editing=!1,i.dom.attributes.contenteditable=!1,i.raise("edit-complete",{old:s,value:h})},_=!1,u=()=>{i.editing=!0,s=i.dom.el.textContent,i.add_class("editing"),r.add(n,"tl"),r.add(a,"tr"),_||(n.on("click",h=>{o()}),a.on("click",h=>{l()}),_=!0),i.dom.attributes.contenteditable=!0};i.on({"press-end":h=>{console.log("e_press_end",h),i.editing||u()}})})},ua=class extends Zp{constructor(e){e.__type_name=e.__type_name||"string_span",e.tag_name="span",e.class="string",super(e),ha(this,"value",e.value),iv(this);let{context:t}=this,s=()=>{let r=new ev({context:t,text:e.value});this.add(r)};e.el||s()}activate(){this.__active||(super.activate(),this.on({"edit-complete":e=>{let{old:t,value:s}=e;t!==s&&(this.value=s)}}))}};hh.exports=ua});var mh=q((k2,dh)=>{var vs=N(),x2=vs.stringify,b2=vs.each,w2=vs.tof,nv=vs.Control,fh=vs.Date_Picker,fa=class extends nv{constructor(e){e=e||{},e.__type_name=e.__type_name||"timespan_selector",super(e),e.span?this.span=e.span:this.span=[],e.skip_compose||this.compose()}compose(){let e=this.context,t=this.span[0]||new Date("2018-06-20T11:00:00"),s=this.span[0]||new Date("2018-08-20T11:00:00"),r=new fh({context:this.context,date:t});this.add(r);let n=new fh({context:this.context,date:s});this.add(n)}};dh.exports=fa});var ph=q((A2,gh)=>{var ys=N(),C2=ys.stringify,q2=ys.each,j2=ys.tof,T2=ys.is_defined,av=ys.Control,ov=Dt(),lv=ur(),da=class extends ov{constructor(e){if(super(e),this.__type_name="titled_panel",!e.abstract&&!e.el){var t=new lv({context:this.context,text:this.title});t.active(),this.add(t);var s=new av({context:this.context});s.active(),this.add(s)}}activate(){super.activate();let{title_bar:e,inner_control:t}=this}};gh.exports=da});var yh=q((E2,vh)=>{var cv=N(),{Control:_v}=cv,{prop:D2,field:S2}=ae(),ma=class extends _v{constructor(e){e.__type_name=e.__type_name||"toolbox",super(e),this.add_class("toolbox")}};vh.exports=ma});var bh=q((P2,xh)=>{var Ft=N(),hv=nn(),z2=Ft.stringify,B2=Ft.each,F2=Ft.tof,O2=Ft.is_defined,xs=Ft.Control,ga=class extends xs{constructor(e,t,s){if(super(e),this.__type_name="window",this.add_class("window"),!e.abstract&&!e.el){var r=t(xs({class:"relative"})),n=r.add(s(xs({class:"title bar"}))),a=this.title,o=s(Ft.h2());if(n.add(o),a){var l=a.value();o.add(l)}var _=r.add(s(xs({class:"inner"})));this.inner_control=_,this.title_bar=n,this.ctrl_relative=r}}resizable(){this.set("resizable","right-bottom"),this.set("dom.attributes.data-jsgui-fields","{'resizable': 'right-bottom'}")}activate(){if(!this.__active){super.activate();var e=this.context,t=this.get("ctrl_relative"),s=this.title_bar;s.drag_handle_to(this);var r=this.get("resizable");if(r&&r.value&&(r=r.value()),r=="right-bottom"){var n=new xs({class:"right-bottom resize-handle",context:e}),a=this.size(),o=16,l=16,_=a[0]-o,u=a[1]-l;n.style({left:_+"px",top:u+"px"})}}}menu(e){var t={value:e,context:this.context},s=new hv(t),r=this.inner_control,n=r.parent;s.insert_before(r),s.active()}};xh.exports=ga});var kh=q((L2,wh)=>{var uv={Arrow_Button:Oi(),Audio_Volume:cc(),Button:_t(),Context_Menu:mc(),Color_Palette:bc(),Checkbox:kc(),Combo_Box:qc(),File_Upload:Sc(),Grid:rs(),Grid_Cell:rs().Cell,Horizontal_Menu:nn(),Horizontal_Slider:Mi(),Data_Row:Oc(),Date_Picker:n_(),Dropdown_List:o_(),File_Tree:b_(),File_Tree_Node:k_(),Icon:cn(),Item:os(),Item_Selector:mn(),Left_Right_Arrows_Selector:pn(),Line_Chart:q_(),List:ar(),Login:D_(),Menu_Node:Zs(),Modal:E_(),Month_View:xn(),Multi_Layout_Mode:P_(),Panel:Dt(),Plus_Minus_Toggle_Button:Dn(),Popup_Menu_Button:R_(),Radio_Button:Qn(),Radio_Button_Group:Y_(),Resize_Handle:G_(),Scroll_View:Z_(),Scrollbar:ia(),Search_Bar:th(),Single_Line:rh(),Standard_Web_Page:nh(),Start_Stop_Toggle_Button:oh(),String_Span:uh(),Tabbed_Panel:Gn(),Text_Field:rr(),Text_Item:en(),Text_Input:Qi(),Tile_Slider:vn(),Timespan_Selector:mh(),Title_Bar:ur(),Titled_Panel:ph(),Toggle_Button:dr(),Toolbox:yh(),Tree:Pn(),Tree_Node:gr(),Vertical_Expander:En(),Window:bh()};wh.exports=uv});var qh=q((M2,Ch)=>{var{prop:N2,field:fv}=ae(),dv=N(),{Control:pa}=dv,mv=(i,e)=>{let t=!1,s=!1,r;i.cover=n=>{r=new pa({context:i.context,class:"cover"});let a=new pa({context:i.context,class:"background"}),o=new pa({context:i.context,class:"foreground"});return n.remove(),r.add(a),r.add(o),o.add(n),i.add(r),r},i.uncover=()=>{r.remove(),r=null},fv(i,"covered")};Ch.exports=mv});var Th=q((R2,jh)=>{var gv=xe(),{Evented_Class:wr,tof:pv,each:vv}=gv,va=class extends wr{constructor(e={}){super(e);let t;if(e.name)t=e.name;else throw"Ctrl_Display_Mode_Category requires a name property"}},ya=class extends wr{constructor(e={}){super(e);let t={},s=[];if(e.names)if(pv(e.names)==="array")vv(e.names,r=>{let n=new va({name:r});t[r]=n,s.push(n)});else throw"NYI"}},xa=class extends wr{constructor(e={}){super(e);let t=["size","layout","colors","interactivity"],s=new ya({names:t});Object.defineProperty(ctrl,"categories",{get(){return s},set(r){throw"NYI"}})}},ba=class extends wr{constructor(e={}){super(e);let t;e.ctrl&&(t=e.ctrl);let s=new xa({});Object.defineProperty(this,"modes",{get(){return s},set(r){throw"NYI"}})}},yv=(i,e={})=>{if(i.display)throw"ctrl already has .display property";{let t=new ba({ctrl:i});Object.defineProperty(i,"display",{get(){return t},set(s){throw"NYI"}})}};jh.exports=yv});var Dh=q((H2,Ah)=>{var xv=(i,e={})=>{};Ah.exports=xv});var Eh=q((V2,Sh)=>{var bv=i=>{let e=!1;i.on("touchstart",t=>{t.preventDefault()}),i.on("touchend",t=>{e||i.raise("click",t),e=!1}),i.on("touchmove",t=>{e=!0})};Sh.exports=bv});var Bh=q((Y2,zh)=>{var wv=i=>{i.delete=()=>{i.remove(),i.raise("delete")}};zh.exports=wv});var Oh=q(($2,Fh)=>{var{prop:I2,field:U2}=ae(),kv=Bh(),Cv=i=>{kv(i);let e=i.selected_deletable,t=r=>{},s=r=>{r.key==="Delete"&&i.delete()};i.on("change",r=>{let{name:n,value:a}=r;return n==="selected"&&i.once_active(()=>{a?document.addEventListener("keydown",s,!1):document.removeEventListener("keydown",s,!1)}),!0}),e!==void 0&&(i.selected_deletable=e)};Fh.exports=Cv});var Lh=q((X2,Ph)=>{var{prop:G2,field:W2}=ae(),qv=(i,e)=>{let t=i.old_selected_resizable,s=n=>{},r=n=>{let a=n.key;console.log("event",n),a!=="Control"&&n.ctrlKey};i.on("change",n=>{let{name:a,value:o}=n;return a==="selected"&&i.once_active(()=>{o?document.addEventListener("keypress",r,!1):document.removeEventListener("keypress",r,!1)}),!0}),old_selectable!==void 0&&(i.selected_deletable=old_sselected_deletableelectable)};Ph.exports=qv});var Hh=q((Q2,Rh)=>{var{prop:jv,field:Tv}=ae(),Ot=N(),K2=Ot.stringify,Nh=Ot.each,J2=Ot.tof,Av=Ot.Control,Mh=Ot.util.v_subtract,Dv=i=>{let e,t,s,r,n,a,o=Math.min,l=Math.max;return e=o(i[0][0],i[1][0]),s=l(i[0][0],i[1][0]),t=o(i[0][1],i[1][1]),r=l(i[0][1],i[1][1]),n=s-e,a=r-t,[[e,t],[n,a]]},Sv=i=>{let e=s=>{if(i.selectable&&!i.selection_scope){var r=s.ctrlKey,n=s.metaKey;r||n?i.action_select_toggle():i.action_select_only()}};Tv(i,"selection_box_host"),i.selection_box_host=!0;let t=i.activate;i.activate=function(s){t&&t.call(this,s);let r,n,a,o,l,_,u=this.new_selection_box=h=>(this.add(r=new Av({context:this.context,css:{position:"absolute"},class:"selection-box",pos:h})),r.activate(),jv(r,"coords",d=>{let f=Dv(d[0]);[r.pos,r.size]=f}),r);i.drag_events(h=>{console.log("md",h);let d=i.$(".main-box"),f=!0;if(h.target.tagName.toLowerCase()==="span"&&(f=!1),f){n=h.pos,i.find_selection_scope().deselect_all();let p=i.bcr()[0];o=Mh(h.pos,p),o[1]-=window.scrollY,n[1]-=window.scrollY,_=new Ot.Intersection_Finder({controls:d}),_.on("change",b=>{if(b.name==="intersections"){let[k,y,T]=b.value;Nh(y,j=>{let S=j.closest(z=>z.selectable===!0);S&&(S.selected=!0)}),Nh(T,j=>{let S=j.closest(z=>z.selectable===!0);S&&(S.selected=!1)})}});let g=u(h.pos)}else return!1},h=>{if(r){a=h.pos,a[1]-=window.scrollY;let d=i.bcr()[0];l=Mh(h.pos,d),r.coords=[o,l],_.coords=[n,a]}},h=>{r.remove(),_=null})}};Rh.exports=Sv});var Ih=q((Z2,Yh)=>{var Vh=br(),Ev=(i,e={})=>{let t=e.one||e.once||!1;console.log("press_outside"),i.__mx=i.__mx||{},(!i.__mx||!i.__mx.press_events)&&Vh(i),i.__mx.press_outside=!0;let s=i.context.body();(!s.__mx||!s.__mx.press_events)&&Vh(s),i.event_events=!0;let r=o=>{console.log("press_outside body press e",o);let{ctrl_target:l}=o;l===i||l.ancestor(i)||i.raise("press-outside",o)},n=()=>{s.on("press-end",r)},a=()=>{s.off("press-end",r)};i.on("add-event-listener",o=>{let{name:l}=o;l==="press-outside"&&n()}),i.on("remove-event-listener",o=>{let{name:l}=o;l==="press-outside"&&a()})};Yh.exports=Ev});var $h=q((ek,Uh)=>{var zv={coverable:qh(),date:_r(),display:Th(),display_modes:Dh(),fast_touch_click:Eh(),popup:fn(),selectable:wt(),selected_deletable:Oh(),selected_resizable:Lh(),selection_box_host:Hh(),dragable:Pi(),press_events:br(),press_outside:Ih()};Uh.exports=zv});var Pt=q((tk,Gh)=>{var he=N();he.Router=Vl();he.Resource=Xs();he.Resource_Pool=Jt();he.Resource.Data_KV=Kl();he.Resource.Data_Transform=Ks();he.Resource.Compilation=ec();he.Resource.Compiler=sc();he.Resource.load_compiler=(i,e,t)=>{throw"NYI"};he.controls=he.controls||{};Object.assign(he.controls,kh());Object.assign(he,he.controls);he.mixins=he.mx=$h();Gh.exports=he});var ka=q((sk,Wh)=>{var Bv=Pt(),Fv=Bv.Resource_Pool,Ov=yt(),Pv=Ov.prom_or_cb,wa=class extends Fv{constructor(e){super(e)}start(e){return Pv((t,s)=>{t(!0)},e)}};Wh.exports=wa});var Kh=q((rk,Xh)=>{var Ca=Pt(),{Control:Lv,controls:Nv,deep_sig:Mv,each:ut}=Ca,{Modal:Rv}=Nv,Hv=ka(),kr=class extends Ca.Page_Context{constructor(e){e=e||{},super(e);let{map_controls:t,map_control_iids:s,next_iid:r}=this;this.document=e.document||document,this.resource_pool=new Hv({}),this.__is_active=!0,this.map_els={};let n;Object.defineProperty(this,"modal",{get(){if(n)return n;{n=new Rv({context:this,class:"modal"});let g=this.body();return g&&g.add(n),n}},enumerable:!0});let a;Object.defineProperty(this,"overlay",{get(){if(a)return a;{a=new Lv({context:this,class:"overlay"});let g=this.body();return g&&(g.add(a),a.activate()),a.place=(b,k)=>{let y=Mv(k),T;if(y==="[s,C]"){let[j,S]=k,z=S.bcr(),U=a.bcr();if(j==="below"){T=[z[0][0],z[1][1]];let Q=U[1],W=g.bcr()[1][1]-T[1];b.pos=T,b.dom.attributes.style.position="absolute",b.dom.attributes.style["max-height"]=W+"px"}else throw console.trace(),"NYI"}a.add(b)},a}},enumerable:!0});let o=0,l,_=!1;this.map_controls_being_removed_in_frame=!1,this.map_controls_being_added_in_frame=!1;let u={},h,d=0,f=32;this.on("activate",()=>{console.log("activated client page_context.... ***** map_controls",t),ut(t,(Q,Y)=>{Q.dom.el&&(u[Y]=Q,d++)});let g,b,k,y,T,j={},S=()=>{let Q=f*d,Y=new Float32Array(Q);return T=(M=>{let H=Object.keys(M),C={};return ut(H,(R,I)=>{C[R]=I,j[I]=M[R]}),C})(u),((M,H,C)=>{ut(M,(R,I)=>{let D=H[I],V=R.dom.el.getBoundingClientRect(),B=D*f;C[B++]=V.left,C[B++]=V.top,C[B++]=V.width,C[B++]=V.height,C[B++]=V.right,C[B++]=V.bottom})})(u,T,Y),Y},z=(Q,Y,W)=>{ut(Y,(ee,M)=>{let C=W[M]*f,R=C+f;ee.ta=Q.subarray(C,R)})},U=Q=>{o++;let Y=()=>{let M=0,H=0,C=k.length,R,I=new Int8Array(d);I.fill(-1);let D=0;for(;H<C;){let E=k[H]-b[H],V=Math.floor(H/f);E!==0&&(R=!0,I[D++]=V),y[H]=E,H++}if(R){let E=0,V=y.length,L=!1;for(;!L&&E<V;){let B=I[E];if(B===-1)L=!0;else{let P=j[B],re=y.subarray(B*f,(B+1)*f),Z=P.ta,F=0,K=Z.length,te=!1;for(F=0;F<K;F++)if(re[F]!==0){let v=Z[F],w=0,x=1,A=2,J=3,ve=4,O=5,ke=6,qr=7;if(F!==1){if(F!==2){if(F!==3){if(F!==4){if(F!==5){if((F===6||F===7)&&!te){let Ie=Z[6],De=Z[7];P.dom.attributes.style.transform="translate3d("+Ie+"px, "+De+"px, 0px)",te=!0}}}}}}}let m=B*f;for(let v=0;v<K;v++)b[m++]=Z[v]}E++}}};o>1?Y():z(k,u,T);let W=0,ee=0;o===1||(h={}),this.map_controls_being_removed_in_frame?(ut(u,(M,H)=>{this.map_controls_being_removed_in_frame[H]||(h[H]=M)}),ee+=Object.keys(this.map_controls_being_removed_in_frame).length,this.map_controls_being_removed_in_frame=!1):h=u,this.map_controls_being_added_in_frame&&(this.map_controls_being_added_in_frame=!1,ut(this.map_controls_being_added_in_frame,(M,H)=>{h[H]=M,W++})),this.raise("frame",{number:o,timestamp:Q,window_was_resized:_,count_ctrls_added:W,count_ctrls_removed:ee,map_dom_controls:h,count_dom_ctrls:d,ta_dom_controls_numeric_values:k,map_dom_ctrl_iids:T}),l=Q,window.requestAnimationFrame(U),_=!1,u=h};window.requestAnimationFrame(U),window.addEventListener("resize",Q=>{_=!0,this.raise("window-resize",Q)}),b=S(),k=new Float32Array(b.length),y=new Float32Array(b.length),k.set(b)});let p=()=>{let g=this.create_dims_from_current_ctrls=()=>{let{next_iid:b}=this,k=6,y=new Float32Array(b*k),T=0;return ut(t,(j,S)=>{if(T=j.iid*k,j.dom&&j.dom.el){let U=j.dom.el.getBoundingClientRect();y[T++]=U.left,y[T++]=U.top,y[T++]=U.right,y[T++]=U.bottom,y[T++]=U.width,y[T++]=U.height}}),y}}}get_ctrl_el(e){return this.map_els[e._id()]}register_el(e){let t=e.getAttribute("data-jsgui-id");t&&(this.map_els[t]=e)}body(){var e=this.document,t=e.body;if(!this._body){var s=t.getAttribute("data-jsgui-id");if(s)this.map_controls[s]&&(this._body=this.map_controls[s]);else{var r=new Ca.body({el:document.body,context:this});r.dom.el.setAttribute("jsgui-id",r._id()),this.register_control(r),this._body=r}}return this._body}};kr.css=`
body .modal {
    position: absolute;
    left: 0px;
    top: 0px;
}
body .overlay {
    position: absolute;
    left: 0px;
    top: 0px;
}
`;Xh.exports=kr});var Qh=q((mk,Jh)=>{var fe=Pt(),Vv=fe.Resource,Yv=yt(),Iv=Yv.prom_or_cb,ik=fe.stringify,nk=fe.each,ak=fe.arrayify,ok=fe.tof,lk=fe.get_a_sig,ck=fe.filter_map_by_regex,_k=fe.Class,Uv=fe.Data_Object,hk=fe.Enhanced_Data_Object,uk=fe.fp,fk=fe.is_defined,dk=fe.Collection,$v=function(i,e){return i.indexOf(e,i.length-e.length)!==-1},qa=class extends Vv{constructor(e={}){if(super(e),e.meta){var t=e.meta;t.url&&this.meta.set("url",t.url),t.type_levels&&this.meta.set("type_levels",t.type_levels)}this.data=new Uv,this.data.on("change",(s,r)=>{this.trigger("change",s,r)})}get(e,t){return Iv((s,r)=>{let n=$v(e,".json"),a;n?a=e:a=e+".json",a="resources/"+this.name+"/"+a,fe.http(a,function(o,l){o?r(o):s(l)})},t)}get status(){return(async()=>await fe.http("/resources/"+this.name+"/status.json"))()}notify_change_from_server(e,t){var s=this.data;this.data._[e]=t,this.data.trigger("change",e,t)}};Jh.exports=qa});var tu=q((gk,eu)=>{jsgui=Pt();jsgui.Resource_Pool=ka();jsgui.Client_Page_Context=Kh();jsgui.Client_Resource=Qh();var Gv=yt(),ja=Gv.prom_or_cb,{each:Zh,tf:Wv}=jsgui;if(typeof window<"u"){let i;jsgui.http=(s,r)=>ja((n,a)=>{let o=2500;var l=new XMLHttpRequest;l.timeout=o,l.onreadystatechange=function(){if(this.readyState===4)if(this.status===200){var _=JSON.parse(this.responseText);n(_)}else a(this.status)},l.open("GET",s,!0),l.send()},r),jsgui.http_post=(s,r,n)=>ja((a,o)=>{var l=new XMLHttpRequest;l.onreadystatechange=function(){if(this.readyState===4)if(this.status===200){var h=JSON.parse(this.responseText);a(h)}else o({status:this.status,responseText:this.responseText})},l.open("POST",s,!0);let _,u=Wv(r);u==="s"||u==="B"?_=r:(u==="a"||u==="o")&&(_=JSON.stringify(r),l.setRequestHeader("content-type","application/json")),l.send(_)},n),jsgui.http_delete=(s,r)=>ja((n,a)=>{var o=new XMLHttpRequest;o.onreadystatechange=function(){if(this.readyState===4)if(this.status===200){var l=JSON.parse(this.responseText);n(l)}else a(this.status)},o.open("DELETE",s,!0),o.send()},r),jsgui.update_standard_Controls=s=>{Zh(jsgui.controls,(r,n)=>{s.update_Controls(n,r)})};let e;jsgui.register_server_resources=s=>{jsgui.def_server_resources=s},jsgui.register_context_data=s=>{e=s};let t=()=>{let{def_server_resources:s}=jsgui;page_context=new jsgui.Client_Page_Context({document}),i=page_context,jsgui.context=page_context,e&&Object.assign(page_context,e),jsgui.update_standard_Controls(page_context),jsgui.raise("pre-activate",{context:i}),jsgui.activate(page_context);let n=i.resource_pool.resources._arr[0],a=l=>{let{name:_,type:u}=l;if(u==="function"){let h=async d=>{let f=await jsgui.http_post("/"+_,d);return console.log("res_dl",f),f};n[_]=h}};(()=>{Zh(s,(l,_)=>{a(l)})})(),jsgui.raise("activate",{context:i}),page_context.raise("activate",{context:i})};window.addEventListener("load",()=>{console.log("client.js window onload"),t()})}eu.exports=jsgui});var ru=q((pk,su)=>{var bs=Pt(),{Blank_HTML_Document:Xv}=bs,Ta=class extends Xv{constructor(e={}){super(e),this.active()}include_js(e){let t=this.get("body");var s=new bs.script({context:this.context}),r=s.dom,n=r.attributes;n.type="text/javascript",n.src=e,t.add(s)}include_css(e){var t=this.get("head"),s=new bs.link({context:this.context}),r=s.dom,n=r.attributes;n.rel="stylesheet",n.type="text/css",n.href=e,t.content.add(s)}include_jsgui_client(e){e=e||"/js/web/jsgui-html-client";var t=this.head,s=this.body,r=new bs.script({context:this.context}),n=r.dom.attributes;n.set({type:"text/javascript",src:"/js/web/require.js","data-main":e}),s.add(r)}include_client_css(){var e=this.get("head"),t=new bs.link({context:this.context}),s=t.dom.attributes;s.rel="stylesheet",s.type="text/css",s.href="/css/basic.css",e.content.add(t)}};su.exports=Ta});var ey=q((vk,au)=>{var iu=tu(),{controls:nu,Control:Kv,mixins:Jv}=iu,{dragable:Qv}=Jv,Zv=ru(),Cr=class extends Zv{constructor(e={}){e.__type_name=e.__type_name||"demo_ui",super(e);let{context:t}=this;this.body.add_class("demo-ui");let s=()=>{let r=new ws({context:t});this.body.add(r)};e.el||s()}activate(){if(!this.__active){super.activate();let{context:e}=this;console.log("activate Demo_UI"),e.on("window-resize",t=>{console.log("window-resize",t)})}}};Cr.css=`
.demo-ui {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    min-height: 100vh;
}
`;var ws=class extends Kv{constructor(e){e.__type_name=e.__type_name||"square_box",super(e),this.add_class("square-box")}activate(){this.__active||(super.activate(),console.log("Activate square box"),Qv(this,{drag_mode:"translate"}),console.log("dragable mixin applied to square"),this.dragable=!0,this.on("dragend",e=>{console.log("square box dragend e",e),this.dom.el.style.backgroundColor="#FF4444"}))}};ws.css=`
.square-box {
    background-color: #BB3333;
    width: 220px;
    height: 220px;
}
`;nu.Demo_UI=Cr;nu.Square_Box=ws;au.exports=iu});ey();})();
/*! Bundled license information:

jsgui3-html/html-core/html-core.js:
  (*!
   * escape-html
   * Copyright(c) 2012-2013 TJ Holowaychuk
   * Copyright(c) 2015 Andreas Lubbe
   * Copyright(c) 2015 Tiancheng "Timothy" Gu
   * MIT Licensed
   *)
*/
